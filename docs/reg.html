<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 R code for Regression Analysis | An R companion</title>
  <meta name="description" content="A freely available document meant to help students learn R concurrently with the material of the course." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 R code for Regression Analysis | An R companion" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A freely available document meant to help students learn R concurrently with the material of the course." />
  <meta name="github-repo" content="emontoya2/csubRcomp-git" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 R code for Regression Analysis | An R companion" />
  
  <meta name="twitter:description" content="A freely available document meant to help students learn R concurrently with the material of the course." />
  

<meta name="author" content="Eduardo Montoya" />


<meta name="date" content="2025-07-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basics.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">An R companion for undergraduate regression and ANOVA</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction: Getting Familiar with R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#what-is-r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> What is R and RStudio?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#downloading-and-installing-r"><i class="fa fa-check"></i><b>1.2</b> Downloading and Installing R</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#downloading-and-installing-rstudio"><i class="fa fa-check"></i><b>1.3</b> Downloading and Installing RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#layout-of-rstudio"><i class="fa fa-check"></i><b>1.4</b> Layout of RStudio</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#expressions-and-assignments"><i class="fa fa-check"></i><b>1.5</b> Expressions and Assignments</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#running-r-code-in-rstudio"><i class="fa fa-check"></i><b>1.6</b> Running R Code in RStudio</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#a-fancy-calculator"><i class="fa fa-check"></i><b>1.7</b> A Fancy Calculator</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#working-with-vectors"><i class="fa fa-check"></i><b>1.8</b> Working with Vectors</a></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#data-types-in-r"><i class="fa fa-check"></i><b>1.9</b> Data Types in R</a></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#comments-in-r"><i class="fa fa-check"></i><b>1.10</b> Comments in R</a></li>
<li class="chapter" data-level="1.11" data-path="intro.html"><a href="intro.html#using-r-functions"><i class="fa fa-check"></i><b>1.11</b> Using R Functions</a></li>
<li class="chapter" data-level="1.12" data-path="intro.html"><a href="intro.html#loading-and-installing-packages"><i class="fa fa-check"></i><b>1.12</b> Loading and Installing Packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Some basic R tasks</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#using-rs-built-in-datasets"><i class="fa fa-check"></i><b>2.1</b> Using R’s Built-In Datasets</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#csv-files"><i class="fa fa-check"></i><b>2.2</b> .csv Files</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#importing-a-.csv-file"><i class="fa fa-check"></i><b>2.3</b> Importing a .csv File</a></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#using-rstudios-import-feature"><i class="fa fa-check"></i><b>2.4</b> Using RStudio’s Import Feature</a></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#summarizing-data"><i class="fa fa-check"></i><b>2.5</b> Summarizing Data</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#exporting-graphs-and-output"><i class="fa fa-check"></i><b>2.6</b> Exporting Graphs and Output</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#extracting-variables"><i class="fa fa-check"></i><b>2.7</b> Extracting Variables</a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#common-errors"><i class="fa fa-check"></i><b>2.8</b> Common Errors</a></li>
<li class="chapter" data-level="2.9" data-path="basics.html"><a href="basics.html#help-files"><i class="fa fa-check"></i><b>2.9</b> Help Files</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reg.html"><a href="reg.html"><i class="fa fa-check"></i><b>3</b> R code for Regression Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="reg.html"><a href="reg.html#linear-regression-with-one-predictor-variable"><i class="fa fa-check"></i><b>3.1</b> Linear Regression with One Predictor Variable</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="reg.html"><a href="reg.html#scatterplots"><i class="fa fa-check"></i><b>3.1.1</b> Scatterplots</a></li>
<li class="chapter" data-level="3.1.2" data-path="reg.html"><a href="reg.html#least-squares-ls-estimates"><i class="fa fa-check"></i><b>3.1.2</b> Least Squares (LS) Estimates</a></li>
<li class="chapter" data-level="3.1.3" data-path="reg.html"><a href="reg.html#plotting-the-estimated-regression-line"><i class="fa fa-check"></i><b>3.1.3</b> Plotting the Estimated Regression Line</a></li>
<li class="chapter" data-level="3.1.4" data-path="reg.html"><a href="reg.html#fitted-or-predicted-values"><i class="fa fa-check"></i><b>3.1.4</b> Fitted or Predicted Values</a></li>
<li class="chapter" data-level="3.1.5" data-path="reg.html"><a href="reg.html#residuals"><i class="fa fa-check"></i><b>3.1.5</b> Residuals</a></li>
<li class="chapter" data-level="3.1.6" data-path="reg.html"><a href="reg.html#summary-output"><i class="fa fa-check"></i><b>3.1.6</b> <code>summary()</code> Output</a></li>
<li class="chapter" data-level="3.1.7" data-path="reg.html"><a href="reg.html#estimating-sigma2"><i class="fa fa-check"></i><b>3.1.7</b> Estimating <span class="math inline">\(\sigma^2\)</span></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="reg.html"><a href="reg.html#inference-in-simple-linear-regression"><i class="fa fa-check"></i><b>3.2</b> Inference in Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="reg.html"><a href="reg.html#inferences-for-beta_0-and-beta_1"><i class="fa fa-check"></i><b>3.2.1</b> Inferences for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span></a></li>
<li class="chapter" data-level="3.2.2" data-path="reg.html"><a href="reg.html#confidence-interval-for-beta_1"><i class="fa fa-check"></i><b>3.2.2</b> Confidence Interval for <span class="math inline">\(\beta_1\)</span></a></li>
<li class="chapter" data-level="3.2.3" data-path="reg.html"><a href="reg.html#anova-for-regression"><i class="fa fa-check"></i><b>3.2.3</b> ANOVA for Regression</a></li>
<li class="chapter" data-level="3.2.4" data-path="reg.html"><a href="reg.html#measures-of-association"><i class="fa fa-check"></i><b>3.2.4</b> Measures of Association</a></li>
<li class="chapter" data-level="3.2.5" data-path="reg.html"><a href="reg.html#residual-analysis-and-remedial-measures"><i class="fa fa-check"></i><b>3.2.5</b> Residual Analysis and Remedial Measures</a></li>
<li class="chapter" data-level="3.2.6" data-path="reg.html"><a href="reg.html#creating-residual-plots"><i class="fa fa-check"></i><b>3.2.6</b> Creating Residual Plots</a></li>
<li class="chapter" data-level="3.2.7" data-path="reg.html"><a href="reg.html#residual-plots-from-the-tactile-package"><i class="fa fa-check"></i><b>3.2.7</b> Residual Plots from the <code>tactile</code> Package</a></li>
<li class="chapter" data-level="3.2.8" data-path="reg.html"><a href="reg.html#testing-for-departures-from-normality"><i class="fa fa-check"></i><b>3.2.8</b> Testing for Departures from Normality</a></li>
<li class="chapter" data-level="3.2.9" data-path="reg.html"><a href="reg.html#transformations"><i class="fa fa-check"></i><b>3.2.9</b> Transformations</a></li>
<li class="chapter" data-level="3.2.10" data-path="reg.html"><a href="reg.html#f-test-for-lack-of-fit"><i class="fa fa-check"></i><b>3.2.10</b> F-Test for Lack of Fit</a></li>
<li class="chapter" data-level="3.2.11" data-path="reg.html"><a href="reg.html#least-absolute-deviation-lad-regression"><i class="fa fa-check"></i><b>3.2.11</b> Least Absolute Deviation (LAD) Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="reg.html"><a href="reg.html#the-matrix-approach-to-simple-linear-regression"><i class="fa fa-check"></i><b>3.3</b> The Matrix Approach to Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="reg.html"><a href="reg.html#creating-a-matrix"><i class="fa fa-check"></i><b>3.3.1</b> Creating a Matrix</a></li>
<li class="chapter" data-level="3.3.2" data-path="reg.html"><a href="reg.html#matrix-operations"><i class="fa fa-check"></i><b>3.3.2</b> Matrix Operations</a></li>
<li class="chapter" data-level="3.3.3" data-path="reg.html"><a href="reg.html#ls-estimation"><i class="fa fa-check"></i><b>3.3.3</b> LS Estimation</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="reg.html"><a href="reg.html#multiple-linear-regression-mlr"><i class="fa fa-check"></i><b>3.4</b> Multiple Linear Regression (MLR)</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="reg.html"><a href="reg.html#least-squares-estimates"><i class="fa fa-check"></i><b>3.4.1</b> Least Squares Estimates</a></li>
<li class="chapter" data-level="3.4.2" data-path="reg.html"><a href="reg.html#fitted-values-anova-table-and-residuals"><i class="fa fa-check"></i><b>3.4.2</b> Fitted Values, ANOVA Table, and Residuals</a></li>
<li class="chapter" data-level="3.4.3" data-path="reg.html"><a href="reg.html#inference-on-regression-parameters"><i class="fa fa-check"></i><b>3.4.3</b> Inference on Regression Parameters</a></li>
<li class="chapter" data-level="3.4.4" data-path="reg.html"><a href="reg.html#mean-response-and-prediction-intervals"><i class="fa fa-check"></i><b>3.4.4</b> Mean Response and Prediction Intervals</a></li>
<li class="chapter" data-level="3.4.5" data-path="reg.html"><a href="reg.html#diagnostics"><i class="fa fa-check"></i><b>3.4.5</b> Diagnostics</a></li>
<li class="chapter" data-level="3.4.6" data-path="reg.html"><a href="reg.html#anova-table-with-ssr-decomposition"><i class="fa fa-check"></i><b>3.4.6</b> ANOVA Table with SSR Decomposition</a></li>
<li class="chapter" data-level="3.4.7" data-path="reg.html"><a href="reg.html#testing-beta_k-ne-0-for-some-k"><i class="fa fa-check"></i><b>3.4.7</b> Testing <span class="math inline">\(\beta_k \ne 0\)</span> for Some <span class="math inline">\(k\)</span></a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="reg.html"><a href="reg.html#interactions"><i class="fa fa-check"></i><b>3.5</b> Interactions</a></li>
<li class="chapter" data-level="3.6" data-path="reg.html"><a href="reg.html#standardized-multiple-regression"><i class="fa fa-check"></i><b>3.6</b> Standardized Multiple Regression</a></li>
<li class="chapter" data-level="3.7" data-path="reg.html"><a href="reg.html#polynomial-regression-and-categorical-predictors"><i class="fa fa-check"></i><b>3.7</b> Polynomial Regression and Categorical Predictors</a></li>
<li class="chapter" data-level="3.8" data-path="reg.html"><a href="reg.html#model-selection"><i class="fa fa-check"></i><b>3.8</b> Model Selection</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="reg.html"><a href="reg.html#adjusted-r2-and-c_p"><i class="fa fa-check"></i><b>3.8.1</b> Adjusted <span class="math inline">\(R^2\)</span> and <span class="math inline">\(C_p\)</span></a></li>
<li class="chapter" data-level="3.8.2" data-path="reg.html"><a href="reg.html#aic"><i class="fa fa-check"></i><b>3.8.2</b> AIC</a></li>
<li class="chapter" data-level="3.8.3" data-path="reg.html"><a href="reg.html#bic"><i class="fa fa-check"></i><b>3.8.3</b> BIC</a></li>
<li class="chapter" data-level="3.8.4" data-path="reg.html"><a href="reg.html#aicc"><i class="fa fa-check"></i><b>3.8.4</b> AICc</a></li>
<li class="chapter" data-level="3.8.5" data-path="reg.html"><a href="reg.html#stepwise-regression"><i class="fa fa-check"></i><b>3.8.5</b> Stepwise Regression</a></li>
<li class="chapter" data-level="3.8.6" data-path="reg.html"><a href="reg.html#cv-press-and-gcv"><i class="fa fa-check"></i><b>3.8.6</b> CV (PRESS) and GCV</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="reg.html"><a href="reg.html#more-diagnostics"><i class="fa fa-check"></i><b>3.9</b> More Diagnostics</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="reg.html"><a href="reg.html#identifying-outlying-y-and-x-values"><i class="fa fa-check"></i><b>3.9.1</b> Identifying Outlying y and x Values</a></li>
<li class="chapter" data-level="3.9.2" data-path="reg.html"><a href="reg.html#identifying-influential-cases"><i class="fa fa-check"></i><b>3.9.2</b> Identifying Influential Cases</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An R companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reg" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> R code for Regression Analysis<a href="reg.html#reg" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter shows how to use <strong>R</strong> for methods covered in a regression analysis course. Some examples follow:</p>
<p>Kutner M.H., Nachtsheim C.J., and Neter, J., <em>Applied Linear Regression Models</em>, McGraw-Hill/Irwin.</p>
<p>We refer to this text as ALRM. Datasets are available at:</p>
<p><a href="https://www.csub.edu/~emontoya2/datasets/textbookdata/index.html">https://www.csub.edu/~emontoya2/datasets/textbookdata/index.html</a></p>
<div id="linear-regression-with-one-predictor-variable" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Linear Regression with One Predictor Variable<a href="reg.html#linear-regression-with-one-predictor-variable" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We illustrate simple linear regression (SLR) using the Toluca Company example from ALRM. The model is:
<span class="math display">\[
y_i=\beta_0+\beta_1 x_i + \varepsilon_i  
\]</span>
Here, <span class="math inline">\(y_i\)</span> is the response, <span class="math inline">\(x_i\)</span> the predictor, and errors <span class="math inline">\(\varepsilon_i\)</span> are independent, have mean 0, and constant variance <span class="math inline">\(\sigma^2\)</span>.</p>
<p>We use <strong>R</strong> to generate scatterplots, estimate coefficients, obtain fitted values, residuals, and estimate <span class="math inline">\(\sigma^2\)</span>.</p>
<div id="scatterplots" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Scatterplots<a href="reg.html#scatterplots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Scatterplots show the relationship between two variables. For bivariate data, the general plotting syntax is <code>goal(y ~ x, data)</code>, where <code>y</code> is the response and <code>x</code> the predictor. To create a scatterplot, use <code>xyplot</code>.</p>
<p>Importing the Toluca data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="reg.html#cb1-1" tabindex="-1"></a><span class="fu">require</span>(mosaic)</span>
<span id="cb1-2"><a href="reg.html#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="reg.html#cb1-3" tabindex="-1"></a><span class="co"># Dataset is plain text without variable names, so we customize read.csv</span></span>
<span id="cb1-4"><a href="reg.html#cb1-4" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%201%20Data%20Sets/CH01TA01.txt&quot;</span></span>
<span id="cb1-5"><a href="reg.html#cb1-5" tabindex="-1"></a>toluca.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">col.names=</span><span class="fu">c</span>(<span class="st">&quot;xvar&quot;</span>, <span class="st">&quot;yvar&quot;</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Preview the data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="reg.html#cb2-1" tabindex="-1"></a><span class="fu">glimpse</span>(toluca.data)</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 2
## $ xvar &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 10…
## $ yvar &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389, …</code></pre>
<p>Use variable names <code>yvar</code> and <code>xvar</code> in plotting functions:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="reg.html#cb4-1" tabindex="-1"></a><span class="fu">xyplot</span>(yvar <span class="sc">~</span> xvar, <span class="at">data=</span>toluca.data)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Other useful <code>xyplot()</code> arguments:</p>
<pre><code>xyplot(y ~ x | gfactor, data, main, xlab, ylab, col, pch)
# y: response variable
# x: predictor
# gfactor: optional grouping factor
# data: data frame
# main: plot title
# xlab, ylab: axis labels
# col: point color
# pch: symbol type (1–25)</code></pre>
</div>
<div id="least-squares-ls-estimates" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Least Squares (LS) Estimates<a href="reg.html#least-squares-ls-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can compute LS estimates either by applying the algebraic formulas or using the <code>lm()</code> function. The general form is <code>lm(y ~ x, data)</code>.</p>
<p>Recall the LS estimators:
<span class="math display">\[
b_1=\frac{\sum (x_i-\bar{x})(y_i-\bar{y}) }{\sum (x_i-\bar{x})^2}, \quad b_0=\bar{y}- b_1\bar{x}
\]</span></p>
<p>We apply these in <strong>R</strong>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="reg.html#cb6-1" tabindex="-1"></a>myx <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>xvar</span>
<span id="cb6-2"><a href="reg.html#cb6-2" tabindex="-1"></a>myy <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>yvar</span>
<span id="cb6-3"><a href="reg.html#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="reg.html#cb6-4" tabindex="-1"></a>XminusXbar <span class="ot">&lt;-</span> myx <span class="sc">-</span> <span class="fu">mean</span>(<span class="sc">~</span>myx)</span>
<span id="cb6-5"><a href="reg.html#cb6-5" tabindex="-1"></a>YminusYbar <span class="ot">&lt;-</span> myy <span class="sc">-</span> <span class="fu">mean</span>(<span class="sc">~</span>myy)</span>
<span id="cb6-6"><a href="reg.html#cb6-6" tabindex="-1"></a>XminusXbarSq <span class="ot">&lt;-</span> XminusXbar<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb6-7"><a href="reg.html#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="reg.html#cb6-8" tabindex="-1"></a>b<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">sum</span>((myx <span class="sc">-</span> <span class="fu">mean</span>(<span class="sc">~</span>myx)) <span class="sc">*</span> (myy <span class="sc">-</span> <span class="fu">mean</span>(<span class="sc">~</span>myy))) <span class="sc">/</span> <span class="fu">sum</span>((myx <span class="sc">-</span> <span class="fu">mean</span>(<span class="sc">~</span>myx))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb6-9"><a href="reg.html#cb6-9" tabindex="-1"></a>b<span class="fl">.1</span></span></code></pre></div>
<pre><code>## [1] 3.570202</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="reg.html#cb8-1" tabindex="-1"></a>b<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="sc">~</span>myy) <span class="sc">-</span> b<span class="fl">.1</span> <span class="sc">*</span> <span class="fu">mean</span>(<span class="sc">~</span>myx)</span>
<span id="cb8-2"><a href="reg.html#cb8-2" tabindex="-1"></a>b<span class="fl">.0</span></span></code></pre></div>
<pre><code>## [1] 62.36586</code></pre>
<p>Thus, <span class="math inline">\(b_1=3.570\)</span> and <span class="math inline">\(b_0=62.366\)</span>.</p>
<p>Alternatively, use <code>lm()</code> with the dataframe and variable names:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="reg.html#cb10-1" tabindex="-1"></a><span class="fu">lm</span>(yvar <span class="sc">~</span> xvar, <span class="at">data=</span>toluca.data)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = yvar ~ xvar, data = toluca.data)
## 
## Coefficients:
## (Intercept)         xvar  
##       62.37         3.57</code></pre>
<p>To access more model details, save the result to an <em>lm object</em>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="reg.html#cb12-1" tabindex="-1"></a>toluca.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(yvar <span class="sc">~</span> xvar, <span class="at">data=</span>toluca.data)</span></code></pre></div>
<p>Summarize to view coefficients and more:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="reg.html#cb13-1" tabindex="-1"></a><span class="fu">summary</span>(toluca.fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = yvar ~ xvar, data = toluca.data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -83.876 -34.088  -5.982  38.826 103.528 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   62.366     26.177   2.382   0.0259 *  
## xvar           3.570      0.347  10.290 4.45e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 48.82 on 23 degrees of freedom
## Multiple R-squared:  0.8215, Adjusted R-squared:  0.8138 
## F-statistic: 105.9 on 1 and 23 DF,  p-value: 4.449e-10</code></pre>
<p>Or use <code>coef()</code> to extract just the coefficients:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="reg.html#cb15-1" tabindex="-1"></a><span class="fu">coef</span>(toluca.fit)</span></code></pre></div>
<pre><code>## (Intercept)        xvar 
##   62.365859    3.570202</code></pre>
</div>
<div id="plotting-the-estimated-regression-line" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Plotting the Estimated Regression Line<a href="reg.html#plotting-the-estimated-regression-line" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can plot the fitted line using either <code>xyplot()</code> or <code>plotModel()</code>.</p>
<div id="using-xyplot" class="section level4 hasAnchor" number="3.1.3.1">
<h4><span class="header-section-number">3.1.3.1</span> Using <code>xyplot()</code><a href="reg.html#using-xyplot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Add the estimated line with <code>type = c("p", "r")</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="reg.html#cb17-1" tabindex="-1"></a><span class="fu">xyplot</span>(yvar <span class="sc">~</span> xvar, <span class="at">data=</span>toluca.data, <span class="at">type=</span><span class="fu">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;r&quot;</span>))</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="using-plotmodel" class="section level4 hasAnchor" number="3.1.3.2">
<h4><span class="header-section-number">3.1.3.2</span> Using <code>plotModel()</code><a href="reg.html#using-plotmodel" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This plots both data and the estimated line:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="reg.html#cb18-1" tabindex="-1"></a><span class="fu">plotModel</span>(toluca.fit)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>To customize aesthetics, use <code>xyplot()</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="reg.html#cb19-1" tabindex="-1"></a><span class="fu">xyplot</span>(yvar <span class="sc">~</span> xvar, <span class="at">data=</span>toluca.data, <span class="at">type=</span><span class="fu">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;r&quot;</span>), </span>
<span id="cb19-2"><a href="reg.html#cb19-2" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">&quot;Explanatory variable&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Response variable&quot;</span>, </span>
<span id="cb19-3"><a href="reg.html#cb19-3" tabindex="-1"></a>       <span class="at">main=</span><span class="st">&quot;Estimated LS line&quot;</span>, <span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">pch=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="fitted-or-predicted-values" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Fitted or Predicted Values<a href="reg.html#fitted-or-predicted-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To get fitted values <span class="math inline">\(\hat{y}_i = b_0 + b_1 x_i\)</span>, use:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="reg.html#cb20-1" tabindex="-1"></a><span class="fu">fitted.values</span>(toluca.fit)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 347.9820 169.4719 240.8760 383.6840 312.2800 276.5780 490.7901 347.9820 
##        9       10       11       12       13       14       15       16 
## 419.3861 240.8760 205.1739 312.2800 383.6840 133.7699 455.0881 419.3861 
##       17       18       19       20       21       22       23       24 
## 169.4719 240.8760 383.6840 455.0881 169.4719 383.6840 205.1739 347.9820 
##       25 
## 312.2800</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="reg.html#cb22-1" tabindex="-1"></a><span class="fu">predict</span>(toluca.fit)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 347.9820 169.4719 240.8760 383.6840 312.2800 276.5780 490.7901 347.9820 
##        9       10       11       12       13       14       15       16 
## 419.3861 240.8760 205.1739 312.2800 383.6840 133.7699 455.0881 419.3861 
##       17       18       19       20       21       22       23       24 
## 169.4719 240.8760 383.6840 455.0881 169.4719 383.6840 205.1739 347.9820 
##       25 
## 312.2800</code></pre>
<p>To predict values at new <span class="math inline">\(x\)</span> values (e.g., 31 and 119), use:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="reg.html#cb24-1" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xvar=</span><span class="fu">c</span>(<span class="dv">31</span>, <span class="dv">119</span>))</span>
<span id="cb24-2"><a href="reg.html#cb24-2" tabindex="-1"></a><span class="fu">predict</span>(toluca.fit, <span class="at">newdata=</span>newdat)</span></code></pre></div>
<pre><code>##        1        2 
## 173.0421 487.2199</code></pre>
</div>
<div id="residuals" class="section level3 hasAnchor" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Residuals<a href="reg.html#residuals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Residuals are the differences between observed and fitted values: <span class="math inline">\(e_i = y_i - \hat{y}_i\)</span>. Use <code>residuals()</code> on an <em>lm object</em>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="reg.html#cb26-1" tabindex="-1"></a><span class="fu">residuals</span>(toluca.fit)</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
##  51.0179798 -48.4719192 -19.8759596  -7.6840404  48.7200000 -52.5779798 
##           7           8           9          10          11          12 
##  55.2098990   4.0179798 -66.3860606 -83.8759596 -45.1739394 -60.2800000 
##          13          14          15          16          17          18 
##   5.3159596 -20.7698990 -20.0880808   0.6139394  42.5280808  27.1240404 
##          19          20          21          22          23          24 
##  -6.6840404 -34.0880808 103.5280808  84.3159596  38.8260606  -5.9820202 
##          25 
##  10.7200000</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="reg.html#cb28-1" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">residuals</span>(toluca.fit)</span></code></pre></div>
<p>Alternatively, compute them directly:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="reg.html#cb29-1" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">fitted.values</span>(toluca.fit)</span>
<span id="cb29-2"><a href="reg.html#cb29-2" tabindex="-1"></a>e <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>yvar <span class="sc">-</span> yhat</span></code></pre></div>
</div>
<div id="summary-output" class="section level3 hasAnchor" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> <code>summary()</code> Output<a href="reg.html#summary-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>summary()</code> of an <em>lm object</em> includes estimates, standard errors, test statistics, p-values, MSE, <span class="math inline">\(R^2\)</span>, and more.</p>
<div class="float">
<img src="ch3figures/summary.png" style="width:90.0%" alt="Figure 3.1" />
<div class="figcaption">Figure 3.1</div>
</div>
</div>
<div id="estimating-sigma2" class="section level3 hasAnchor" number="3.1.7">
<h3><span class="header-section-number">3.1.7</span> Estimating <span class="math inline">\(\sigma^2\)</span><a href="reg.html#estimating-sigma2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Estimate error variance using:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="reg.html#cb30-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb30-2"><a href="reg.html#cb30-2" tabindex="-1"></a><span class="fu">sum</span>(e<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">-</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 2383.716</code></pre>
<p>The <code>summary()</code> also provides <span class="math inline">\(\hat{\sigma} = \sqrt{MSE}\)</span>; here, <span class="math inline">\(\hat{\sigma}^2 = 48.82^2 = 2383.392\)</span>.</p>
</div>
</div>
<div id="inference-in-simple-linear-regression" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Inference in Simple Linear Regression<a href="reg.html#inference-in-simple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section covers inference on regression parameters, mean response, prediction intervals, ANOVA, and association using <strong>R</strong>.</p>
<div id="inferences-for-beta_0-and-beta_1" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Inferences for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span><a href="reg.html#inferences-for-beta_0-and-beta_1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We use the Toluca data to perform inference on slope and intercept. Although most attention focuses on <span class="math inline">\(\beta_1\)</span>, similar steps apply for <span class="math inline">\(\beta_0\)</span>.</p>
<p>Use <code>summary()</code> to obtain test statistics and p-values:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="reg.html#cb32-1" tabindex="-1"></a><span class="fu">summary</span>(toluca.fit)</span>
<span id="cb32-2"><a href="reg.html#cb32-2" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb32-3"><a href="reg.html#cb32-3" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb32-4"><a href="reg.html#cb32-4" tabindex="-1"></a><span class="do">## lm(formula = yvar ~ xvar, data = toluca.data)</span></span>
<span id="cb32-5"><a href="reg.html#cb32-5" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb32-6"><a href="reg.html#cb32-6" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb32-7"><a href="reg.html#cb32-7" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb32-8"><a href="reg.html#cb32-8" tabindex="-1"></a><span class="do">## -83.876 -34.088  -5.982  38.826 103.528 </span></span>
<span id="cb32-9"><a href="reg.html#cb32-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb32-10"><a href="reg.html#cb32-10" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb32-11"><a href="reg.html#cb32-11" tabindex="-1"></a><span class="do">##             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb32-12"><a href="reg.html#cb32-12" tabindex="-1"></a><span class="do">## (Intercept)   62.366     26.177   2.382   0.0259 *  </span></span>
<span id="cb32-13"><a href="reg.html#cb32-13" tabindex="-1"></a><span class="do">## xvar           3.570      0.347  10.290 4.45e-10 ***</span></span>
<span id="cb32-14"><a href="reg.html#cb32-14" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb32-15"><a href="reg.html#cb32-15" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb32-16"><a href="reg.html#cb32-16" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb32-17"><a href="reg.html#cb32-17" tabindex="-1"></a><span class="do">## Residual standard error: 48.82 on 23 degrees of freedom</span></span>
<span id="cb32-18"><a href="reg.html#cb32-18" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.8215, Adjusted R-squared:  0.8138 </span></span>
<span id="cb32-19"><a href="reg.html#cb32-19" tabindex="-1"></a><span class="do">## F-statistic: 105.9 on 1 and 23 DF,  p-value: 4.449e-10</span></span></code></pre></div>
<p><img src="ch3figures/summary.png" style="width:90.0%" /></p>
<p>From the output, we get <span class="math inline">\(b_1\)</span> and <span class="math inline">\(b_0\)</span>, their standard errors, and t-values.</p>
<p>You can also compute <span class="math inline">\(t = b_1 / s\{b_1\}\)</span> manually:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="reg.html#cb33-1" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> <span class="fu">sum</span>(e<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb33-2"><a href="reg.html#cb33-2" tabindex="-1"></a>sd.b1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(MSE <span class="sc">/</span> <span class="fu">sum</span>((myx <span class="sc">-</span> <span class="fu">mean</span>(<span class="sc">~</span>myx))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb33-3"><a href="reg.html#cb33-3" tabindex="-1"></a>t.star <span class="ot">&lt;-</span> b<span class="fl">.1</span> <span class="sc">/</span> sd.b1</span>
<span id="cb33-4"><a href="reg.html#cb33-4" tabindex="-1"></a>t.star</span>
<span id="cb33-5"><a href="reg.html#cb33-5" tabindex="-1"></a><span class="do">## [1] 10.28959</span></span></code></pre></div>
<p>Under <span class="math inline">\(H_0\)</span>, the test statistic follows <span class="math inline">\(t_{n-2}\)</span>.</p>
<p>To compute p-values:
- For <span class="math inline">\(H_a: \beta &gt; 0\)</span>, use:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="reg.html#cb34-1" tabindex="-1"></a><span class="fu">xpt</span>(<span class="at">q =</span> <span class="fl">10.290</span>, <span class="at">df =</span> n <span class="sc">-</span> <span class="dv">2</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-19-1.png" width="528" /></p>
<pre><code>## [1] 2.222735e-10</code></pre>
<ul>
<li>For <span class="math inline">\(H_a: \beta &lt; 0\)</span>:</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="reg.html#cb36-1" tabindex="-1"></a><span class="fu">xpt</span>(<span class="at">q =</span> <span class="fl">10.290</span>, <span class="at">df =</span> n <span class="sc">-</span> <span class="dv">2</span>, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-20-1.png" width="528" /></p>
<pre><code>## [1] 1</code></pre>
<ul>
<li>For <span class="math inline">\(H_a: \beta \ne 0\)</span>:
<span class="math display">\[2 \times P(t_{n-2} &gt; |10.290|) = .0000000004\]</span></li>
</ul>
</div>
<div id="confidence-interval-for-beta_1" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Confidence Interval for <span class="math inline">\(\beta_1\)</span><a href="reg.html#confidence-interval-for-beta_1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The CI formula is:
<span class="math display">\[
b_1 \pm t_{1-\alpha/2, n-2} s\{b_1\}
\]</span></p>
<p>To compute <span class="math inline">\(t_{1 - .05/2, 23}\)</span>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="reg.html#cb38-1" tabindex="-1"></a><span class="fu">xqt</span>(<span class="dv">1</span> <span class="sc">-</span> .<span class="dv">05</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">df =</span> n <span class="sc">-</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-21-1.png" width="528" /></p>
<pre><code>## [1] 2.068658</code></pre>
<p>Then compute bounds:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="reg.html#cb40-1" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">3.570</span></span>
<span id="cb40-2"><a href="reg.html#cb40-2" tabindex="-1"></a>sb1 <span class="ot">&lt;-</span> <span class="fl">0.347</span></span>
<span id="cb40-3"><a href="reg.html#cb40-3" tabindex="-1"></a></span>
<span id="cb40-4"><a href="reg.html#cb40-4" tabindex="-1"></a>b1 <span class="sc">-</span> <span class="fl">2.069</span> <span class="sc">*</span> sb1</span>
<span id="cb40-5"><a href="reg.html#cb40-5" tabindex="-1"></a><span class="do">## [1] 2.852057</span></span>
<span id="cb40-6"><a href="reg.html#cb40-6" tabindex="-1"></a>b1 <span class="sc">+</span> <span class="fl">2.069</span> <span class="sc">*</span> sb1</span>
<span id="cb40-7"><a href="reg.html#cb40-7" tabindex="-1"></a><span class="do">## [1] 4.287943</span></span></code></pre></div>
<p>Or use <code>confint()</code>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="reg.html#cb41-1" tabindex="-1"></a><span class="fu">confint</span>(toluca.fit, <span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb41-2"><a href="reg.html#cb41-2" tabindex="-1"></a><span class="do">##                2.5 %     97.5 %</span></span>
<span id="cb41-3"><a href="reg.html#cb41-3" tabindex="-1"></a><span class="do">## (Intercept) 8.213711 116.518006</span></span>
<span id="cb41-4"><a href="reg.html#cb41-4" tabindex="-1"></a><span class="do">## xvar        2.852435   4.287969</span></span></code></pre></div>
<pre><code>

### CI for the Mean Response ($E(y_h)$) and a Prediction Interval for $y_h$

To compute a CI for $E(y_h)$ at $x_h = 100$, use `predict()` with arguments `interval = &quot;confidence&quot;` and the desired level:

``` r
X.new &lt;- data.frame(xvar = c(100))
predict.lm(toluca.fit, newdata = X.new, interval = &quot;confidence&quot;, level = 0.90)</code></pre>
<pre><code>##        fit      lwr     upr
## 1 419.3861 394.9251 443.847</code></pre>
<p>To get a prediction interval for a new <span class="math inline">\(y_h\)</span> at <span class="math inline">\(x_h = 100\)</span>, change <code>interval</code> to <code>"prediction"</code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="reg.html#cb44-1" tabindex="-1"></a><span class="fu">predict.lm</span>(toluca.fit, <span class="at">newdata =</span> X.new, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>, <span class="at">level =</span> <span class="fl">0.90</span>)</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 419.3861 332.2072 506.5649</code></pre>
</div>
<div id="anova-for-regression" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> ANOVA for Regression<a href="reg.html#anova-for-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use <code>anova()</code> on the <em>lm object</em> to get the ANOVA table:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="reg.html#cb46-1" tabindex="-1"></a><span class="fu">anova</span>(toluca.fit)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: yvar
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## xvar       1 252378  252378  105.88 4.449e-10 ***
## Residuals 23  54825    2384                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><img src="ch3figures/anova.png" style="width:90.0%" /></p>
<p>To compute the F-test p-value manually:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="reg.html#cb48-1" tabindex="-1"></a><span class="fu">xpf</span>(<span class="at">q =</span> <span class="fl">105.88</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">25</span> <span class="sc">-</span> <span class="dv">2</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## [1] 4.44711e-10</code></pre>
</div>
<div id="measures-of-association" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Measures of Association<a href="reg.html#measures-of-association" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can compute <span class="math inline">\(R^2\)</span> and <span class="math inline">\(r\)</span> from the ANOVA table or directly:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="reg.html#cb50-1" tabindex="-1"></a>yresp <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>yvar</span>
<span id="cb50-2"><a href="reg.html#cb50-2" tabindex="-1"></a>xpred <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>xvar</span>
<span id="cb50-3"><a href="reg.html#cb50-3" tabindex="-1"></a></span>
<span id="cb50-4"><a href="reg.html#cb50-4" tabindex="-1"></a>SSR <span class="ot">&lt;-</span> b<span class="fl">.1</span><span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>((xpred <span class="sc">-</span> <span class="fu">mean</span>(xpred))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb50-5"><a href="reg.html#cb50-5" tabindex="-1"></a>SSTO <span class="ot">&lt;-</span> <span class="fu">sum</span>((yresp <span class="sc">-</span> <span class="fu">mean</span>(yresp))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb50-6"><a href="reg.html#cb50-6" tabindex="-1"></a>R.sq <span class="ot">&lt;-</span> SSR <span class="sc">/</span> SSTO</span>
<span id="cb50-7"><a href="reg.html#cb50-7" tabindex="-1"></a>R.sq</span></code></pre></div>
<pre><code>## [1] 0.8215335</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="reg.html#cb52-1" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(R.sq)  <span class="co"># sign(b.1) is positive</span></span></code></pre></div>
</div>
<div id="residual-analysis-and-remedial-measures" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Residual Analysis and Remedial Measures<a href="reg.html#residual-analysis-and-remedial-measures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We assess model assumptions using residual plots. For SLR, if <span class="math inline">\(\varepsilon_i \sim N(0, \sigma^2)\)</span>, residuals <span class="math inline">\(e_i\)</span> should reflect this.</p>
<table>
<thead>
<tr class="header">
<th>Assumption</th>
<th>Plot Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Normality</td>
<td>QQ-plot</td>
</tr>
<tr class="even">
<td>Independence</td>
<td>Residuals vs. <span class="math inline">\(x\)</span> or <span class="math inline">\(\hat{y}\)</span></td>
</tr>
<tr class="odd">
<td>Constant variance</td>
<td>Residuals vs. <span class="math inline">\(x\)</span> or <span class="math inline">\(\hat{y}\)</span></td>
</tr>
<tr class="even">
<td>Linearity</td>
<td>Residuals vs. <span class="math inline">\(x\)</span> or <span class="math inline">\(\hat{y}\)</span></td>
</tr>
<tr class="odd">
<td>Outliers</td>
<td>Residuals vs. <span class="math inline">\(x\)</span>; QQ-plot</td>
</tr>
</tbody>
</table>
<p>If normality is not assumed, still check the QQ-plot for heavy tails.</p>
</div>
<div id="creating-residual-plots" class="section level3 hasAnchor" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Creating Residual Plots<a href="reg.html#creating-residual-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use <code>xyplot()</code> and <code>xqqmath()</code> for diagnostics:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="reg.html#cb53-1" tabindex="-1"></a>tolucafitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(toluca.fit)</span>
<span id="cb53-2"><a href="reg.html#cb53-2" tabindex="-1"></a>tolresids <span class="ot">&lt;-</span> <span class="fu">residuals</span>(toluca.fit)</span>
<span id="cb53-3"><a href="reg.html#cb53-3" tabindex="-1"></a></span>
<span id="cb53-4"><a href="reg.html#cb53-4" tabindex="-1"></a><span class="fu">xyplot</span>(tolresids <span class="sc">~</span> xvar, <span class="at">data=</span>toluca.data, <span class="at">main=</span><span class="st">&quot;Residuals vs x&quot;</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="reg.html#cb54-1" tabindex="-1"></a><span class="fu">xyplot</span>(tolresids <span class="sc">~</span> tolucafitted, <span class="at">data=</span>toluca.data, <span class="at">main=</span><span class="st">&quot;Residuals vs fitted&quot;</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-29-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="reg.html#cb55-1" tabindex="-1"></a><span class="fu">xqqmath</span>(<span class="sc">~</span> tolresids, <span class="at">distribution =</span> <span class="st">&quot;qnorm&quot;</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-29-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>Optional: explore other summaries of residuals:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="reg.html#cb56-1" tabindex="-1"></a><span class="fu">gf_boxplot</span>(<span class="sc">~</span> tolresids, <span class="at">main=</span><span class="st">&quot;Boxplot of residuals&quot;</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-30-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="reg.html#cb57-1" tabindex="-1"></a><span class="fu">histogram</span>(<span class="sc">~</span> tolresids)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-30-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="residual-plots-from-the-tactile-package" class="section level3 hasAnchor" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> Residual Plots from the <code>tactile</code> Package<a href="reg.html#residual-plots-from-the-tactile-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>tactile</code> package extends <code>xyplot()</code> to automatically generate residual diagnostics from an <em>lm object</em>. For SLR, it includes:</p>
<ul>
<li><strong>Residuals vs. fitted values</strong>: Checks for independence, constant variance, and linearity. No trend or pattern suggests assumptions are met.</li>
<li><strong>Normal QQ-plot</strong>: Assesses normality; residuals should align with the diagonal.</li>
<li><strong>Standardized residuals vs. fitted values</strong> (scale-location plot): Also checks variance and linearity.</li>
<li><strong>Residuals vs. leverage</strong>: Identifies influential points. High leverage + large residuals = outliers.</li>
</ul>
</div>
<div id="testing-for-departures-from-normality" class="section level3 hasAnchor" number="3.2.8">
<h3><span class="header-section-number">3.2.8</span> Testing for Departures from Normality<a href="reg.html#testing-for-departures-from-normality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the Shapiro-Wilk and Lilliefors tests to assess if residuals depart from normality. The null hypothesis is normality.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="reg.html#cb58-1" tabindex="-1"></a><span class="fu">shapiro.test</span>(tolresids)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  tolresids
## W = 0.9789, p-value = 0.8626</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="reg.html#cb60-1" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&quot;nortest&quot;</span>)</span>
<span id="cb60-2"><a href="reg.html#cb60-2" tabindex="-1"></a><span class="fu">lillie.test</span>(tolresids)</span></code></pre></div>
<pre><code>## 
##  Lilliefors (Kolmogorov-Smirnov) normality test
## 
## data:  tolresids
## D = 0.09572, p-value = 0.8027</code></pre>
<p>If p-values are large, there’s no strong evidence against normality.</p>
</div>
<div id="transformations" class="section level3 hasAnchor" number="3.2.9">
<h3><span class="header-section-number">3.2.9</span> Transformations<a href="reg.html#transformations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Transforming the response or predictor can help address violations of model assumptions. Use <code>mutate()</code> from the <code>dplyr</code> package (loaded with <code>mosaic</code>) to create transformed variables:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="reg.html#cb62-1" tabindex="-1"></a><span class="fu">glimpse</span>(toluca.data)</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 2
## $ xvar &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 10…
## $ yvar &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389, …</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="reg.html#cb64-1" tabindex="-1"></a><span class="co"># Apply square root to y</span></span>
<span id="cb64-2"><a href="reg.html#cb64-2" tabindex="-1"></a>toluca.dataVer1 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(toluca.data, <span class="at">sqrty =</span> <span class="fu">sqrt</span>(yvar))</span>
<span id="cb64-3"><a href="reg.html#cb64-3" tabindex="-1"></a><span class="fu">glimpse</span>(toluca.dataVer1)</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 3
## $ xvar  &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 1…
## $ yvar  &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389,…
## $ sqrty &lt;dbl&gt; 19.97498, 11.00000, 14.86607, 19.39072, 19.00000, 14.96663, 23.3…</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="reg.html#cb66-1" tabindex="-1"></a><span class="co"># Apply log to x</span></span>
<span id="cb66-2"><a href="reg.html#cb66-2" tabindex="-1"></a>toluca.dataVer2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(toluca.dataVer1, <span class="at">lnx =</span> <span class="fu">log</span>(xvar))</span>
<span id="cb66-3"><a href="reg.html#cb66-3" tabindex="-1"></a><span class="fu">glimpse</span>(toluca.dataVer2)</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 4
## $ xvar  &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 1…
## $ yvar  &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389,…
## $ sqrty &lt;dbl&gt; 19.97498, 11.00000, 14.86607, 19.39072, 19.00000, 14.96663, 23.3…
## $ lnx   &lt;dbl&gt; 4.382027, 3.401197, 3.912023, 4.499810, 4.248495, 4.094345, 4.78…</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="reg.html#cb68-1" tabindex="-1"></a><span class="co"># Multiple transformations</span></span>
<span id="cb68-2"><a href="reg.html#cb68-2" tabindex="-1"></a>toluca.dataWithTrans <span class="ot">&lt;-</span> <span class="fu">mutate</span>(toluca.data,</span>
<span id="cb68-3"><a href="reg.html#cb68-3" tabindex="-1"></a>  <span class="at">sqrty =</span> <span class="fu">sqrt</span>(yvar), <span class="at">lnx =</span> <span class="fu">log</span>(xvar),</span>
<span id="cb68-4"><a href="reg.html#cb68-4" tabindex="-1"></a>  <span class="at">lny =</span> <span class="fu">log</span>(yvar), <span class="at">sqrd =</span> yvar<span class="sc">^</span><span class="dv">2</span>, <span class="at">cubertx =</span> xvar<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb68-5"><a href="reg.html#cb68-5" tabindex="-1"></a><span class="fu">glimpse</span>(toluca.dataWithTrans)</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 7
## $ xvar    &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110,…
## $ yvar    &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 38…
## $ sqrty   &lt;dbl&gt; 19.97498, 11.00000, 14.86607, 19.39072, 19.00000, 14.96663, 23…
## $ lnx     &lt;dbl&gt; 4.382027, 3.401197, 3.912023, 4.499810, 4.248495, 4.094345, 4.…
## $ lny     &lt;dbl&gt; 5.988961, 4.795791, 5.398163, 5.929589, 5.888878, 5.411646, 6.…
## $ sqrd    &lt;dbl&gt; 159201, 14641, 48841, 141376, 130321, 50176, 298116, 123904, 1…
## $ cubertx &lt;dbl&gt; 4.308869, 3.107233, 3.684031, 4.481405, 4.121285, 3.914868, 4.…</code></pre>
<p>Visualize and fit models using transformed variables:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="reg.html#cb70-1" tabindex="-1"></a><span class="fu">xyplot</span>(sqrty <span class="sc">~</span> xvar, <span class="at">data =</span> toluca.dataWithTrans, <span class="at">main =</span> <span class="st">&quot;Square root of y vs x&quot;</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="reg.html#cb71-1" tabindex="-1"></a><span class="fu">xyplot</span>(sqrty <span class="sc">~</span> lnx, <span class="at">data =</span> toluca.dataWithTrans, <span class="at">main =</span> <span class="st">&quot;Square root of y vs ln(x)&quot;</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-33-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="reg.html#cb72-1" tabindex="-1"></a>toluca.fitA <span class="ot">&lt;-</span> <span class="fu">lm</span>(sqrty <span class="sc">~</span> xvar, <span class="at">data =</span> toluca.dataWithTrans)</span>
<span id="cb72-2"><a href="reg.html#cb72-2" tabindex="-1"></a>toluca.fitA</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sqrty ~ xvar, data = toluca.dataWithTrans)
## 
## Coefficients:
## (Intercept)         xvar  
##      9.9722       0.1055</code></pre>
</div>
<div id="f-test-for-lack-of-fit" class="section level3 hasAnchor" number="3.2.10">
<h3><span class="header-section-number">3.2.10</span> F-Test for Lack of Fit<a href="reg.html#f-test-for-lack-of-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The lack-of-fit test requires repeated <span class="math inline">\(x\)</span> values. It compares:</p>
<ul>
<li><strong>Full model</strong>: <span class="math inline">\(Y_{ij} = \mu_j + \varepsilon_{ij}\)</span></li>
<li><strong>Reduced model</strong>: <span class="math inline">\(Y_{ij} = \beta_0 + \beta_1 X_j + \varepsilon_{ij}\)</span></li>
</ul>
<p>If models are nested, use <code>anova()</code> to compare them:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="reg.html#cb74-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%203%20Data%20Sets/CH03TA04.txt&quot;</span></span>
<span id="cb74-2"><a href="reg.html#cb74-2" tabindex="-1"></a>bank.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb74-3"><a href="reg.html#cb74-3" tabindex="-1"></a></span>
<span id="cb74-4"><a href="reg.html#cb74-4" tabindex="-1"></a><span class="fu">glimpse</span>(bank.data)</span></code></pre></div>
<pre><code>## Rows: 11
## Columns: 2
## $ x &lt;int&gt; 125, 100, 200, 75, 150, 175, 75, 175, 125, 200, 100
## $ y &lt;int&gt; 160, 112, 124, 28, 152, 156, 42, 124, 150, 104, 136</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="reg.html#cb76-1" tabindex="-1"></a><span class="co"># Convert x to factor for full model</span></span>
<span id="cb76-2"><a href="reg.html#cb76-2" tabindex="-1"></a>bank.dataUD <span class="ot">&lt;-</span> <span class="fu">mutate</span>(bank.data, <span class="at">xfac =</span> <span class="fu">as.factor</span>(x))</span>
<span id="cb76-3"><a href="reg.html#cb76-3" tabindex="-1"></a></span>
<span id="cb76-4"><a href="reg.html#cb76-4" tabindex="-1"></a>levels.x <span class="ot">&lt;-</span> <span class="fu">levels</span>(bank.dataUD<span class="sc">$</span>xfac)</span>
<span id="cb76-5"><a href="reg.html#cb76-5" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb76-6"><a href="reg.html#cb76-6" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb76-7"><a href="reg.html#cb76-7" tabindex="-1"></a>n <span class="sc">-</span> c</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="reg.html#cb78-1" tabindex="-1"></a>fit.bank.full <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> xfac, <span class="at">data =</span> bank.dataUD)</span>
<span id="cb78-2"><a href="reg.html#cb78-2" tabindex="-1"></a>fit.bank.reduced <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> bank.dataUD)</span>
<span id="cb78-3"><a href="reg.html#cb78-3" tabindex="-1"></a></span>
<span id="cb78-4"><a href="reg.html#cb78-4" tabindex="-1"></a><span class="fu">anova</span>(fit.bank.reduced, fit.bank.full, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: y ~ x
## Model 2: y ~ xfac
##   Res.Df   RSS Df Sum of Sq      F   Pr(&gt;F)   
## 1      9 14742                                
## 2      5  1148  4     13594 14.801 0.005594 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><img src="ch3figures/lof.png" style="width:95.0%" /></p>
</div>
<div id="least-absolute-deviation-lad-regression" class="section level3 hasAnchor" number="3.2.11">
<h3><span class="header-section-number">3.2.11</span> Least Absolute Deviation (LAD) Regression<a href="reg.html#least-absolute-deviation-lad-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Least squares estimation assumes valid model assumptions. When these fail, least squares can mislead. LAD regression minimizes absolute residuals, making it more robust to outliers.</p>
<p>Diagnostic plots can be helpful but may be inconclusive. Robust regression methods, like LAD, offer alternatives that are less sensitive to violations of assumptions and outliers.</p>
</div>
</div>
<div id="the-matrix-approach-to-simple-linear-regression" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> The Matrix Approach to Simple Linear Regression<a href="reg.html#the-matrix-approach-to-simple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="creating-a-matrix" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Creating a Matrix<a href="reg.html#creating-a-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use <code>c()</code> to create vectors:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="reg.html#cb80-1" tabindex="-1"></a>xvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)</span>
<span id="cb80-2"><a href="reg.html#cb80-2" tabindex="-1"></a>xvec[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="reg.html#cb82-1" tabindex="-1"></a>xvec[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>Create matrices using <code>matrix()</code>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="reg.html#cb84-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb84-2"><a href="reg.html#cb84-2" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> a, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb84-3"><a href="reg.html#cb84-3" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> a, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-4"><a href="reg.html#cb84-4" tabindex="-1"></a>A</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="reg.html#cb86-1" tabindex="-1"></a>B</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6</code></pre>
</div>
<div id="matrix-operations" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Matrix Operations<a href="reg.html#matrix-operations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Key matrix operations in R:</p>
<table>
<thead>
<tr class="header">
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>%*%</code></td>
<td>Matrix multiplication</td>
</tr>
<tr class="even">
<td><code>t()</code></td>
<td>Transpose</td>
</tr>
<tr class="odd">
<td><code>solve()</code></td>
<td>Inverse of a matrix</td>
</tr>
<tr class="even">
<td><code>*</code></td>
<td>Element-wise multiplication</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="reg.html#cb88-1" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">8</span>, <span class="dv">26</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">10</span>), <span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb88-2"><a href="reg.html#cb88-2" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>), <span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb88-3"><a href="reg.html#cb88-3" tabindex="-1"></a></span>
<span id="cb88-4"><a href="reg.html#cb88-4" tabindex="-1"></a>C <span class="sc">%*%</span> D</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]  -12  -18  -24
## [2,]  276  378  480
## [3,]  129  174  219</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="reg.html#cb90-1" tabindex="-1"></a><span class="fu">t</span>(C)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    1
## [2,]   -8   26    4
## [3,]    5    6   10</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="reg.html#cb92-1" tabindex="-1"></a>C <span class="sc">*</span> D</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    7  -80   65
## [2,]   16  286   84
## [3,]    9   48  150</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="reg.html#cb94-1" tabindex="-1"></a><span class="fu">solve</span>(C)</span></code></pre></div>
<pre><code>##             [,1]        [,2]        [,3]
## [1,]  0.91472868  0.38759690 -0.68992248
## [2,] -0.05426357  0.01937984  0.01550388
## [3,] -0.06976744 -0.04651163  0.16279070</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="reg.html#cb96-1" tabindex="-1"></a>C <span class="sc">+</span> D</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    8    2   18
## [2,]   10   37   20
## [3,]   10   16   25</code></pre>
</div>
<div id="ls-estimation" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> LS Estimation<a href="reg.html#ls-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>SLR model in matrix form:
<span class="math display">\[
\boldsymbol{Y} = \boldsymbol{X}\boldsymbol{\beta} + \boldsymbol{\varepsilon}
\]</span></p>
<p>Where:
- <span class="math inline">\(\boldsymbol{Y}\)</span>: <span class="math inline">\(n \times 1\)</span> response vector
- <span class="math inline">\(\boldsymbol{X}\)</span>: <span class="math inline">\(n \times 2\)</span> matrix (intercept and <span class="math inline">\(x\)</span>)
- <span class="math inline">\(\boldsymbol{\beta}\)</span>: <span class="math inline">\(2 \times 1\)</span> vector (<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span>)</p>
<p>Set up the data:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="reg.html#cb98-1" tabindex="-1"></a><span class="fu">glimpse</span>(toluca.data)</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 2
## $ xvar &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 10…
## $ yvar &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389, …</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="reg.html#cb100-1" tabindex="-1"></a>hrs <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>yvar</span>
<span id="cb100-2"><a href="reg.html#cb100-2" tabindex="-1"></a>lotsize <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>xvar</span>
<span id="cb100-3"><a href="reg.html#cb100-3" tabindex="-1"></a></span>
<span id="cb100-4"><a href="reg.html#cb100-4" tabindex="-1"></a>yvec <span class="ot">&lt;-</span> <span class="fu">matrix</span>(hrs, <span class="at">nrow =</span> <span class="dv">25</span>)</span>
<span id="cb100-5"><a href="reg.html#cb100-5" tabindex="-1"></a>ones <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">25</span>)</span>
<span id="cb100-6"><a href="reg.html#cb100-6" tabindex="-1"></a>Xmat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ones, lotsize)</span></code></pre></div>
<p>Compute LS estimates:
<span class="math display">\[
\boldsymbol{b} = (\boldsymbol{X}^T\boldsymbol{X})^{-1}\boldsymbol{X}^T \boldsymbol{y}
\]</span></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="reg.html#cb101-1" tabindex="-1"></a>XmatTxmat <span class="ot">&lt;-</span> <span class="fu">t</span>(Xmat) <span class="sc">%*%</span> Xmat</span>
<span id="cb101-2"><a href="reg.html#cb101-2" tabindex="-1"></a>best <span class="ot">&lt;-</span> <span class="fu">solve</span>(XmatTxmat) <span class="sc">%*%</span> <span class="fu">t</span>(Xmat) <span class="sc">%*%</span> yvec</span>
<span id="cb101-3"><a href="reg.html#cb101-3" tabindex="-1"></a>best</span></code></pre></div>
<pre><code>##              [,1]
## ones    62.365859
## lotsize  3.570202</code></pre>
<p>Fitted values <span class="math inline">\(\hat{\boldsymbol{y}} = \boldsymbol{X} \boldsymbol{b}\)</span>:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="reg.html#cb103-1" tabindex="-1"></a>Xmat <span class="sc">%*%</span> best</span></code></pre></div>
<pre><code>##           [,1]
##  [1,] 347.9820
##  [2,] 169.4719
##  [3,] 240.8760
##  [4,] 383.6840
##  [5,] 312.2800
##  [6,] 276.5780
##  [7,] 490.7901
##  [8,] 347.9820
##  [9,] 419.3861
## [10,] 240.8760
## [11,] 205.1739
## [12,] 312.2800
## [13,] 383.6840
## [14,] 133.7699
## [15,] 455.0881
## [16,] 419.3861
## [17,] 169.4719
## [18,] 240.8760
## [19,] 383.6840
## [20,] 455.0881
## [21,] 169.4719
## [22,] 383.6840
## [23,] 205.1739
## [24,] 347.9820
## [25,] 312.2800</code></pre>
<p>Alternatively, use the hat matrix:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="reg.html#cb105-1" tabindex="-1"></a>Hatmat <span class="ot">&lt;-</span> Xmat <span class="sc">%*%</span> <span class="fu">solve</span>(XmatTxmat) <span class="sc">%*%</span> <span class="fu">t</span>(Xmat)</span>
<span id="cb105-2"><a href="reg.html#cb105-2" tabindex="-1"></a>Hatmat <span class="sc">%*%</span> yvec</span></code></pre></div>
<pre><code>##           [,1]
##  [1,] 347.9820
##  [2,] 169.4719
##  [3,] 240.8760
##  [4,] 383.6840
##  [5,] 312.2800
##  [6,] 276.5780
##  [7,] 490.7901
##  [8,] 347.9820
##  [9,] 419.3861
## [10,] 240.8760
## [11,] 205.1739
## [12,] 312.2800
## [13,] 383.6840
## [14,] 133.7699
## [15,] 455.0881
## [16,] 419.3861
## [17,] 169.4719
## [18,] 240.8760
## [19,] 383.6840
## [20,] 455.0881
## [21,] 169.4719
## [22,] 383.6840
## [23,] 205.1739
## [24,] 347.9820
## [25,] 312.2800</code></pre>
</div>
</div>
<div id="multiple-linear-regression-mlr" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Multiple Linear Regression (MLR)<a href="reg.html#multiple-linear-regression-mlr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We consider the MLR model:
<span class="math display">\[
Y_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots + \beta_p x_{i,p-1} + \varepsilon_i
\]</span>
where <span class="math inline">\(\varepsilon_i \overset{iid}{\sim} N(0, \sigma^2)\)</span>. We illustrate fitting the model using <strong>R</strong> and the Dwaine Studios example from ALRM.</p>
<p>Although the model can be expressed in matrix form, we’ll use <code>lm()</code> and <code>anova()</code> for analysis.</p>
<div id="least-squares-estimates" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Least Squares Estimates<a href="reg.html#least-squares-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Import the data:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="reg.html#cb107-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%206%20Data%20Sets/CH06FI05.txt&quot;</span></span>
<span id="cb107-2"><a href="reg.html#cb107-2" tabindex="-1"></a>dwaine.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">col.names=</span><span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb107-3"><a href="reg.html#cb107-3" tabindex="-1"></a><span class="fu">glimpse</span>(dwaine.data)</span></code></pre></div>
<pre><code>## Rows: 21
## Columns: 3
## $ x1 &lt;dbl&gt; 68.5, 45.2, 91.3, 47.8, 46.9, 66.1, 49.5, 52.0, 48.9, 38.4, 87.9, 7…
## $ x2 &lt;dbl&gt; 16.7, 16.8, 18.2, 16.3, 17.3, 18.2, 15.9, 17.2, 16.6, 16.0, 18.3, 1…
## $ y  &lt;dbl&gt; 174.4, 164.4, 244.2, 154.6, 181.6, 207.5, 152.8, 163.2, 145.4, 137.…</code></pre>
<p>Matrix approach:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="reg.html#cb109-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">21</span></span>
<span id="cb109-2"><a href="reg.html#cb109-2" tabindex="-1"></a>Xmat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, dwaine.data<span class="sc">$</span>x1, dwaine.data<span class="sc">$</span>x2)</span>
<span id="cb109-3"><a href="reg.html#cb109-3" tabindex="-1"></a>yrespvec <span class="ot">&lt;-</span> <span class="fu">matrix</span>(dwaine.data<span class="sc">$</span>y, <span class="at">nrow =</span> n)</span>
<span id="cb109-4"><a href="reg.html#cb109-4" tabindex="-1"></a></span>
<span id="cb109-5"><a href="reg.html#cb109-5" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(Xmat) <span class="sc">%*%</span> Xmat) <span class="sc">%*%</span> <span class="fu">t</span>(Xmat) <span class="sc">%*%</span> yrespvec</span>
<span id="cb109-6"><a href="reg.html#cb109-6" tabindex="-1"></a>b</span></code></pre></div>
<pre><code>##           [,1]
## [1,] -68.85707
## [2,]   1.45456
## [3,]   9.36550</code></pre>
<p>Fit MLR using <code>lm()</code>:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="reg.html#cb111-1" tabindex="-1"></a>dwaine.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> dwaine.data)</span>
<span id="cb111-2"><a href="reg.html#cb111-2" tabindex="-1"></a>dwaine.fit</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2, data = dwaine.data)
## 
## Coefficients:
## (Intercept)           x1           x2  
##     -68.857        1.455        9.366</code></pre>
</div>
<div id="fitted-values-anova-table-and-residuals" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Fitted Values, ANOVA Table, and Residuals<a href="reg.html#fitted-values-anova-table-and-residuals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Extract LS estimates:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="reg.html#cb113-1" tabindex="-1"></a><span class="fu">coef</span>(dwaine.fit)</span></code></pre></div>
<pre><code>## (Intercept)          x1          x2 
##   -68.85707     1.45456     9.36550</code></pre>
<p>Get fitted values and residuals:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="reg.html#cb115-1" tabindex="-1"></a><span class="fu">fitted</span>(dwaine.fit)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 187.1841 154.2294 234.3963 153.3285 161.3849 197.7414 152.0551 167.8666 
##        9       10       11       12       13       14       15       16 
## 157.7382 136.8460 230.3874 197.1849 222.6857 141.5184 174.2132 228.1239 
##       17       18       19       20       21 
## 145.7470 159.0013 230.9870 230.3161 157.0644</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="reg.html#cb117-1" tabindex="-1"></a><span class="fu">residuals</span>(dwaine.fit)</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
## -12.7841146  10.1705737   9.8036764   1.2714690  20.2150722   9.7585779 
##           7           8           9          10          11          12 
##   0.7449178  -4.6666316 -12.3381967   0.3539791  11.5126289  -6.0849209 
##          13          14          15          16          17          18 
##   9.3142995   3.7815611 -13.1132116 -18.4238900   0.6530062 -15.0013134 
##          19          20          21 
##   1.6129777  -6.2160615   9.4356009</code></pre>
<p>Get ANOVA table:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="reg.html#cb119-1" tabindex="-1"></a><span class="fu">anova</span>(dwaine.fit)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: y
##           Df  Sum Sq Mean Sq  F value   Pr(&gt;F)    
## x1         1 23371.8 23371.8 192.8962 4.64e-11 ***
## x2         1   643.5   643.5   5.3108  0.03332 *  
## Residuals 18  2180.9   121.2                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><img src="ch3figures/anovach6.png" style="width:100.0%" /></p>
<p>This table decomposes <span class="math inline">\(SSR(X_1, X_2)\)</span> into <span class="math inline">\(SSR(X_1) + SSR(X_2 \mid X_1)\)</span>.</p>
</div>
<div id="inference-on-regression-parameters" class="section level3 hasAnchor" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Inference on Regression Parameters<a href="reg.html#inference-on-regression-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Summarize the model:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="reg.html#cb121-1" tabindex="-1"></a><span class="fu">summary</span>(dwaine.fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2, data = dwaine.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -18.4239  -6.2161   0.7449   9.4356  20.2151 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -68.8571    60.0170  -1.147   0.2663    
## x1            1.4546     0.2118   6.868    2e-06 ***
## x2            9.3655     4.0640   2.305   0.0333 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.01 on 18 degrees of freedom
## Multiple R-squared:  0.9167, Adjusted R-squared:  0.9075 
## F-statistic:  99.1 on 2 and 18 DF,  p-value: 1.921e-10</code></pre>
<p><img src="ch3figures/summarych6.png" style="width:100.0%" /></p>
<p>The output gives <span class="math inline">\(F^*\)</span> for testing <span class="math inline">\(\beta_1 = \beta_2 = 0\)</span> and <span class="math inline">\(t^*\)</span> for individual parameters.</p>
</div>
<div id="mean-response-and-prediction-intervals" class="section level3 hasAnchor" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> Mean Response and Prediction Intervals<a href="reg.html#mean-response-and-prediction-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To get a 95% CI for expected sales when <span class="math inline">\(x_1 = 65.4\)</span> and <span class="math inline">\(x_2 = 17.6\)</span>:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="reg.html#cb123-1" tabindex="-1"></a>new.x.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> <span class="fl">65.4</span>, <span class="at">x2 =</span> <span class="fl">17.6</span>)</span>
<span id="cb123-2"><a href="reg.html#cb123-2" tabindex="-1"></a><span class="fu">predict</span>(dwaine.fit, <span class="at">newdata =</span> new.x.data, <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 191.1039 185.2911 196.9168</code></pre>
<p>To get a 95% prediction interval at the same values:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="reg.html#cb125-1" tabindex="-1"></a><span class="fu">predict</span>(dwaine.fit, <span class="at">newdata =</span> new.x.data, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##        fit      lwr     upr
## 1 191.1039 167.2589 214.949</code></pre>
<p>To predict for two cities:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="reg.html#cb127-1" tabindex="-1"></a>new.x.data2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="fl">65.4</span>, <span class="fl">53.1</span>), <span class="at">x2 =</span> <span class="fu">c</span>(<span class="fl">17.6</span>, <span class="fl">17.7</span>))</span>
<span id="cb127-2"><a href="reg.html#cb127-2" tabindex="-1"></a><span class="fu">predict.lm</span>(dwaine.fit, <span class="at">newdata =</span> new.x.data2, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 191.1039 167.2589 214.9490
## 2 174.1494 149.0867 199.2121</code></pre>
</div>
<div id="diagnostics" class="section level3 hasAnchor" number="3.4.5">
<h3><span class="header-section-number">3.4.5</span> Diagnostics<a href="reg.html#diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Diagnostics in MLR follow the same procedures as in SLR: QQ-plots, residuals vs. fitted values, and residuals vs. predictors. We now also use scatterplot and correlation matrices:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="reg.html#cb129-1" tabindex="-1"></a><span class="fu">splom</span>(dwaine.data)     <span class="co"># Scatterplot matrix</span></span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-52-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="reg.html#cb130-1" tabindex="-1"></a><span class="fu">cor</span>(dwaine.data)       <span class="co"># Correlation matrix</span></span></code></pre></div>
<pre><code>##           x1        x2         y
## x1 1.0000000 0.7812993 0.9445543
## x2 0.7812993 1.0000000 0.8358025
## y  0.9445543 0.8358025 1.0000000</code></pre>
</div>
<div id="anova-table-with-ssr-decomposition" class="section level3 hasAnchor" number="3.4.6">
<h3><span class="header-section-number">3.4.6</span> ANOVA Table with SSR Decomposition<a href="reg.html#anova-table-with-ssr-decomposition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>R</strong> decomposes SSR based on the order of predictors in <code>lm()</code>. For example:
<span class="math display">\[
SSR(x_1, x_2, x_3) = SSR(x_3) + SSR(x_2 \mid x_3) + SSR(x_1 \mid x_3, x_2)
\]</span>
To specify this order, list predictors as <code>x3 + x2 + x1</code>.</p>
<p>Using the Body Fat example:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="reg.html#cb132-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%207%20Data%20Sets/CH07TA01.txt&quot;</span></span>
<span id="cb132-2"><a href="reg.html#cb132-2" tabindex="-1"></a>bf.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">col.names=</span><span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x3&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb132-3"><a href="reg.html#cb132-3" tabindex="-1"></a><span class="fu">glimpse</span>(bf.data)</span></code></pre></div>
<pre><code>## Rows: 20
## Columns: 4
## $ x1 &lt;dbl&gt; 19.5, 24.7, 30.7, 29.8, 19.1, 25.6, 31.4, 27.9, 22.1, 25.5, 31.1, 3…
## $ x2 &lt;dbl&gt; 43.1, 49.8, 51.9, 54.3, 42.2, 53.9, 58.5, 52.1, 49.9, 53.5, 56.6, 5…
## $ x3 &lt;dbl&gt; 29.1, 28.2, 37.0, 31.1, 30.9, 23.7, 27.6, 30.6, 23.2, 24.8, 30.0, 2…
## $ y  &lt;dbl&gt; 11.9, 22.8, 18.7, 20.1, 12.9, 21.7, 27.1, 25.4, 21.3, 19.3, 25.4, 2…</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="reg.html#cb134-1" tabindex="-1"></a>bf.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x3 <span class="sc">+</span> x2 <span class="sc">+</span> x1, <span class="at">data =</span> bf.data)</span>
<span id="cb134-2"><a href="reg.html#cb134-2" tabindex="-1"></a><span class="fu">anova</span>(bf.fit)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: y
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## x3         1  10.05   10.05  1.6343    0.2193    
## x2         1 374.23  374.23 60.8471 7.684e-07 ***
## x1         1  12.70   12.70  2.0657    0.1699    
## Residuals 16  98.40    6.15                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This provides the extra sums of squares for <span class="math inline">\(x_2\)</span> and <span class="math inline">\(x_1\)</span> given <span class="math inline">\(x_3\)</span>.</p>
</div>
<div id="testing-beta_k-ne-0-for-some-k" class="section level3 hasAnchor" number="3.4.7">
<h3><span class="header-section-number">3.4.7</span> Testing <span class="math inline">\(\beta_k \ne 0\)</span> for Some <span class="math inline">\(k\)</span><a href="reg.html#testing-beta_k-ne-0-for-some-k" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To test whether one or more coefficients are significant, compare nested models using <code>anova()</code>.</p>
<p>For example, test <span class="math inline">\(H_0: \beta_2 = \beta_3 = 0\)</span> in the Body Fat data:</p>
<ul>
<li><strong>Reduced model</strong>: <span class="math inline">\(y = \beta_0 + \beta_1 x_1 + \varepsilon\)</span></li>
<li><strong>Full model</strong>: <span class="math inline">\(y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 + \varepsilon\)</span></li>
</ul>
<p>Use <code>anova()</code> to compare:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="reg.html#cb136-1" tabindex="-1"></a>reduced.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1, <span class="at">data =</span> bf.data)</span>
<span id="cb136-2"><a href="reg.html#cb136-2" tabindex="-1"></a>full.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, <span class="at">data =</span> bf.data)</span>
<span id="cb136-3"><a href="reg.html#cb136-3" tabindex="-1"></a></span>
<span id="cb136-4"><a href="reg.html#cb136-4" tabindex="-1"></a><span class="fu">anova</span>(reduced.fit, full.fit, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: y ~ x1
## Model 2: y ~ x1 + x2 + x3
##   Res.Df     RSS Df Sum of Sq      F  Pr(&gt;F)  
## 1     18 143.120                              
## 2     16  98.405  2    44.715 3.6352 0.04995 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><img src="ch3figures/redTest.png" style="width:90.0%" /></p>
</div>
</div>
<div id="interactions" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Interactions<a href="reg.html#interactions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To include an interaction between <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>, use <code>x1*x2</code> in the model formula. This adds both main effects and the interaction. Alternatively, create the interaction manually with <code>mutate()</code>:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="reg.html#cb138-1" tabindex="-1"></a>BodyFat.Inter <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1<span class="sc">*</span>x2 <span class="sc">+</span> x3, <span class="at">data =</span> bf.data)</span>
<span id="cb138-2"><a href="reg.html#cb138-2" tabindex="-1"></a><span class="fu">summary</span>(BodyFat.Inter)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 * x2 + x3, data = bf.data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.5365 -1.8682  0.2772  1.2493  4.1589 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) 150.87925  124.06427   1.216    0.243
## x1            4.15688    3.11251   1.336    0.202
## x2           -3.64609    3.11348  -1.171    0.260
## x3           -2.45340    1.72707  -1.421    0.176
## x1:x2         0.01401    0.02911   0.481    0.637
## 
## Residual standard error: 2.542 on 15 degrees of freedom
## Multiple R-squared:  0.8044, Adjusted R-squared:  0.7522 
## F-statistic: 15.42 on 4 and 15 DF,  p-value: 3.41e-05</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="reg.html#cb140-1" tabindex="-1"></a>bf.data2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(bf.data, <span class="at">x1x2 =</span> x1 <span class="sc">*</span> x2)</span>
<span id="cb140-2"><a href="reg.html#cb140-2" tabindex="-1"></a>BodyFat.Inter2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x1x2, <span class="at">data =</span> bf.data2)</span>
<span id="cb140-3"><a href="reg.html#cb140-3" tabindex="-1"></a><span class="fu">summary</span>(BodyFat.Inter2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2 + x3 + x1x2, data = bf.data2)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.5365 -1.8682  0.2772  1.2493  4.1589 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) 150.87925  124.06427   1.216    0.243
## x1            4.15688    3.11251   1.336    0.202
## x2           -3.64609    3.11348  -1.171    0.260
## x3           -2.45340    1.72707  -1.421    0.176
## x1x2          0.01401    0.02911   0.481    0.637
## 
## Residual standard error: 2.542 on 15 degrees of freedom
## Multiple R-squared:  0.8044, Adjusted R-squared:  0.7522 
## F-statistic: 15.42 on 4 and 15 DF,  p-value: 3.41e-05</code></pre>
</div>
<div id="standardized-multiple-regression" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Standardized Multiple Regression<a href="reg.html#standardized-multiple-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To compare coefficient magnitudes, standardize variables using <code>scale()</code> within <code>mutate()</code>:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="reg.html#cb142-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%206%20Data%20Sets/CH06FI05.txt&quot;</span></span>
<span id="cb142-2"><a href="reg.html#cb142-2" tabindex="-1"></a>dwaine.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb142-3"><a href="reg.html#cb142-3" tabindex="-1"></a><span class="fu">glimpse</span>(dwaine.data)</span></code></pre></div>
<pre><code>## Rows: 21
## Columns: 3
## $ x1 &lt;dbl&gt; 68.5, 45.2, 91.3, 47.8, 46.9, 66.1, 49.5, 52.0, 48.9, 38.4, 87.9, 7…
## $ x2 &lt;dbl&gt; 16.7, 16.8, 18.2, 16.3, 17.3, 18.2, 15.9, 17.2, 16.6, 16.0, 18.3, 1…
## $ y  &lt;dbl&gt; 174.4, 164.4, 244.2, 154.6, 181.6, 207.5, 152.8, 163.2, 145.4, 137.…</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="reg.html#cb144-1" tabindex="-1"></a>dwaine.dataStdz <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dwaine.data,</span>
<span id="cb144-2"><a href="reg.html#cb144-2" tabindex="-1"></a>  <span class="at">y.stdz =</span> <span class="fu">scale</span>(y),</span>
<span id="cb144-3"><a href="reg.html#cb144-3" tabindex="-1"></a>  <span class="at">x1.stdz =</span> <span class="fu">scale</span>(x1),</span>
<span id="cb144-4"><a href="reg.html#cb144-4" tabindex="-1"></a>  <span class="at">x2.stdz =</span> <span class="fu">scale</span>(x2))</span>
<span id="cb144-5"><a href="reg.html#cb144-5" tabindex="-1"></a></span>
<span id="cb144-6"><a href="reg.html#cb144-6" tabindex="-1"></a><span class="fu">head</span>(dwaine.dataStdz)</span></code></pre></div>
<pre><code>##     x1   x2     y      y.stdz    x1.stdz    x2.stdz
## 1 68.5 16.7 174.4 -0.20736368  0.3480579 -0.4563909
## 2 45.2 16.8 164.4 -0.48367315 -0.9032627 -0.3533349
## 3 91.3 18.2 244.2  1.72127642  1.5725261  1.0894493
## 4 47.8 16.3 154.6 -0.75445643 -0.7636303 -0.8686150
## 5 46.9 17.3 181.6 -0.00842086 -0.8119646  0.1619452
## 6 66.1 18.2 207.5  0.70722067  0.2191665  1.0894493</code></pre>
<p>Fit the model (note: use <code>-1</code> to exclude intercept, as variables are standardized):</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="reg.html#cb146-1" tabindex="-1"></a>dwaine.fitStdz <span class="ot">&lt;-</span> <span class="fu">lm</span>(y.stdz <span class="sc">~</span> x1.stdz <span class="sc">+</span> x2.stdz <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> dwaine.dataStdz)</span>
<span id="cb146-2"><a href="reg.html#cb146-2" tabindex="-1"></a><span class="fu">summary</span>(dwaine.fitStdz)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y.stdz ~ x1.stdz + x2.stdz - 1, data = dwaine.dataStdz)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.50907 -0.17176  0.02058  0.26071  0.55856 
## 
## Coefficients:
##         Estimate Std. Error t value Pr(&gt;|t|)    
## x1.stdz   0.7484     0.1061   7.056 1.03e-06 ***
## x2.stdz   0.2511     0.1061   2.368   0.0287 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.296 on 19 degrees of freedom
## Multiple R-squared:  0.9167, Adjusted R-squared:  0.908 
## F-statistic: 104.6 on 2 and 19 DF,  p-value: 5.544e-11</code></pre>
<p>The output includes standardized coefficients <span class="math inline">\(b_i^*\)</span>.</p>
</div>
<div id="polynomial-regression-and-categorical-predictors" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Polynomial Regression and Categorical Predictors<a href="reg.html#polynomial-regression-and-categorical-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We first fit a second-order polynomial model:
<span class="math display">\[
y_i = \beta_0 + \beta_1 x_i^* + \beta_2 (x_i^*)^2 + \varepsilon_i
\]</span>
using the <code>airquality</code> dataset, where <span class="math inline">\(x_i^* = x_i - \bar{x}\)</span>.</p>
<p>Center and square the explanatory variable:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="reg.html#cb148-1" tabindex="-1"></a><span class="fu">data</span>(airquality)</span>
<span id="cb148-2"><a href="reg.html#cb148-2" tabindex="-1"></a><span class="fu">glimpse</span>(airquality)</span></code></pre></div>
<pre><code>## Rows: 153
## Columns: 6
## $ Ozone   &lt;int&gt; 41, 36, 12, 18, NA, 28, 23, 19, 8, NA, 7, 16, 11, 14, 18, 14, …
## $ Solar.R &lt;int&gt; 190, 118, 149, 313, NA, NA, 299, 99, 19, 194, NA, 256, 290, 27…
## $ Wind    &lt;dbl&gt; 7.4, 8.0, 12.6, 11.5, 14.3, 14.9, 8.6, 13.8, 20.1, 8.6, 6.9, 9…
## $ Temp    &lt;int&gt; 67, 72, 74, 62, 56, 66, 65, 59, 61, 69, 74, 69, 66, 68, 58, 64…
## $ Month   &lt;int&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,…
## $ Day     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,…</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="reg.html#cb150-1" tabindex="-1"></a>airqualityCen <span class="ot">&lt;-</span> <span class="fu">mutate</span>(airquality,</span>
<span id="cb150-2"><a href="reg.html#cb150-2" tabindex="-1"></a>  <span class="at">cenx1 =</span> <span class="fu">scale</span>(Temp, <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb150-3"><a href="reg.html#cb150-3" tabindex="-1"></a>  <span class="at">cenx1sq =</span> cenx1<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<p>Fit and plot the model:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="reg.html#cb151-1" tabindex="-1"></a>polyfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> cenx1 <span class="sc">+</span> cenx1sq, <span class="at">data =</span> airqualityCen)</span>
<span id="cb151-2"><a href="reg.html#cb151-2" tabindex="-1"></a><span class="fu">summary</span>(polyfit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Ozone ~ cenx1 + cenx1sq, data = airqualityCen)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -37.619 -12.513  -2.736   9.676 123.909 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 35.19617    2.79472  12.594  &lt; 2e-16 ***
## cenx1        2.60963    0.22610  11.542  &lt; 2e-16 ***
## cenx1sq      0.07807    0.02086   3.743 0.000288 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 22.47 on 113 degrees of freedom
##   (37 observations deleted due to missingness)
## Multiple R-squared:  0.5442, Adjusted R-squared:  0.5362 
## F-statistic: 67.46 on 2 and 113 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="reg.html#cb153-1" tabindex="-1"></a><span class="fu">xyplot</span>(Ozone <span class="sc">~</span> cenx1, <span class="at">data =</span> airqualityCen,</span>
<span id="cb153-2"><a href="reg.html#cb153-2" tabindex="-1"></a>  <span class="at">panel =</span> <span class="cf">function</span>(x, y, ...) {</span>
<span id="cb153-3"><a href="reg.html#cb153-3" tabindex="-1"></a>    <span class="fu">panel.xyplot</span>(x, y, ...)</span>
<span id="cb153-4"><a href="reg.html#cb153-4" tabindex="-1"></a>    fm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>))</span>
<span id="cb153-5"><a href="reg.html#cb153-5" tabindex="-1"></a>    <span class="fu">panel.lines</span>(<span class="fu">sort</span>(x), <span class="fu">predict</span>(fm, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">sort</span>(x))),</span>
<span id="cb153-6"><a href="reg.html#cb153-6" tabindex="-1"></a>                <span class="at">col.line =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb153-7"><a href="reg.html#cb153-7" tabindex="-1"></a>  })</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-59-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="model-selection" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Model Selection<a href="reg.html#model-selection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We illustrate model selection criteria using the Surgical Unit example from ALRM.</p>
<p>Import the data:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="reg.html#cb154-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%209%20Data%20Sets/CH09TA01.txt&quot;</span></span>
<span id="cb154-2"><a href="reg.html#cb154-2" tabindex="-1"></a>surgunit.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">col.names=</span><span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x3&quot;</span>, <span class="st">&quot;x4&quot;</span>, <span class="st">&quot;x5&quot;</span>, <span class="st">&quot;x6&quot;</span>, <span class="st">&quot;x7&quot;</span>, <span class="st">&quot;x8&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;lny&quot;</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb154-3"><a href="reg.html#cb154-3" tabindex="-1"></a><span class="fu">glimpse</span>(surgunit.data)</span></code></pre></div>
<pre><code>## Rows: 54
## Columns: 10
## $ x1  &lt;dbl&gt; 6.7, 5.1, 7.4, 6.5, 7.8, 5.8, 5.7, 3.7, 6.0, 3.7, 6.3, 6.7, 5.8, 5…
## $ x2  &lt;int&gt; 62, 59, 57, 73, 65, 38, 46, 68, 67, 76, 84, 51, 96, 83, 62, 74, 85…
## $ x3  &lt;int&gt; 81, 66, 83, 41, 115, 72, 63, 81, 93, 94, 83, 43, 114, 88, 67, 68, …
## $ x4  &lt;dbl&gt; 2.59, 1.70, 2.16, 2.01, 4.30, 1.42, 1.91, 2.57, 2.50, 2.40, 4.13, …
## $ x5  &lt;int&gt; 50, 39, 55, 48, 45, 65, 49, 69, 58, 48, 37, 57, 63, 52, 58, 64, 36…
## $ x6  &lt;int&gt; 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, …
## $ x7  &lt;int&gt; 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, …
## $ x8  &lt;int&gt; 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, …
## $ y   &lt;int&gt; 695, 403, 710, 349, 2343, 348, 518, 749, 1056, 968, 745, 257, 1573…
## $ lny &lt;dbl&gt; 6.544, 5.999, 6.565, 5.854, 7.759, 5.852, 6.250, 6.619, 6.962, 6.8…</code></pre>
<p>Define categorical variables:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="reg.html#cb156-1" tabindex="-1"></a>surgunit.data <span class="ot">&lt;-</span> <span class="fu">mutate</span>(surgunit.data, <span class="at">x6fac =</span> <span class="fu">as.factor</span>(x6), <span class="at">x7fac =</span> <span class="fu">as.factor</span>(x7), <span class="at">x8fac =</span> <span class="fu">as.factor</span>(x8))</span>
<span id="cb156-2"><a href="reg.html#cb156-2" tabindex="-1"></a><span class="fu">glimpse</span>(surgunit.data)</span></code></pre></div>
<pre><code>## Rows: 54
## Columns: 13
## $ x1    &lt;dbl&gt; 6.7, 5.1, 7.4, 6.5, 7.8, 5.8, 5.7, 3.7, 6.0, 3.7, 6.3, 6.7, 5.8,…
## $ x2    &lt;int&gt; 62, 59, 57, 73, 65, 38, 46, 68, 67, 76, 84, 51, 96, 83, 62, 74, …
## $ x3    &lt;int&gt; 81, 66, 83, 41, 115, 72, 63, 81, 93, 94, 83, 43, 114, 88, 67, 68…
## $ x4    &lt;dbl&gt; 2.59, 1.70, 2.16, 2.01, 4.30, 1.42, 1.91, 2.57, 2.50, 2.40, 4.13…
## $ x5    &lt;int&gt; 50, 39, 55, 48, 45, 65, 49, 69, 58, 48, 37, 57, 63, 52, 58, 64, …
## $ x6    &lt;int&gt; 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1…
## $ x7    &lt;int&gt; 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1…
## $ x8    &lt;int&gt; 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0…
## $ y     &lt;int&gt; 695, 403, 710, 349, 2343, 348, 518, 749, 1056, 968, 745, 257, 15…
## $ lny   &lt;dbl&gt; 6.544, 5.999, 6.565, 5.854, 7.759, 5.852, 6.250, 6.619, 6.962, 6…
## $ x6fac &lt;fct&gt; 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1…
## $ x7fac &lt;fct&gt; 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1…
## $ x8fac &lt;fct&gt; 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0…</code></pre>
<div id="adjusted-r2-and-c_p" class="section level3 hasAnchor" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Adjusted <span class="math inline">\(R^2\)</span> and <span class="math inline">\(C_p\)</span><a href="reg.html#adjusted-r2-and-c_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Adjusted <span class="math inline">\(R^2\)</span> accounts for the number of predictors. To compute it across models, use <code>leaps</code>:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="reg.html#cb158-1" tabindex="-1"></a>Xleaps <span class="ot">&lt;-</span> <span class="fu">select</span>(surgunit.data, <span class="sc">-</span><span class="fu">c</span>(lny, y, x6fac, x7fac, x8fac))</span>
<span id="cb158-2"><a href="reg.html#cb158-2" tabindex="-1"></a></span>
<span id="cb158-3"><a href="reg.html#cb158-3" tabindex="-1"></a>R2adj.temp <span class="ot">&lt;-</span> <span class="fu">leaps</span>(<span class="at">x =</span> Xleaps, <span class="at">y =</span> surgunit.data<span class="sc">$</span>lny, <span class="at">method =</span> <span class="st">&quot;adjr2&quot;</span>)</span>
<span id="cb158-4"><a href="reg.html#cb158-4" tabindex="-1"></a>R2adj.info <span class="ot">&lt;-</span> <span class="fu">cbind</span>(R2adj.temp<span class="sc">$</span>which, R2adj.temp<span class="sc">$</span>size, R2adj.temp<span class="sc">$</span>adjr2)</span>
<span id="cb158-5"><a href="reg.html#cb158-5" tabindex="-1"></a><span class="fu">colnames</span>(R2adj.info) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>,<span class="st">&quot;x2&quot;</span>,<span class="st">&quot;x3&quot;</span>,<span class="st">&quot;x4&quot;</span>,<span class="st">&quot;x5&quot;</span>,<span class="st">&quot;x6&quot;</span>,<span class="st">&quot;x7&quot;</span>,<span class="st">&quot;x8&quot;</span>,<span class="st">&quot;p&quot;</span>,<span class="st">&quot;adjr2&quot;</span>)</span>
<span id="cb158-6"><a href="reg.html#cb158-6" tabindex="-1"></a>R2adj.info</span></code></pre></div>
<pre><code>##   x1 x2 x3 x4 x5 x6 x7 x8 p        adjr2
## 1  0  0  1  0  0  0  0  0 2  0.416557881
## 1  0  0  0  1  0  0  0  0 2  0.410417798
## 1  0  1  0  0  0  0  0  0 2  0.205862939
## 1  0  0  0  0  0  0  0  1 2  0.122406556
## 1  1  0  0  0  0  0  0  0 2  0.042543244
## 1  0  0  0  0  0  1  0  0 2  0.035653717
## 1  0  0  0  0  1  0  0  0 2  0.002187716
## 1  0  0  0  0  0  0  1  0 2 -0.002898254
## 2  0  1  1  0  0  0  0  0 3  0.650085544
## 2  0  0  1  1  0  0  0  0 3  0.583777218
## 2  1  0  1  0  0  0  0  0 3  0.530934014
## 2  0  0  1  0  0  0  0  1 3  0.497419295
## 2  0  0  0  1  0  0  0  1 3  0.488519841
## 2  0  1  0  1  0  0  0  0 3  0.462691631
## 2  0  0  1  0  0  1  0  0 3  0.426095576
## 2  0  0  1  0  1  0  0  0 3  0.424491387
## 2  0  0  0  1  0  0  1  0 3  0.411731492
## 2  0  0  1  0  0  0  1  0 3  0.410390386
## 3  0  1  1  0  0  0  0  1 4  0.764715749
## 3  1  1  1  0  0  0  0  0 4  0.742729360
## 3  0  1  1  1  0  0  0  0 4  0.700885337
## 3  0  1  1  0  0  0  1  0 4  0.661818074
## 3  0  1  1  0  1  0  0  0 4  0.656711027
## 3  0  1  1  0  0  1  0  0 4  0.649910695
## 3  0  0  1  1  0  0  0  1 4  0.649267958
## 3  1  0  1  1  0  0  0  0 4  0.588850588
## 3  0  0  1  1  0  0  1  0 4  0.581680554
## 3  0  0  1  1  1  0  0  0 4  0.577651443
## 4  1  1  1  0  0  0  0  1 5  0.815996984
## 4  0  1  1  1  0  0  0  1 5  0.799293694
## 4  0  1  1  0  0  1  0  1 5  0.771518218
## 4  0  1  1  0  1  0  0  1 5  0.765894154
## 4  0  1  1  0  0  0  1  1 5  0.761994941
## 4  1  1  1  0  1  0  0  0 5  0.750009741
## 4  1  1  1  0  0  0  1  0 5  0.747435371
## 4  1  1  1  0  0  1  0  0 5  0.741872034
## 4  1  1  1  1  0  0  0  0 5  0.739554570
## 4  0  1  1  1  0  0  1  0 5  0.711129897
## 5  1  1  1  0  0  1  0  1 6  0.820508061
## 5  1  1  1  0  1  0  0  1 6  0.818704958
## 5  1  1  1  1  0  0  0  1 6  0.815758658
## 5  1  1  1  0  0  0  1  1 6  0.814141607
## 5  0  1  1  1  0  1  0  1 6  0.798911508
## 5  0  1  1  1  0  0  1  1 6  0.796775100
## 5  0  1  1  1  1  0  0  1 6  0.796460487
## 5  0  1  1  0  1  1  0  1 6  0.772967184
## 5  0  1  1  0  0  1  1  1 6  0.768818413
## 5  0  1  1  0  1  0  1  1 6  0.764075717
## 6  1  1  1  0  1  1  0  1 7  0.823449402
## 6  1  1  1  0  0  1  1  1 7  0.818660139
## 6  1  1  1  1  0  1  0  1 7  0.818132982
## 6  1  1  1  0  1  0  1  1 7  0.817824375
## 6  1  1  1  1  1  0  0  1 7  0.816356244
## 6  1  1  1  1  0  0  1  1 7  0.813704868
## 6  0  1  1  1  0  1  1  1 7  0.796331530
## 6  0  1  1  1  1  1  0  1 7  0.796311668
## 6  0  1  1  1  1  0  1  1 7  0.794252288
## 6  0  1  1  0  1  1  1  1 7  0.771189602
## 7  1  1  1  0  1  1  1  1 8  0.822597377
## 7  1  1  1  1  1  1  0  1 8  0.819816836
## 7  1  1  1  1  0  1  1  1 8  0.816097625
## 7  1  1  1  1  1  0  1  1 8  0.815143680
## 7  0  1  1  1  1  1  1  1 8  0.794098517
## 7  1  1  1  1  1  1  1  0 8  0.746632006
## 7  1  0  1  1  1  1  1  1 8  0.634657905
## 7  1  1  0  1  1  1  1  1 8  0.553658658
## 8  1  1  1  1  1  1  1  1 9  0.818773720</code></pre>
<p>For Mallows’ <span class="math inline">\(C_p\)</span>:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="reg.html#cb160-1" tabindex="-1"></a>Cp.temp <span class="ot">&lt;-</span> <span class="fu">leaps</span>(<span class="at">x =</span> Xleaps, <span class="at">y =</span> surgunit.data<span class="sc">$</span>lny, <span class="at">method =</span> <span class="st">&quot;Cp&quot;</span>)</span>
<span id="cb160-2"><a href="reg.html#cb160-2" tabindex="-1"></a>Cp.info <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Cp.temp<span class="sc">$</span>which, Cp.temp<span class="sc">$</span>size, Cp.temp<span class="sc">$</span>Cp)</span>
<span id="cb160-3"><a href="reg.html#cb160-3" tabindex="-1"></a><span class="fu">colnames</span>(Cp.info) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>,<span class="st">&quot;x2&quot;</span>,<span class="st">&quot;x3&quot;</span>,<span class="st">&quot;x4&quot;</span>,<span class="st">&quot;x5&quot;</span>,<span class="st">&quot;x6&quot;</span>,<span class="st">&quot;x7&quot;</span>,<span class="st">&quot;x8&quot;</span>,<span class="st">&quot;p&quot;</span>,<span class="st">&quot;Cp&quot;</span>)</span>
<span id="cb160-4"><a href="reg.html#cb160-4" tabindex="-1"></a>Cp.info</span></code></pre></div>
<pre><code>##   x1 x2 x3 x4 x5 x6 x7 x8 p         Cp
## 1  0  0  1  0  0  0  0  0 2 117.409441
## 1  0  0  0  1  0  0  0  0 2 119.171240
## 1  0  1  0  0  0  0  0  0 2 177.865004
## 1  0  0  0  0  0  0  0  1 2 201.811487
## 1  1  0  0  0  0  0  0  0 2 224.726995
## 1  0  0  0  0  0  1  0  0 2 226.703835
## 1  0  0  0  0  1  0  0  0 2 236.306372
## 1  0  0  0  0  0  0  1  0 2 237.765710
## 2  0  1  1  0  0  0  0  0 3  50.471575
## 2  0  0  1  1  0  0  0  0 3  69.131808
## 2  1  0  1  0  0  0  0  0 3  84.002738
## 2  0  0  1  0  0  0  0  1 3  93.434321
## 2  0  0  0  1  0  0  0  1 3  95.938771
## 2  0  1  0  1  0  0  0  0 3 103.207247
## 2  0  0  1  0  0  1  0  0 3 113.505967
## 2  0  0  1  0  1  0  0  0 3 113.957411
## 2  0  0  0  1  0  0  1  0 3 117.548252
## 2  0  0  1  0  0  0  1  0 3 117.925661
## 3  0  1  1  0  0  0  0  1 4  18.914496
## 3  1  1  1  0  0  0  0  0 4  24.980500
## 3  0  1  1  1  0  0  0  0 4  36.525190
## 3  0  1  1  0  0  0  1  0 4  47.303776
## 3  0  1  1  0  1  0  0  0 4  48.712801
## 3  0  1  1  0  0  1  0  0 4  50.589000
## 3  0  0  1  1  0  0  0  1 4  50.766330
## 3  1  0  1  1  0  0  0  0 4  67.435372
## 3  0  0  1  1  0  0  1  0 4  69.413572
## 3  0  0  1  1  1  0  0  0 4  70.525196
## 4  1  1  1  0  0  0  0  1 5   5.750774
## 4  0  1  1  1  0  0  0  1 5  10.267014
## 4  0  1  1  0  0  1  0  1 5  17.776952
## 4  0  1  1  0  1  0  0  1 5  19.297588
## 4  0  1  1  0  0  0  1  1 5  20.351858
## 4  1  1  1  0  1  0  0  0 5  23.592419
## 4  1  1  1  0  0  0  1  0 5  24.288478
## 4  1  1  1  0  0  1  0  0 5  25.792694
## 4  1  1  1  1  0  0  0  0 5  26.419290
## 4  0  1  1  1  0  0  1  0 5  34.104759
## 5  1  1  1  0  0  1  0  1 6   5.540639
## 5  1  1  1  0  1  0  0  1 6   6.018212
## 5  1  1  1  1  0  0  0  1 6   6.798576
## 5  1  1  1  0  0  0  1  1 6   7.226872
## 5  0  1  1  1  0  1  0  1 6  11.260750
## 5  0  1  1  1  0  0  1  1 6  11.826604
## 5  0  1  1  1  1  0  0  1 6  11.909933
## 5  0  1  1  0  1  1  0  1 6  18.132422
## 5  0  1  1  0  0  1  1  1 6  19.231275
## 5  0  1  1  0  1  0  1  1 6  20.487436
## 6  1  1  1  0  1  1  0  1 7   5.787389
## 6  1  1  1  0  0  1  1  1 7   7.029456
## 6  1  1  1  1  0  1  0  1 7   7.166172
## 6  1  1  1  0  1  0  1  1 7   7.246207
## 6  1  1  1  1  1  0  0  1 7   7.626958
## 6  1  1  1  1  0  0  1  1 7   8.314578
## 6  0  1  1  1  0  1  1  1 7  12.820254
## 6  0  1  1  1  1  1  0  1 7  12.825405
## 6  0  1  1  1  1  0  1  1 7  13.359493
## 6  0  1  1  0  1  1  1  1 7  19.340669
## 7  1  1  1  0  1  1  1  1 8   7.029455
## 7  1  1  1  1  1  1  0  1 8   7.735230
## 7  1  1  1  1  0  1  1  1 8   8.679263
## 7  1  1  1  1  1  0  1  1 8   8.921400
## 7  0  1  1  1  1  1  1  1 8  14.263216
## 7  1  1  1  1  1  1  1  0 8  26.311466
## 7  1  0  1  1  1  1  1  1 8  54.733440
## 7  1  1  0  1  1  1  1  1 8  75.293181
## 8  1  1  1  1  1  1  1  1 9   9.000000</code></pre>
</div>
<div id="aic" class="section level3 hasAnchor" number="3.8.2">
<h3><span class="header-section-number">3.8.2</span> AIC<a href="reg.html#aic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use <code>AIC()</code> on <code>lm</code> objects:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="reg.html#cb162-1" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lny <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x5 <span class="sc">+</span> x8, <span class="at">data =</span> surgunit.data)</span>
<span id="cb162-2"><a href="reg.html#cb162-2" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lny <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x8, <span class="at">data =</span> surgunit.data)</span>
<span id="cb162-3"><a href="reg.html#cb162-3" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lny <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x4 <span class="sc">+</span> x6 <span class="sc">+</span> x8, <span class="at">data =</span> surgunit.data)</span>
<span id="cb162-4"><a href="reg.html#cb162-4" tabindex="-1"></a></span>
<span id="cb162-5"><a href="reg.html#cb162-5" tabindex="-1"></a><span class="fu">AIC</span>(fit1, fit2, fit3)</span></code></pre></div>
<pre><code>##      df       AIC
## fit1  7 -8.020058
## fit2  6 -8.105992
## fit3  7 38.449552</code></pre>
</div>
<div id="bic" class="section level3 hasAnchor" number="3.8.3">
<h3><span class="header-section-number">3.8.3</span> BIC<a href="reg.html#bic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To compute BIC, add <code>k = log(n)</code> to <code>AIC()</code>:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="reg.html#cb164-1" tabindex="-1"></a><span class="fu">dim</span>(surgunit.data)</span></code></pre></div>
<pre><code>## [1] 54 13</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="reg.html#cb166-1" tabindex="-1"></a><span class="fu">AIC</span>(fit1, fit2, fit3, <span class="at">k =</span> <span class="fu">log</span>(<span class="dv">54</span>))</span></code></pre></div>
<pre><code>##      df       AIC
## fit1  7  5.902830
## fit2  6  3.827912
## fit3  7 52.372440</code></pre>
<p>By default, <code>AIC()</code> uses <code>k = 2</code>.</p>
</div>
<div id="aicc" class="section level3 hasAnchor" number="3.8.4">
<h3><span class="header-section-number">3.8.4</span> AICc<a href="reg.html#aicc" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To compute Akaike’s corrected AIC:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="reg.html#cb168-1" tabindex="-1"></a>storeAIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fit1, fit2, fit3)</span>
<span id="cb168-2"><a href="reg.html#cb168-2" tabindex="-1"></a></span>
<span id="cb168-3"><a href="reg.html#cb168-3" tabindex="-1"></a>AICc <span class="ot">&lt;-</span> storeAIC<span class="sc">$</span>AIC <span class="sc">+</span> (<span class="dv">2</span> <span class="sc">*</span> storeAIC<span class="sc">$</span>df<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> storeAIC<span class="sc">$</span>df) <span class="sc">/</span> (<span class="dv">54</span> <span class="sc">-</span> storeAIC<span class="sc">$</span>df <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb168-4"><a href="reg.html#cb168-4" tabindex="-1"></a></span>
<span id="cb168-5"><a href="reg.html#cb168-5" tabindex="-1"></a>storeBIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fit1, fit2, fit3, <span class="at">k =</span> <span class="fu">log</span>(<span class="dv">54</span>))</span>
<span id="cb168-6"><a href="reg.html#cb168-6" tabindex="-1"></a><span class="fu">cbind</span>(AICc, storeAIC, storeBIC)  <span class="co"># ignore column headers</span></span></code></pre></div>
<pre><code>##           AICc df       AIC df       AIC
## fit1 -5.585275  7 -8.020058  7  5.902830
## fit2 -6.318758  6 -8.105992  6  3.827912
## fit3 40.884335  7 38.449552  7 52.372440</code></pre>
</div>
<div id="stepwise-regression" class="section level3 hasAnchor" number="3.8.5">
<h3><span class="header-section-number">3.8.5</span> Stepwise Regression<a href="reg.html#stepwise-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>step()</code> function performs forward/backward stepwise regression using AIC by default. Required arguments include the initial model (<code>lm</code> object), <code>scope</code> (predictors to consider), and <code>direction</code>.</p>
<p><strong>Forward selection</strong> starts with an intercept-only model and adds predictors that reduce AIC. If no further improvement is possible, it stops.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="reg.html#cb170-1" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lny <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> surgunit.data)</span>
<span id="cb170-2"><a href="reg.html#cb170-2" tabindex="-1"></a>fit.fstepAIC <span class="ot">&lt;-</span> <span class="fu">step</span>(fit0, <span class="at">scope =</span> <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4, <span class="at">direction =</span> <span class="st">&quot;forward&quot;</span>)</span></code></pre></div>
<pre><code>## Start:  AIC=-75.7
## lny ~ 1
## 
##        Df Sum of Sq     RSS      AIC
## + x3    1    5.4762  7.3316 -103.827
## + x4    1    5.3990  7.4087 -103.262
## + x2    1    2.8285  9.9792  -87.178
## + x1    1    0.7763 12.0315  -77.079
## &lt;none&gt;              12.8077  -75.703
## 
## Step:  AIC=-103.83
## lny ~ x3
## 
##        Df Sum of Sq    RSS     AIC
## + x2    1    3.0191 4.3125 -130.48
## + x4    1    2.2019 5.1297 -121.11
## + x1    1    1.5506 5.7810 -114.66
## &lt;none&gt;              7.3316 -103.83
## 
## Step:  AIC=-130.48
## lny ~ x3 + x2
## 
##        Df Sum of Sq    RSS     AIC
## + x1    1   1.20395 3.1085 -146.16
## + x4    1   0.69836 3.6141 -138.02
## &lt;none&gt;              4.3125 -130.48
## 
## Step:  AIC=-146.16
## lny ~ x3 + x2 + x1
## 
##        Df Sum of Sq    RSS     AIC
## &lt;none&gt;              3.1085 -146.16
## + x4    1  0.024578 3.0840 -144.59</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="reg.html#cb172-1" tabindex="-1"></a><span class="fu">summary</span>(fit.fstepAIC)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lny ~ x3 + x2 + x1, data = surgunit.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.46992 -0.17954 -0.03071  0.17883  0.59253 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.766176   0.226758  16.609  &lt; 2e-16 ***
## x3          0.016452   0.001630  10.094 1.17e-13 ***
## x2          0.013340   0.002035   6.556 2.97e-08 ***
## x1          0.095458   0.021692   4.401 5.67e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2493 on 50 degrees of freedom
## Multiple R-squared:  0.7573, Adjusted R-squared:  0.7427 
## F-statistic:    52 on 3 and 50 DF,  p-value: 2.124e-15</code></pre>
<p>To use <strong>BIC</strong>:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="reg.html#cb174-1" tabindex="-1"></a>fit.fstepBIC <span class="ot">&lt;-</span> <span class="fu">step</span>(fit0, <span class="at">scope =</span> <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4, <span class="at">direction =</span> <span class="st">&quot;forward&quot;</span>, <span class="at">k =</span> <span class="fu">log</span>(<span class="dv">54</span>))</span></code></pre></div>
<pre><code>## Start:  AIC=-73.71
## lny ~ 1
## 
##        Df Sum of Sq     RSS     AIC
## + x3    1    5.4762  7.3316 -99.849
## + x4    1    5.3990  7.4087 -99.284
## + x2    1    2.8285  9.9792 -83.200
## &lt;none&gt;              12.8077 -73.714
## + x1    1    0.7763 12.0315 -73.101
## 
## Step:  AIC=-99.85
## lny ~ x3
## 
##        Df Sum of Sq    RSS      AIC
## + x2    1    3.0191 4.3125 -124.516
## + x4    1    2.2019 5.1297 -115.146
## + x1    1    1.5506 5.7810 -108.691
## &lt;none&gt;              7.3316  -99.849
## 
## Step:  AIC=-124.52
## lny ~ x3 + x2
## 
##        Df Sum of Sq    RSS     AIC
## + x1    1   1.20395 3.1085 -138.21
## + x4    1   0.69836 3.6141 -130.07
## &lt;none&gt;              4.3125 -124.52
## 
## Step:  AIC=-138.2
## lny ~ x3 + x2 + x1
## 
##        Df Sum of Sq    RSS     AIC
## &lt;none&gt;              3.1085 -138.21
## + x4    1  0.024578 3.0840 -134.65</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="reg.html#cb176-1" tabindex="-1"></a><span class="fu">summary</span>(fit.fstepBIC)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lny ~ x3 + x2 + x1, data = surgunit.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.46992 -0.17954 -0.03071  0.17883  0.59253 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.766176   0.226758  16.609  &lt; 2e-16 ***
## x3          0.016452   0.001630  10.094 1.17e-13 ***
## x2          0.013340   0.002035   6.556 2.97e-08 ***
## x1          0.095458   0.021692   4.401 5.67e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2493 on 50 degrees of freedom
## Multiple R-squared:  0.7573, Adjusted R-squared:  0.7427 
## F-statistic:    52 on 3 and 50 DF,  p-value: 2.124e-15</code></pre>
<p><strong>Backward selection</strong> starts with the full model and removes predictors that reduce AIC.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="reg.html#cb178-1" tabindex="-1"></a>fitfull <span class="ot">&lt;-</span> <span class="fu">lm</span>(lny <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4, <span class="at">data =</span> surgunit.data)</span>
<span id="cb178-2"><a href="reg.html#cb178-2" tabindex="-1"></a>fit.BstepAIC <span class="ot">&lt;-</span> <span class="fu">step</span>(fitfull, <span class="at">scope =</span> <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4, <span class="at">direction =</span> <span class="st">&quot;backward&quot;</span>)</span></code></pre></div>
<pre><code>## Start:  AIC=-144.59
## lny ~ x1 + x2 + x3 + x4
## 
##        Df Sum of Sq    RSS     AIC
## - x4    1    0.0246 3.1085 -146.16
## &lt;none&gt;              3.0840 -144.59
## - x1    1    0.5302 3.6141 -138.02
## - x2    1    1.8839 4.9678 -120.84
## - x3    1    3.4862 6.5702 -105.75
## 
## Step:  AIC=-146.16
## lny ~ x1 + x2 + x3
## 
##        Df Sum of Sq    RSS      AIC
## &lt;none&gt;              3.1085 -146.161
## - x1    1    1.2040 4.3125 -130.483
## - x2    1    2.6724 5.7810 -114.658
## - x3    1    6.3341 9.4427  -88.162</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="reg.html#cb180-1" tabindex="-1"></a><span class="fu">summary</span>(fit.BstepAIC)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lny ~ x1 + x2 + x3, data = surgunit.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.46992 -0.17954 -0.03071  0.17883  0.59253 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.766176   0.226758  16.609  &lt; 2e-16 ***
## x1          0.095458   0.021692   4.401 5.67e-05 ***
## x2          0.013340   0.002035   6.556 2.97e-08 ***
## x3          0.016452   0.001630  10.094 1.17e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2493 on 50 degrees of freedom
## Multiple R-squared:  0.7573, Adjusted R-squared:  0.7427 
## F-statistic:    52 on 3 and 50 DF,  p-value: 2.124e-15</code></pre>
<p>With <strong>BIC</strong>:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="reg.html#cb182-1" tabindex="-1"></a>fit.BstepBIC <span class="ot">&lt;-</span> <span class="fu">step</span>(fitfull, <span class="at">scope =</span> <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4, <span class="at">direction =</span> <span class="st">&quot;backward&quot;</span>, <span class="at">k =</span> <span class="fu">log</span>(<span class="dv">54</span>))</span></code></pre></div>
<pre><code>## Start:  AIC=-134.64
## lny ~ x1 + x2 + x3 + x4
## 
##        Df Sum of Sq    RSS      AIC
## - x4    1    0.0246 3.1085 -138.205
## &lt;none&gt;              3.0840 -134.645
## - x1    1    0.5302 3.6141 -130.067
## - x2    1    1.8839 4.9678 -112.888
## - x3    1    3.4862 6.5702  -97.792
## 
## Step:  AIC=-138.2
## lny ~ x1 + x2 + x3
## 
##        Df Sum of Sq    RSS      AIC
## &lt;none&gt;              3.1085 -138.205
## - x1    1    1.2040 4.3125 -124.516
## - x2    1    2.6724 5.7810 -108.691
## - x3    1    6.3341 9.4427  -82.195</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="reg.html#cb184-1" tabindex="-1"></a><span class="fu">summary</span>(fit.BstepBIC)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lny ~ x1 + x2 + x3, data = surgunit.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.46992 -0.17954 -0.03071  0.17883  0.59253 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.766176   0.226758  16.609  &lt; 2e-16 ***
## x1          0.095458   0.021692   4.401 5.67e-05 ***
## x2          0.013340   0.002035   6.556 2.97e-08 ***
## x3          0.016452   0.001630  10.094 1.17e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2493 on 50 degrees of freedom
## Multiple R-squared:  0.7573, Adjusted R-squared:  0.7427 
## F-statistic:    52 on 3 and 50 DF,  p-value: 2.124e-15</code></pre>
<hr />
</div>
<div id="cv-press-and-gcv" class="section level3 hasAnchor" number="3.8.6">
<h3><span class="header-section-number">3.8.6</span> CV (PRESS) and GCV<a href="reg.html#cv-press-and-gcv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cross-validation (CV) estimates model predictive accuracy using PRESS. Compute CV scores manually:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="reg.html#cb186-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">54</span></span>
<span id="cb186-2"><a href="reg.html#cb186-2" tabindex="-1"></a>cv_score <span class="ot">&lt;-</span> <span class="cf">function</span>(fit) {</span>
<span id="cb186-3"><a href="reg.html#cb186-3" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb186-4"><a href="reg.html#cb186-4" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(fit)</span>
<span id="cb186-5"><a href="reg.html#cb186-5" tabindex="-1"></a>  <span class="fu">mean</span>((res <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> h))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb186-6"><a href="reg.html#cb186-6" tabindex="-1"></a>}</span>
<span id="cb186-7"><a href="reg.html#cb186-7" tabindex="-1"></a></span>
<span id="cb186-8"><a href="reg.html#cb186-8" tabindex="-1"></a>CVfit1 <span class="ot">&lt;-</span> <span class="fu">cv_score</span>(fit1)</span>
<span id="cb186-9"><a href="reg.html#cb186-9" tabindex="-1"></a>CVfit2 <span class="ot">&lt;-</span> <span class="fu">cv_score</span>(fit2)</span>
<span id="cb186-10"><a href="reg.html#cb186-10" tabindex="-1"></a>CVfit3 <span class="ot">&lt;-</span> <span class="fu">cv_score</span>(fit3)</span>
<span id="cb186-11"><a href="reg.html#cb186-11" tabindex="-1"></a></span>
<span id="cb186-12"><a href="reg.html#cb186-12" tabindex="-1"></a>CVfit1; CVfit2; CVfit3</span></code></pre></div>
<pre><code>## [1] 0.05072096</code></pre>
<pre><code>## [1] 0.05069947</code></pre>
<pre><code>## [1] 0.1158974</code></pre>
<p>GCV adjusts for average leverage:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="reg.html#cb190-1" tabindex="-1"></a>gcv_score <span class="ot">&lt;-</span> <span class="cf">function</span>(fit) {</span>
<span id="cb190-2"><a href="reg.html#cb190-2" tabindex="-1"></a>  SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(fit)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb190-3"><a href="reg.html#cb190-3" tabindex="-1"></a>  h_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">hatvalues</span>(fit))</span>
<span id="cb190-4"><a href="reg.html#cb190-4" tabindex="-1"></a>  SSE <span class="sc">/</span> ((<span class="dv">1</span> <span class="sc">-</span> h_bar)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> n)</span>
<span id="cb190-5"><a href="reg.html#cb190-5" tabindex="-1"></a>}</span>
<span id="cb190-6"><a href="reg.html#cb190-6" tabindex="-1"></a></span>
<span id="cb190-7"><a href="reg.html#cb190-7" tabindex="-1"></a>gcvfit1 <span class="ot">&lt;-</span> <span class="fu">gcv_score</span>(fit1)</span>
<span id="cb190-8"><a href="reg.html#cb190-8" tabindex="-1"></a>gcvfit2 <span class="ot">&lt;-</span> <span class="fu">gcv_score</span>(fit2)</span>
<span id="cb190-9"><a href="reg.html#cb190-9" tabindex="-1"></a>gcvfit3 <span class="ot">&lt;-</span> <span class="fu">gcv_score</span>(fit3)</span>
<span id="cb190-10"><a href="reg.html#cb190-10" tabindex="-1"></a></span>
<span id="cb190-11"><a href="reg.html#cb190-11" tabindex="-1"></a>gcvfit1; gcvfit2; gcvfit3</span></code></pre></div>
<pre><code>## [1] 0.04928725</code></pre>
<pre><code>## [1] 0.04900256</code></pre>
<pre><code>## [1] 0.1165376</code></pre>
<hr />
</div>
</div>
<div id="more-diagnostics" class="section level2 hasAnchor" number="3.9">
<h2><span class="header-section-number">3.9</span> More Diagnostics<a href="reg.html#more-diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="identifying-outlying-y-and-x-values" class="section level3 hasAnchor" number="3.9.1">
<h3><span class="header-section-number">3.9.1</span> Identifying Outlying y and x Values<a href="reg.html#identifying-outlying-y-and-x-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Body Fat dataset illustrates detection of unusual observations via residual diagnostics.</p>
<p>Import data and visualize:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="reg.html#cb194-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%207%20Data%20Sets/CH07TA01.txt&quot;</span></span>
<span id="cb194-2"><a href="reg.html#cb194-2" tabindex="-1"></a>bf.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url, <span class="at">header=</span><span class="cn">FALSE</span>, <span class="at">col.names=</span><span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x3&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb194-3"><a href="reg.html#cb194-3" tabindex="-1"></a><span class="fu">glimpse</span>(bf.data)</span></code></pre></div>
<pre><code>## Rows: 20
## Columns: 4
## $ x1 &lt;dbl&gt; 19.5, 24.7, 30.7, 29.8, 19.1, 25.6, 31.4, 27.9, 22.1, 25.5, 31.1, 3…
## $ x2 &lt;dbl&gt; 43.1, 49.8, 51.9, 54.3, 42.2, 53.9, 58.5, 52.1, 49.9, 53.5, 56.6, 5…
## $ x3 &lt;dbl&gt; 29.1, 28.2, 37.0, 31.1, 30.9, 23.7, 27.6, 30.6, 23.2, 24.8, 30.0, 2…
## $ y  &lt;dbl&gt; 11.9, 22.8, 18.7, 20.1, 12.9, 21.7, 27.1, 25.4, 21.3, 19.3, 25.4, 2…</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="reg.html#cb196-1" tabindex="-1"></a><span class="fu">splom</span>(bf.data)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-73-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Fit model and extract diagnostics:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="reg.html#cb197-1" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, <span class="at">data=</span>bf.data)</span>
<span id="cb197-2"><a href="reg.html#cb197-2" tabindex="-1"></a></span>
<span id="cb197-3"><a href="reg.html#cb197-3" tabindex="-1"></a><span class="co"># Studentized residuals</span></span>
<span id="cb197-4"><a href="reg.html#cb197-4" tabindex="-1"></a><span class="fu">rstandard</span>(fit1)</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
## -1.46802633  1.13326956 -1.23262045 -1.29571232  0.57630252 -0.23525791 
##           7           8           9          10          11          12 
##  0.62249950  1.38022830  0.76529502 -0.57761774  0.34965240  0.94324119 
##          13          14          15          16          17          18 
## -1.50477923  1.84715613  0.49352568  0.07392664 -0.16107977 -0.63614383 
##          19          20 
## -1.61308352  0.25538013</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="reg.html#cb199-1" tabindex="-1"></a><span class="co"># Studentized deleted residuals</span></span>
<span id="cb199-2"><a href="reg.html#cb199-2" tabindex="-1"></a><span class="fu">rstudent</span>(fit1)</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
## -1.52803951  1.14416429 -1.25452990 -1.32606735  0.56388572 -0.22818249 
##           7           8           9          10          11          12 
##  0.61016668  1.42385079  0.75493974 -0.56519997  0.33985038  0.93979234 
##          13          14          15          16          17          18 
## -1.57251203  2.01637183  0.48153342  0.07159138 -0.15609143 -0.62388391 
##          19          20 
## -1.70680191  0.24777625</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="reg.html#cb201-1" tabindex="-1"></a><span class="co"># Leverage (hat values)</span></span>
<span id="cb201-2"><a href="reg.html#cb201-2" tabindex="-1"></a><span class="fu">hatvalues</span>(fit1)</span></code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
## 0.34120920 0.15653638 0.44042770 0.11242972 0.36109984 0.13151364 0.19433721 
##          8          9         10         11         12         13         14 
## 0.16418081 0.19278940 0.24051819 0.13935816 0.10929380 0.21357666 0.18808377 
##         15         16         17         18         19         20 
## 0.34830629 0.11439069 0.12532943 0.22828343 0.13235798 0.06597771</code></pre>
<p>Identify high-leverage points:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="reg.html#cb203-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span>; p <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb203-2"><a href="reg.html#cb203-2" tabindex="-1"></a><span class="fu">xyplot</span>(<span class="fu">hatvalues</span>(fit1) <span class="sc">~</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">panel=</span><span class="cf">function</span>(x, y) {</span>
<span id="cb203-3"><a href="reg.html#cb203-3" tabindex="-1"></a>  <span class="fu">panel.xyplot</span>(x, y)</span>
<span id="cb203-4"><a href="reg.html#cb203-4" tabindex="-1"></a>  <span class="fu">panel.abline</span>(<span class="at">h =</span> <span class="dv">3</span> <span class="sc">*</span> p <span class="sc">/</span> n, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb203-5"><a href="reg.html#cb203-5" tabindex="-1"></a>}, <span class="at">xlab =</span> <span class="st">&quot;Cases&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Leverage values&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.7</span>))</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-75-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="identifying-influential-cases" class="section level3 hasAnchor" number="3.9.2">
<h3><span class="header-section-number">3.9.2</span> Identifying Influential Cases<a href="reg.html#identifying-influential-cases" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>DFFITS</strong> measures the influence of each observation on its fitted value. Use <code>dffits()</code> with an <code>lm</code> object:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="reg.html#cb204-1" tabindex="-1"></a><span class="fu">dffits</span>(fit1)</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
## -1.09969231  0.49290457 -1.11298735 -0.47195954  0.42392423 -0.08879453 
##           7           8           9          10          11          12 
##  0.29967452  0.63105834  0.36894399 -0.31806611  0.13675485  0.32920196 
##          13          14          15          16          17          18 
## -0.81948815  0.97048913  0.35203458  0.02572972 -0.05908583 -0.33932204 
##          19          20 
## -0.66663467  0.06585362</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="reg.html#cb206-1" tabindex="-1"></a><span class="co"># Threshold: 2*sqrt(p/n), where p = predictors + 1</span></span>
<span id="cb206-2"><a href="reg.html#cb206-2" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>((<span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="dv">20</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">-</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 1.154701</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="reg.html#cb208-1" tabindex="-1"></a><span class="co"># Plot DFFITS vs. case number</span></span>
<span id="cb208-2"><a href="reg.html#cb208-2" tabindex="-1"></a><span class="fu">xyplot</span>(<span class="fu">dffits</span>(fit1) <span class="sc">~</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">panel =</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb208-3"><a href="reg.html#cb208-3" tabindex="-1"></a>  <span class="fu">panel.xyplot</span>(x, y)</span>
<span id="cb208-4"><a href="reg.html#cb208-4" tabindex="-1"></a>  <span class="fu">panel.abline</span>(<span class="at">h =</span> <span class="fl">1.154701</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb208-5"><a href="reg.html#cb208-5" tabindex="-1"></a>}, <span class="at">xlab =</span> <span class="st">&quot;Cases&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;DFFITS&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.2</span>))</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-76-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Cook’s Distance</strong> quantifies influence across all fitted values. Use <code>cooks.distance()</code>:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="reg.html#cb209-1" tabindex="-1"></a><span class="fu">cooks.distance</span>(fit1)</span></code></pre></div>
<pre><code>##            1            2            3            4            5            6 
## 0.2790492817 0.0595875286 0.2989628090 0.0531661934 0.0469283564 0.0020952519 
##            7            8            9           10           11           12 
## 0.0233679530 0.0935517519 0.0349698759 0.0264150596 0.0049490632 0.0272927035 
##           13           14           15           16           17           18 
## 0.1537386238 0.1976001749 0.0325444771 0.0001764779 0.0009294597 0.0299272765 
##           19           20 
## 0.0992346339 0.0011517393</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="reg.html#cb211-1" tabindex="-1"></a><span class="co"># Guidelines: D_i &gt; 0.5 may be influential; D_i &gt; 1 likely influential</span></span>
<span id="cb211-2"><a href="reg.html#cb211-2" tabindex="-1"></a></span>
<span id="cb211-3"><a href="reg.html#cb211-3" tabindex="-1"></a><span class="fu">xyplot</span>(<span class="fu">cooks.distance</span>(fit1) <span class="sc">~</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">panel =</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb211-4"><a href="reg.html#cb211-4" tabindex="-1"></a>  <span class="fu">panel.xyplot</span>(x, y)</span>
<span id="cb211-5"><a href="reg.html#cb211-5" tabindex="-1"></a>  <span class="fu">panel.abline</span>(<span class="at">h =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb211-6"><a href="reg.html#cb211-6" tabindex="-1"></a>  <span class="fu">panel.abline</span>(<span class="at">h =</span> <span class="fl">1.0</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb211-7"><a href="reg.html#cb211-7" tabindex="-1"></a>}, <span class="at">xlab =</span> <span class="st">&quot;Cases&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cook&#39;s Distance&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.2</span>))</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-77-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basics.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
