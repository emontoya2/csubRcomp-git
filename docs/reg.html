<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 R code for Regression Analysis | An R companion</title>
  <meta name="description" content="A freely available document meant to help students learn R concurrently with the material of the course." />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 R code for Regression Analysis | An R companion" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A freely available document meant to help students learn R concurrently with the material of the course." />
  <meta name="github-repo" content="emontoya2/csubRcomp-git" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 R code for Regression Analysis | An R companion" />
  
  <meta name="twitter:description" content="A freely available document meant to help students learn R concurrently with the material of the course." />
  

<meta name="author" content="Eduardo Montoya" />


<meta name="date" content="2022-06-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basics.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">An R companion for undergraduate regression and ANOVA</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction: Getting Familiar with R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#what-is-r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> What is R and RStudio?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#downloading-and-installing-r"><i class="fa fa-check"></i><b>1.2</b> Downloading and installing R</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#downloading-and-installing-rstudio"><i class="fa fa-check"></i><b>1.3</b> Downloading and installing RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#the-layout-of-rstudio"><i class="fa fa-check"></i><b>1.4</b> The layout of RStudio</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#expressions-and-assignments"><i class="fa fa-check"></i><b>1.5</b> Expressions and Assignments</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#entering-and-running-r-code-in-rstudio"><i class="fa fa-check"></i><b>1.6</b> Entering and running R code in RStudio</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#a-fancy-calculator"><i class="fa fa-check"></i><b>1.7</b> A fancy calculator</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#working-with-vectors"><i class="fa fa-check"></i><b>1.8</b> Working with vectors</a></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#data-types-in-r"><i class="fa fa-check"></i><b>1.9</b> Data types in R</a></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#comments-in-r"><i class="fa fa-check"></i><b>1.10</b> Comments in R</a></li>
<li class="chapter" data-level="1.11" data-path="intro.html"><a href="intro.html#using-r-functions"><i class="fa fa-check"></i><b>1.11</b> Using R functions</a></li>
<li class="chapter" data-level="1.12" data-path="intro.html"><a href="intro.html#loading-a-package-and-installing-new-packages"><i class="fa fa-check"></i><b>1.12</b> Loading a package and installing new packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Some basic R tasks</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#using-rs-built-in-datasets-and-viewing-datasets"><i class="fa fa-check"></i><b>2.1</b> Using R’s built-in datasets and “viewing” datasets</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#csv-files"><i class="fa fa-check"></i><b>2.2</b> .csv files</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#importing-a-.csv-file"><i class="fa fa-check"></i><b>2.3</b> Importing a .csv file</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="basics.html"><a href="basics.html#importing-data-via-a-url"><i class="fa fa-check"></i><b>2.3.1</b> Importing data via a url</a></li>
<li class="chapter" data-level="2.3.2" data-path="basics.html"><a href="basics.html#importing-data-from-your-computer"><i class="fa fa-check"></i><b>2.3.2</b> Importing data from your computer</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#using-rstudios-data-import-feature"><i class="fa fa-check"></i><b>2.4</b> Using RStudio’s data import feature</a></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#summarizing-data"><i class="fa fa-check"></i><b>2.5</b> Summarizing data</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#export-an-r-plot-or-r-output"><i class="fa fa-check"></i><b>2.6</b> Export an R plot or R output</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="basics.html"><a href="basics.html#exporting-graphs"><i class="fa fa-check"></i><b>2.6.1</b> Exporting graphs</a></li>
<li class="chapter" data-level="2.6.2" data-path="basics.html"><a href="basics.html#exporting-r-output"><i class="fa fa-check"></i><b>2.6.2</b> Exporting R output</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#extracting-variables-from-dataframes"><i class="fa fa-check"></i><b>2.7</b> Extracting variables from dataframes</a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#understanding-common-r-errors"><i class="fa fa-check"></i><b>2.8</b> Understanding common R errors</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="basics.html"><a href="basics.html#could-not-find-function"><i class="fa fa-check"></i><b>2.8.1</b> could not find function</a></li>
<li class="chapter" data-level="2.8.2" data-path="basics.html"><a href="basics.html#object-not-found"><i class="fa fa-check"></i><b>2.8.2</b> object not found</a></li>
<li class="chapter" data-level="2.8.3" data-path="basics.html"><a href="basics.html#unmatched-parenthesis"><i class="fa fa-check"></i><b>2.8.3</b> Unmatched parenthesis</a></li>
<li class="chapter" data-level="2.8.4" data-path="basics.html"><a href="basics.html#the-some-package-package-is-not-available-for-r-version-some-version"><i class="fa fa-check"></i><b>2.8.4</b> The ‘Some package’ package is not available (for R version ‘some version’)</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="basics.html"><a href="basics.html#help-files"><i class="fa fa-check"></i><b>2.9</b> Help files</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reg.html"><a href="reg.html"><i class="fa fa-check"></i><b>3</b> R code for Regression Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="reg.html"><a href="reg.html#linear-regression-with-one-predictor-variable"><i class="fa fa-check"></i><b>3.1</b> Linear Regression with One Predictor Variable</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="reg.html"><a href="reg.html#scatterplots"><i class="fa fa-check"></i><b>3.1.1</b> Scatterplots</a></li>
<li class="chapter" data-level="3.1.2" data-path="reg.html"><a href="reg.html#least-squares-ls-estimates"><i class="fa fa-check"></i><b>3.1.2</b> Least Squares (LS) Estimates</a></li>
<li class="chapter" data-level="3.1.3" data-path="reg.html"><a href="reg.html#plotting-the-estimated-regression-line"><i class="fa fa-check"></i><b>3.1.3</b> Plotting the estimated regression line</a></li>
<li class="chapter" data-level="3.1.4" data-path="reg.html"><a href="reg.html#fitted-or-predicted-values"><i class="fa fa-check"></i><b>3.1.4</b> Fitted or predicted values</a></li>
<li class="chapter" data-level="3.1.5" data-path="reg.html"><a href="reg.html#residuals"><i class="fa fa-check"></i><b>3.1.5</b> Residuals</a></li>
<li class="chapter" data-level="3.1.6" data-path="reg.html"><a href="reg.html#summary-lm-object-output"><i class="fa fa-check"></i><b>3.1.6</b> <code>summary(</code> <em>lm object</em> <code>)</code> output</a></li>
<li class="chapter" data-level="3.1.7" data-path="reg.html"><a href="reg.html#estimating-of-sigma2"><i class="fa fa-check"></i><b>3.1.7</b> Estimating of <span class="math inline">\(\sigma^2\)</span></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="reg.html"><a href="reg.html#inference-in-simple-linear-regression"><i class="fa fa-check"></i><b>3.2</b> Inference in simple linear regression</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="reg.html"><a href="reg.html#inferences-for-beta_0-and-beta_1"><i class="fa fa-check"></i><b>3.2.1</b> Inferences for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span></a></li>
<li class="chapter" data-level="3.2.2" data-path="reg.html"><a href="reg.html#ci-for-the-mean-response-ey_h-and-a-prediction-interval-for-y_h"><i class="fa fa-check"></i><b>3.2.2</b> CI for the mean response (<span class="math inline">\(E(y_h)\)</span>) and a prediction interval for <span class="math inline">\(y_h\)</span></a></li>
<li class="chapter" data-level="3.2.3" data-path="reg.html"><a href="reg.html#analysis-of-variance-approach-to-regression-analysis"><i class="fa fa-check"></i><b>3.2.3</b> Analysis of Variance approach to regression analysis</a></li>
<li class="chapter" data-level="3.2.4" data-path="reg.html"><a href="reg.html#measures-of-association"><i class="fa fa-check"></i><b>3.2.4</b> Measures of association</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="reg.html"><a href="reg.html#residual-analysis-and-remedial-measures"><i class="fa fa-check"></i><b>3.3</b> Residual analysis and remedial measures</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="reg.html"><a href="reg.html#creating-residual-plots"><i class="fa fa-check"></i><b>3.3.1</b> Creating residual plots</a></li>
<li class="chapter" data-level="3.3.2" data-path="reg.html"><a href="reg.html#residual-plots-from-the-tactile-package"><i class="fa fa-check"></i><b>3.3.2</b> Residual plots from the tactile package</a></li>
<li class="chapter" data-level="3.3.3" data-path="reg.html"><a href="reg.html#testing-departures-from-normality"><i class="fa fa-check"></i><b>3.3.3</b> Testing departures from normality</a></li>
<li class="chapter" data-level="3.3.4" data-path="reg.html"><a href="reg.html#transformations"><i class="fa fa-check"></i><b>3.3.4</b> Transformations</a></li>
<li class="chapter" data-level="3.3.5" data-path="reg.html"><a href="reg.html#f-test-for-lack-of-fit"><i class="fa fa-check"></i><b>3.3.5</b> F Test for Lack of Fit</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="reg.html"><a href="reg.html#least-absolute-deviation-lad-regression"><i class="fa fa-check"></i><b>3.4</b> Least absolute deviation (LAD) regression</a></li>
<li class="chapter" data-level="3.5" data-path="reg.html"><a href="reg.html#the-matrix-approach-to-simple-linear-regression"><i class="fa fa-check"></i><b>3.5</b> The matrix approach to simple linear regression</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="reg.html"><a href="reg.html#creating-a-matrix"><i class="fa fa-check"></i><b>3.5.1</b> Creating a matrix</a></li>
<li class="chapter" data-level="3.5.2" data-path="reg.html"><a href="reg.html#some-matrix-operations"><i class="fa fa-check"></i><b>3.5.2</b> Some matrix operations</a></li>
<li class="chapter" data-level="3.5.3" data-path="reg.html"><a href="reg.html#ls-estimation"><i class="fa fa-check"></i><b>3.5.3</b> LS estimation</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="reg.html"><a href="reg.html#multiple-linear-regression-mlr"><i class="fa fa-check"></i><b>3.6</b> Multiple linear regression (MLR)</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="reg.html"><a href="reg.html#least-squares-estimates"><i class="fa fa-check"></i><b>3.6.1</b> Least-Squares Estimates</a></li>
<li class="chapter" data-level="3.6.2" data-path="reg.html"><a href="reg.html#fitted-values-anova-table-residuals"><i class="fa fa-check"></i><b>3.6.2</b> Fitted values, ANOVA table, residuals</a></li>
<li class="chapter" data-level="3.6.3" data-path="reg.html"><a href="reg.html#inference-about-the-regression-parameters"><i class="fa fa-check"></i><b>3.6.3</b> Inference about the regression parameters</a></li>
<li class="chapter" data-level="3.6.4" data-path="reg.html"><a href="reg.html#inference-about-the-mean-response-and-prediction-of-new-observation"><i class="fa fa-check"></i><b>3.6.4</b> Inference about the Mean Response and Prediction of New Observation</a></li>
<li class="chapter" data-level="3.6.5" data-path="reg.html"><a href="reg.html#diagnostics"><i class="fa fa-check"></i><b>3.6.5</b> Diagnostics</a></li>
<li class="chapter" data-level="3.6.6" data-path="reg.html"><a href="reg.html#anova-table-containing-decomposition-of-ssr"><i class="fa fa-check"></i><b>3.6.6</b> ANOVA table containing decomposition of SSR</a></li>
<li class="chapter" data-level="3.6.7" data-path="reg.html"><a href="reg.html#testing-whether-beta_k-neq-0-for-some-k"><i class="fa fa-check"></i><b>3.6.7</b> Testing whether <span class="math inline">\(\beta_k \neq 0\)</span> for some <span class="math inline">\(k\)</span></a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="reg.html"><a href="reg.html#interactions"><i class="fa fa-check"></i><b>3.7</b> Interactions</a></li>
<li class="chapter" data-level="3.8" data-path="reg.html"><a href="reg.html#standardized-multiple-regression"><i class="fa fa-check"></i><b>3.8</b> Standardized multiple regression</a></li>
<li class="chapter" data-level="3.9" data-path="reg.html"><a href="reg.html#polynomial-regression-and-regression-with-categorical-variables"><i class="fa fa-check"></i><b>3.9</b> Polynomial regression and regression with categorical variables</a></li>
<li class="chapter" data-level="3.10" data-path="reg.html"><a href="reg.html#model-selection"><i class="fa fa-check"></i><b>3.10</b> Model selection</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="reg.html"><a href="reg.html#r_ap2-and-c_p"><i class="fa fa-check"></i><b>3.10.1</b> <span class="math inline">\(R_{a,p}^2\)</span> and <span class="math inline">\(C_p\)</span></a></li>
<li class="chapter" data-level="3.10.2" data-path="reg.html"><a href="reg.html#aic_p"><i class="fa fa-check"></i><b>3.10.2</b> <span class="math inline">\(AIC_p\)</span></a></li>
<li class="chapter" data-level="3.10.3" data-path="reg.html"><a href="reg.html#bic_p-or-sbc_p"><i class="fa fa-check"></i><b>3.10.3</b> <span class="math inline">\(BIC_p\)</span> or <span class="math inline">\(SBC_p\)</span></a></li>
<li class="chapter" data-level="3.10.4" data-path="reg.html"><a href="reg.html#aicc_p"><i class="fa fa-check"></i><b>3.10.4</b> <span class="math inline">\(AICc_p\)</span></a></li>
<li class="chapter" data-level="3.10.5" data-path="reg.html"><a href="reg.html#stepwise-regression"><i class="fa fa-check"></i><b>3.10.5</b> Stepwise regression</a></li>
<li class="chapter" data-level="3.10.6" data-path="reg.html"><a href="reg.html#cvpress-and-gcv"><i class="fa fa-check"></i><b>3.10.6</b> CV/PRESS and GCV</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="reg.html"><a href="reg.html#more-diagnostics"><i class="fa fa-check"></i><b>3.11</b> More diagnostics</a>
<ul>
<li class="chapter" data-level="3.11.1" data-path="reg.html"><a href="reg.html#identifying-outlying-y-and-x-values"><i class="fa fa-check"></i><b>3.11.1</b> Identifying outlying y and x values</a></li>
<li class="chapter" data-level="3.11.2" data-path="reg.html"><a href="reg.html#identifying-influential-cases"><i class="fa fa-check"></i><b>3.11.2</b> Identifying influential cases</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An R companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reg" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> R code for Regression Analysis<a href="reg.html#reg" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The goal of this chapter is to have you learn to use <strong>R</strong> to carry out the analyses and techniques generally covered in a regression analysis course. Currently, we carry out some of the
examples using <strong>R</strong> found in</p>
<p>Kutner M.H, Nachtsheim C.J, and Neter, J., <em>Applied</em> <em>Linear</em> <em>Regression</em> <em>Models</em>. McGraw-Hill/Irwin.</p>
<p>The abbreviation ALRM is used for this textbook. Datasets for this textbook may be found at</p>
<p><a href="https://www.csub.edu/~emontoya2/datasets/textbookdata/index.html">https://www.csub.edu/~emontoya2/datasets/textbookdata/index.html</a></p>
<div id="linear-regression-with-one-predictor-variable" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Linear Regression with One Predictor Variable<a href="reg.html#linear-regression-with-one-predictor-variable" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we use R to fit the simple linear regression (SLM) model
<span class="math display">\[
y_i=\beta_0+\beta_1 x_i + \varepsilon_i  
\]</span>
where <span class="math inline">\(y_i\)</span> is the dependent/response variable, <span class="math inline">\(x_i\)</span> is the independent/predictor variable, and the random error terms have mean 0, constant variance <span class="math inline">\(\sigma^2\)</span> and are uncorrelated. We follow the Toluca Company example given in ALRM to illustrate how to use <strong>R</strong> to obtain scatter plots, the least square estimates, fitted values, residuals, and a point estimator of <span class="math inline">\(\sigma^2\)</span>.</p>
<div id="scatterplots" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Scatterplots<a href="reg.html#scatterplots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Scatterplots can be used to explore the relationship between two variables. Recall that the formula to create a graphical numerical summary follows the general form <code>goal( ~ x , data)</code> where <code>x</code> is the variable you want to graph. However, now we have an additional variable. When the data is bivariate the general formula changes a bit: <code>goal( y ~ x , data )</code>, where <code>y</code> is the name of the response/dependent variable and <code>x</code> is the name of the explanatory/predictor variable. To create a scatterplot, <code>goal</code> is replaced with <code>xyplot</code>.</p>
<p>We begin by importing the data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="reg.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( mosaic ) <span class="co"># always load the mosaic package first.</span></span>
<span id="cb1-2"><a href="reg.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">### The datasets from the book are available to download or</span></span>
<span id="cb1-3"><a href="reg.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">### read from a url, but we have to make some changes </span></span>
<span id="cb1-4"><a href="reg.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">### to read.csv() because these files are not csv files.</span></span>
<span id="cb1-5"><a href="reg.html#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="reg.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Import data:</span></span>
<span id="cb1-7"><a href="reg.html#cb1-7" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%201%20Data%20Sets/CH01TA01.txt&quot;</span></span>
<span id="cb1-8"><a href="reg.html#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="reg.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">### Use this as a template for importing datasets referenced </span></span>
<span id="cb1-10"><a href="reg.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">### in the textbook.</span></span>
<span id="cb1-11"><a href="reg.html#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="reg.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="do">### This is not a .csv file and the file does not</span></span>
<span id="cb1-13"><a href="reg.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">### include variable names, so some changes</span></span>
<span id="cb1-14"><a href="reg.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">### have to be made to read.csv().</span></span>
<span id="cb1-15"><a href="reg.html#cb1-15" aria-hidden="true" tabindex="-1"></a>toluca.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( url , <span class="at">header =</span> <span class="cn">FALSE</span> , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;xvar&quot;</span>, <span class="st">&quot;yvar&quot;</span>) , <span class="at">sep =</span> <span class="st">&quot;&quot;</span> )</span></code></pre></div>
<p>We can take a quick look at the data by using <code>glimpse( )</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="reg.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( toluca.data )</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 2
## $ xvar &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 10…
## $ yvar &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389, …</code></pre>
<p>Note that we named the response variable and explanatory variable <span class="math inline">\(yvar\)</span> and <span class="math inline">\(xvar\)</span>, respectively. So these names must be used in <code>xyplot( )</code> or any other function that uses <code>toluca.data</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="reg.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>( yvar <span class="sc">~</span> xvar , <span class="at">data=</span> toluca.data)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The function <code>xyplot( )</code> has other arguments that allows you to change label axis, add a title, etc.:</p>
<pre><code>### xyplot( y  ~  x  | gfactor, data, main, xlab, ylab, col, pch)
# y: respnose variable
# x: explanatory variable
# gfactor: a factor variable (optional) so that a plot is returned for each level of f1 (optional)
# data: the name of the dataframe where the observed data is found
# main: title for plot  (optional) 
# ylab: label for y-axis (optional) 
# xlab: label for x-axis (optional) 
# pch:  point symbol. Must be a number between 1-25 (optional) </code></pre>
</div>
<div id="least-squares-ls-estimates" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Least Squares (LS) Estimates<a href="reg.html#least-squares-ls-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To obtain the LS estimates, we can either compute them using the algebraic formulas or fit the SLR model using the function <code>lm( )</code>. The <code>lm( )</code> function follows the general form of <code>goal( y ~ x , data )</code>, where goal is replaced with <code>lm</code>. Note that <code>lm</code> stands for linear model.</p>
<p>To illustrate the first method, recall that the LS estimators of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> are</p>
<p><span class="math display">\[
b_1=\frac{\sum (x_i-\bar{x})(y_i-\bar{y}) }{\sum (x_i-\bar{x})^2}, \quad ~~~~b_0=\bar{y}- b_1\bar{x}
\]</span>
To apply these formulas, we use the function <code>mean( )</code>. This function follows the general form <code>goal( ~ x , data)</code> but <code>goal</code> becomes <code>mean</code> :</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="reg.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">### extract &#39;xvar&#39; and assign the values to `myx&#39;:</span></span>
<span id="cb6-2"><a href="reg.html#cb6-2" aria-hidden="true" tabindex="-1"></a>myx <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>xvar</span>
<span id="cb6-3"><a href="reg.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">### same for yvar:</span></span>
<span id="cb6-4"><a href="reg.html#cb6-4" aria-hidden="true" tabindex="-1"></a>myy <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>yvar</span>
<span id="cb6-5"><a href="reg.html#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="reg.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Compute required differences.</span></span>
<span id="cb6-7"><a href="reg.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Note that we have no data argument </span></span>
<span id="cb6-8"><a href="reg.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="do">### since &#39;myx&#39; was defined above and is </span></span>
<span id="cb6-9"><a href="reg.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="do">### not part of a dataframe.</span></span>
<span id="cb6-10"><a href="reg.html#cb6-10" aria-hidden="true" tabindex="-1"></a>XminusXbar <span class="ot">&lt;-</span> myx <span class="sc">-</span> <span class="fu">mean</span>( <span class="sc">~</span> myx )  </span>
<span id="cb6-11"><a href="reg.html#cb6-11" aria-hidden="true" tabindex="-1"></a>YminusYbar <span class="ot">&lt;-</span> myy <span class="sc">-</span> <span class="fu">mean</span>( <span class="sc">~</span> myy )</span>
<span id="cb6-12"><a href="reg.html#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="reg.html#cb6-13" aria-hidden="true" tabindex="-1"></a>XminusXbarSq <span class="ot">&lt;-</span> XminusXbar<span class="sc">^</span><span class="dv">2</span> <span class="co"># squared differences</span></span>
<span id="cb6-14"><a href="reg.html#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="reg.html#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="do">### Apply for LS formulas for LS estimates</span></span>
<span id="cb6-16"><a href="reg.html#cb6-16" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.1</span><span class="ot">=</span><span class="fu">sum</span>(  ( myx <span class="sc">-</span> <span class="fu">mean</span>( <span class="sc">~</span> myx) )<span class="sc">*</span>( myy <span class="sc">-</span> <span class="fu">mean</span>( <span class="sc">~</span> myy ) ) )<span class="sc">/</span><span class="fu">sum</span>( ( myx<span class="sc">-</span><span class="fu">mean</span>( <span class="sc">~</span> myx ) )<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb6-17"><a href="reg.html#cb6-17" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.1</span></span></code></pre></div>
<pre><code>## [1] 3.570202</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="reg.html#cb8-1" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.0</span><span class="ot">=</span><span class="fu">mean</span>( <span class="sc">~</span> myy ) <span class="sc">-</span> b<span class="fl">.1</span><span class="sc">*</span><span class="fu">mean</span>( <span class="sc">~</span> myx )</span>
<span id="cb8-2"><a href="reg.html#cb8-2" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.0</span></span></code></pre></div>
<pre><code>## [1] 62.36586</code></pre>
<p>Thus, <span class="math inline">\(b_1=3.570\)</span> and <span class="math inline">\(b_0=62.366\)</span>.</p>
<p>The <code>lm( )</code> function follows the formula <code>goal( y ~ x , data )</code>. This function requires the name of the dataframe and the variables used in the dataframe. Recall that the variables in <code>toluca.data</code> are called <code>yvar</code> and <code>xvar</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="reg.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">### fit the model</span></span>
<span id="cb10-2"><a href="reg.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>( yvar <span class="sc">~</span> xvar , <span class="at">data=</span> toluca.data )</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = yvar ~ xvar, data = toluca.data)
## 
## Coefficients:
## (Intercept)         xvar  
##       62.37         3.57</code></pre>
<p>Although the <code>lm( )</code> function only prints the LS estimates, it actually computes a lot of information that is only retrievable if we store the <code>lm( )</code> result in an <em>R object</em>. Such objects are generally called <em>lm objects</em>. So, we store the result of <code>lm( )</code> to an R object (I called it <code>toluca.fit</code> below) so that we can extract certain information as needed:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="reg.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">### fit the model and store the model fit</span></span>
<span id="cb12-2"><a href="reg.html#cb12-2" aria-hidden="true" tabindex="-1"></a>toluca.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>( yvar <span class="sc">~</span> xvar , <span class="at">data=</span> toluca.data)</span></code></pre></div>
<p>To view the LS estimates, we summarize the <em>lm object</em>, <code>toluca.fit</code>, using the <code>summary( )</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="reg.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">### summarize the fit &lt;-- returns alot of info</span></span>
<span id="cb13-2"><a href="reg.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( toluca.fit )</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = yvar ~ xvar, data = toluca.data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -83.876 -34.088  -5.982  38.826 103.528 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   62.366     26.177   2.382   0.0259 *  
## xvar           3.570      0.347  10.290 4.45e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 48.82 on 23 degrees of freedom
## Multiple R-squared:  0.8215, Adjusted R-squared:  0.8138 
## F-statistic: 105.9 on 1 and 23 DF,  p-value: 4.449e-10</code></pre>
<p>From the <code>summary( )</code> output, we see that <span class="math inline">\(b_0=62.366\)</span> and <span class="math inline">\(b_1=3.570\)</span>. More on the output provided by <code>summary( )</code> later.</p>
<p>Alternateivly, we can extract the LS estimates by applying the function <code>coef()</code> to the <em>lm object</em>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="reg.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">### The only info required is the name </span></span>
<span id="cb15-2"><a href="reg.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">### your lm object.</span></span>
<span id="cb15-3"><a href="reg.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>( toluca.fit )</span></code></pre></div>
<pre><code>## (Intercept)        xvar 
##   62.365859    3.570202</code></pre>
</div>
<div id="plotting-the-estimated-regression-line" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Plotting the estimated regression line<a href="reg.html#plotting-the-estimated-regression-line" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once we have access to our data or we fit and save the simple linear regression model using <code>lm( )</code>, we can plot the data along with the estimated LS line. There are two approaches for plotting the LS line: <code>xyplot( )</code> or <code>plotModel( )</code>.</p>
<div id="using-xyplot" class="section level4 hasAnchor" number="3.1.3.1">
<h4><span class="header-section-number">3.1.3.1</span> Using <code>xyplot( )</code><a href="reg.html#using-xyplot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The function <code>xyplot( )</code> is used the same way as before but with an additional argument of <code>type= c( "p", "r" )</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="reg.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot the data and model fit.</span></span>
<span id="cb17-2"><a href="reg.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Note: &quot;p&quot; tells R we want to plot the points.</span></span>
<span id="cb17-3"><a href="reg.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">###       &quot;r&quot; tells R we want to add the est. regression </span></span>
<span id="cb17-4"><a href="reg.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">###        line to the plot</span></span>
<span id="cb17-5"><a href="reg.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>( yvar <span class="sc">~</span> xvar , <span class="at">data=</span> toluca.data , <span class="at">type=</span> <span class="fu">c</span>( <span class="st">&quot;p&quot;</span>, <span class="st">&quot;r&quot;</span> ) )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The argument<code>type= c( "p", "r" )</code> tells <strong>R</strong> to plot the points and the estiamted regression line. Also recall that <code>xyplot( )</code> has additional arguments to change axis label, add a title, etc.</p>
</div>
<div id="using-plotmodel" class="section level4 hasAnchor" number="3.1.3.2">
<h4><span class="header-section-number">3.1.3.2</span> Using <code>plotModel( )</code><a href="reg.html#using-plotmodel" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>plotModel( )</code> will plot the data and the estimated LS line. It only has one argument, which will be an <em>lm object</em>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="reg.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot the data and model fit.</span></span>
<span id="cb18-2"><a href="reg.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotModel</span>( toluca.fit )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Which function should one use? They both provide the same info, but if you prefer to change some of the aesthetics of the plot, you will have to use <code>xyplot( )</code> since, as of now, it is not possible to change the aesthetics of resulting plot provided by <code>plotModel( )</code>. For example:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="reg.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>( yvar <span class="sc">~</span> xvar , <span class="at">data =</span> toluca.data , <span class="at">type=</span> <span class="fu">c</span>( <span class="st">&quot;p&quot;</span>, <span class="st">&quot;r&quot;</span> ), <span class="at">xlab =</span> <span class="st">&quot;Explanatory variable&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Response variable&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Estimated LS line&quot;</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">pch =</span> <span class="dv">3</span> )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="fitted-or-predicted-values" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Fitted or predicted values<a href="reg.html#fitted-or-predicted-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To obtain the fitted vales, <span class="math inline">\(\hat{y}_i=b_0+b_1 x_i\)</span> for <span class="math inline">\(i=1,2,...,n\)</span>, we may use <strong>R</strong> by directly using the least square estimates obtained by using the summation formulas or more conveniently use the <code>fitted.values( )</code> or <code>predict( )</code> on an <em>lm object</em>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="reg.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Only one argument: An lm object</span></span>
<span id="cb20-2"><a href="reg.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted.values</span>( toluca.fit )</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 347.9820 169.4719 240.8760 383.6840 312.2800 276.5780 490.7901 347.9820 
##        9       10       11       12       13       14       15       16 
## 419.3861 240.8760 205.1739 312.2800 383.6840 133.7699 455.0881 419.3861 
##       17       18       19       20       21       22       23       24 
## 169.4719 240.8760 383.6840 455.0881 169.4719 383.6840 205.1739 347.9820 
##       25 
## 312.2800</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="reg.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">### predict( ) </span></span>
<span id="cb22-2"><a href="reg.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>( toluca.fit )</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 347.9820 169.4719 240.8760 383.6840 312.2800 276.5780 490.7901 347.9820 
##        9       10       11       12       13       14       15       16 
## 419.3861 240.8760 205.1739 312.2800 383.6840 133.7699 455.0881 419.3861 
##       17       18       19       20       21       22       23       24 
## 169.4719 240.8760 383.6840 455.0881 169.4719 383.6840 205.1739 347.9820 
##       25 
## 312.2800</code></pre>
<p>Both <code>fitted.values( )</code> or <code>predict( )</code> can provided the fitted/predicted values for the observed values of <span class="math inline">\(x\)</span>. If instead you wanted to predict or fit values of <span class="math inline">\(y\)</span> for certain levels or values of <span class="math inline">\(x\)</span>, we use <code>predict( )</code> with an additional argument that corresponds to a dataframe that holds the x value(s) of interest. For example:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="reg.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">### This is a template on how to predict values of y</span></span>
<span id="cb24-2"><a href="reg.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="do">### for certain values of x.  </span></span>
<span id="cb24-3"><a href="reg.html#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="reg.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Suppose we wanted to predict the response when x=31 or x=119.</span></span>
<span id="cb24-5"><a href="reg.html#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="do">### First set up the dataframe that holds these values.  Note that </span></span>
<span id="cb24-6"><a href="reg.html#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="do">### we have to use the name &#39;xvar&#39; since this is the name of </span></span>
<span id="cb24-7"><a href="reg.html#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="do">### the predictor in toluca.data.</span></span>
<span id="cb24-8"><a href="reg.html#cb24-8" aria-hidden="true" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">xvar=</span><span class="fu">c</span>(<span class="dv">31</span>, <span class="dv">119</span>) ) <span class="co"># &#39;x&#39; is the name of</span></span>
<span id="cb24-9"><a href="reg.html#cb24-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="co"># explanatory variable in the dataframe</span></span>
<span id="cb24-10"><a href="reg.html#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="reg.html#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="do">### You have to specifiy an &#39;lm object&#39;.</span></span>
<span id="cb24-12"><a href="reg.html#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="do">### newdata is a data frame holds the x values of interest.</span></span>
<span id="cb24-13"><a href="reg.html#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>( toluca.fit , <span class="at">newdata=</span> newdat )</span></code></pre></div>
<pre><code>##        1        2 
## 173.0421 487.2199</code></pre>
</div>
<div id="residuals" class="section level3 hasAnchor" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Residuals<a href="reg.html#residuals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The residuals are the differences between the observed values and the fitted values, denoted by <span class="math inline">\(e_i=y_i-\hat{y}_i\)</span>. The residuals can be obtained using the function <code>residuals( )</code> whose only argument is an <em>lm object</em>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="reg.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">### You have to specifiy an &#39;lm object&#39;.</span></span>
<span id="cb26-2"><a href="reg.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>( toluca.fit )</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
##  51.0179798 -48.4719192 -19.8759596  -7.6840404  48.7200000 -52.5779798 
##           7           8           9          10          11          12 
##  55.2098990   4.0179798 -66.3860606 -83.8759596 -45.1739394 -60.2800000 
##          13          14          15          16          17          18 
##   5.3159596 -20.7698990 -20.0880808   0.6139394  42.5280808  27.1240404 
##          19          20          21          22          23          24 
##  -6.6840404 -34.0880808 103.5280808  84.3159596  38.8260606  -5.9820202 
##          25 
##  10.7200000</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="reg.html#cb28-1" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">residuals</span>( toluca.fit ) <span class="co"># store them in a object called &#39;e&#39;</span></span></code></pre></div>
<p>You may also compute them via:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="reg.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">### You have to specifiy an &#39;lm object&#39;.</span></span>
<span id="cb29-2"><a href="reg.html#cb29-2" aria-hidden="true" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">fitted.values</span>( toluca.fit )</span>
<span id="cb29-3"><a href="reg.html#cb29-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb29-4"><a href="reg.html#cb29-4" aria-hidden="true" tabindex="-1"></a>toluca.data<span class="sc">$</span>yvar <span class="sc">-</span> yhat <span class="co"># observed - fitted/predicted</span></span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
##  51.0179798 -48.4719192 -19.8759596  -7.6840404  48.7200000 -52.5779798 
##           7           8           9          10          11          12 
##  55.2098990   4.0179798 -66.3860606 -83.8759596 -45.1739394 -60.2800000 
##          13          14          15          16          17          18 
##   5.3159596 -20.7698990 -20.0880808   0.6139394  42.5280808  27.1240404 
##          19          20          21          22          23          24 
##  -6.6840404 -34.0880808 103.5280808  84.3159596  38.8260606  -5.9820202 
##          25 
##  10.7200000</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="reg.html#cb31-1" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>yvar <span class="sc">-</span> yhat <span class="co"># store the result</span></span></code></pre></div>
</div>
<div id="summary-lm-object-output" class="section level3 hasAnchor" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> <code>summary(</code> <em>lm object</em> <code>)</code> output<a href="reg.html#summary-lm-object-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So what is printed by <code>summary(</code> <em>lm object</em> <code>)</code>? The following output is given:</p>
<p><img src="ch3figures/summary.png" style="width:90.0%" alt="Figure 3.1" />
The <code>summary( )</code> output provides the LS estimates, the standard errors of the LS estimates, the test statistic for the regression line parameters, two-sided p-value to assess the significance of these parameters, the MSE, <span class="math inline">\(R^2\)</span>, and other information that we will revisit later.</p>
</div>
<div id="estimating-of-sigma2" class="section level3 hasAnchor" number="3.1.7">
<h3><span class="header-section-number">3.1.7</span> Estimating of <span class="math inline">\(\sigma^2\)</span><a href="reg.html#estimating-of-sigma2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To estimate the error variance component, one can either use the formula or use the <code>summary( )</code> output. Using the formula we get:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="reg.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Recall we defined the residuals in a previous section</span></span>
<span id="cb32-2"><a href="reg.html#cb32-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">25</span> <span class="co"># from glimpse</span></span>
<span id="cb32-3"><a href="reg.html#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="reg.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>( e<span class="sc">^</span><span class="dv">2</span> ) <span class="sc">/</span> ( n <span class="sc">-</span><span class="dv">2</span> )</span></code></pre></div>
<pre><code>## [1] 2383.716</code></pre>
<p>The summary output provides <span class="math inline">\(\sqrt{MSE}\)</span>, which is an estimate of <span class="math inline">\(\sigma\)</span>. Based on the output, <span class="math inline">\(\hat{\sigma}^2=48.82^2 = 2383.392\)</span></p>
</div>
</div>
<div id="inference-in-simple-linear-regression" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Inference in simple linear regression<a href="reg.html#inference-in-simple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, inference of the regression parameters using confidence intervals and hypothesis testing, inference about the mean response, prediction intervals for new observations, the ANOVA approach, and measures of association are addressed using <strong>R</strong>.</p>
<div id="inferences-for-beta_0-and-beta_1" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Inferences for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span><a href="reg.html#inferences-for-beta_0-and-beta_1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Toluca Company example from ALRM is used to illustrate inference on the slope and intercept of the model. Generally, inference is made about the slope of the model. A test and confidence interval concerning the intercept can be set up in the same manner as that of <span class="math inline">\(\beta_1\)</span>. To obtain the test statistic, along with p-values for test regarding those parameters, we summarize the <em>lm object</em> (the model fit) by using <code>summary( )</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="reg.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( toluca.fit)</span>
<span id="cb34-2"><a href="reg.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb34-3"><a href="reg.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb34-4"><a href="reg.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = yvar ~ xvar, data = toluca.data)</span></span>
<span id="cb34-5"><a href="reg.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb34-6"><a href="reg.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb34-7"><a href="reg.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb34-8"><a href="reg.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="do">## -83.876 -34.088  -5.982  38.826 103.528 </span></span>
<span id="cb34-9"><a href="reg.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb34-10"><a href="reg.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb34-11"><a href="reg.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="do">##             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb34-12"><a href="reg.html#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)   62.366     26.177   2.382   0.0259 *  </span></span>
<span id="cb34-13"><a href="reg.html#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="do">## xvar           3.570      0.347  10.290 4.45e-10 ***</span></span>
<span id="cb34-14"><a href="reg.html#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb34-15"><a href="reg.html#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb34-16"><a href="reg.html#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb34-17"><a href="reg.html#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 48.82 on 23 degrees of freedom</span></span>
<span id="cb34-18"><a href="reg.html#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.8215, Adjusted R-squared:  0.8138 </span></span>
<span id="cb34-19"><a href="reg.html#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic: 105.9 on 1 and 23 DF,  p-value: 4.449e-10</span></span></code></pre></div>
<p>Recall that the <code>summary( )</code> output provides the following:
<img src="ch3figures/summary.png" style="width:90.0%" /></p>
<p>Based on the output of <code>summary( toluca.fit )</code>, we obtain the estimates of <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_0\)</span> along with the test statistics <span class="math inline">\(b_1/s\{b_1\}\)</span> and <span class="math inline">\(b_0/s\{b_0\}\)</span> with the corresponding two-sided p-value for each.</p>
<p>Alternatively, we can also obtain the test statistic using the following commands:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="reg.html#cb35-1" aria-hidden="true" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> <span class="fu">sum</span>( e<span class="sc">^</span><span class="dv">2</span> )<span class="sc">/</span>( n<span class="dv">-2</span> )</span>
<span id="cb35-2"><a href="reg.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="reg.html#cb35-3" aria-hidden="true" tabindex="-1"></a>sd.b1 <span class="ot">&lt;-</span><span class="fu">sqrt</span>( MSE <span class="sc">/</span> ( <span class="fu">sum</span>( (myx <span class="sc">-</span><span class="fu">mean</span>( <span class="sc">~</span> myx ) )<span class="sc">^</span><span class="dv">2</span> ) ) )</span>
<span id="cb35-4"><a href="reg.html#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="reg.html#cb35-5" aria-hidden="true" tabindex="-1"></a>t.star<span class="ot">=</span> b<span class="fl">.1</span><span class="sc">/</span>sd.b1</span>
<span id="cb35-6"><a href="reg.html#cb35-6" aria-hidden="true" tabindex="-1"></a>t.star</span>
<span id="cb35-7"><a href="reg.html#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 10.28959</span></span>
<span id="cb35-8"><a href="reg.html#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="reg.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The test for the intercept is computed similarly</span></span></code></pre></div>
<p>Under <span class="math inline">\(H_0\)</span>, the distribution of the test statistic is <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(n-2\)</span> (Notation: <span class="math inline">\(t_{n-2}\)</span>). Recall that the p-value is the probability that the test statistic would take a value as extreme (or more extreme) as the observed test statistic in the the direction of the alternative if <span class="math inline">\(H_0\)</span> were true.</p>
<p>If <span class="math inline">\(H_a: \beta &gt;0\)</span>, the p-value = <span class="math inline">\(P( t_{n-2} &gt; 10.290 )\)</span>. To obtain this probability we use the function <code>xpt( q, df, lower.tail )</code>. The value <code>q</code> will the value of interest (10.290 in this example), <code>df</code> corresponds to the degrees of freedom (n-2), and <code>lower.tail</code> will either be set equal to <code>TRUE</code> (computes the area to the left of <code>q</code>) or <code>FALSE</code> (computes the area to the right of <code>q</code>). To compute <span class="math inline">\(P( t_{n-2} &gt; 10.290 )\)</span>, set <code>lower.tail=FALSE</code>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="reg.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xpt</span>( <span class="at">q=</span> <span class="fl">10.290</span>, <span class="at">df=</span> <span class="dv">25</span> <span class="sc">-</span> <span class="dv">2</span>, <span class="at">lower.tail =</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-19-1.png" width="528" /></p>
<pre><code>## [1] 2.222735e-10</code></pre>
<p>The desired probability will be printed in the console: <span class="math inline">\(P( t_{n-2} &gt; 10.290 ) \approx .0000000002\)</span>. This function will also produce a graph of the probability distribution with the area to the left of <code>q</code> shaded one color (area A) and the area to the right of <code>q</code> shaded another color (area B).</p>
<p>If instead <span class="math inline">\(H_a: \beta &lt;0\)</span>, then set <code>lower.tail=TRUE</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="reg.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xpt</span>( <span class="at">q=</span> <span class="fl">10.290</span>, <span class="at">df=</span> <span class="dv">25</span> <span class="sc">-</span> <span class="dv">2</span>, <span class="at">lower.tail =</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-20-1.png" width="528" /></p>
<pre><code>## [1] 1</code></pre>
<p>The output shows that <span class="math inline">\(P( t_{n-2} &lt; 10.290 ) \approx 1\)</span>. Lastly, if <span class="math inline">\(H_a: \beta \neq 0\)</span>, then we care about both possible extremes:
<span class="math display">\[P( t_{n-2} &lt; -10.290 ) + P( t_{n-2} &gt; 10.290 ) = 2 \times  P( t_{n-2} &gt; |10.290| )=.0000000004\]</span></p>
<p>For a confidence interval (CI) for <span class="math inline">\(\beta_1\)</span>, recall that the <span class="math inline">\(1-\alpha/2\)</span> confidence limits for <span class="math inline">\(\beta_1\)</span> are
<span class="math display">\[b_1 \pm t_{1-\alpha/2, n-2} s\{b_1\}\]</span>
To derive the CI, we can either use the <code>summary( )</code> output along with the critical values provided by <code>xqt( )</code>, or you can use <code>confint( )</code>. Let’s first derive the CI using <code>xqt( p, df, lower.tail )</code>. This function provides the quantile for a specified probability. For the Toluca Company example suppose a 95% confidence interval is to be computed. Then, <span class="math inline">\(t_{1-.05/2,25-2}=\)</span> <code>xqt( 1-.05/2, df= 25-2)</code>= 2.069.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="reg.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xqt</span>( <span class="dv">1</span><span class="fl">-.05</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">df=</span> <span class="dv">25-2</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-21-1.png" width="528" /></p>
<pre><code>## [1] 2.068658</code></pre>
<p>To obtain the CI, run the code below:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="reg.html#cb42-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">3.570</span> <span class="co"># from summary()</span></span>
<span id="cb42-2"><a href="reg.html#cb42-2" aria-hidden="true" tabindex="-1"></a>sb1 <span class="ot">&lt;-</span> <span class="fl">0.347</span> <span class="co"># from summary()</span></span>
<span id="cb42-3"><a href="reg.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="reg.html#cb42-4" aria-hidden="true" tabindex="-1"></a>b1 <span class="sc">-</span> <span class="fl">2.069</span><span class="sc">*</span>.<span class="dv">347</span></span>
<span id="cb42-5"><a href="reg.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2.852057</span></span>
<span id="cb42-6"><a href="reg.html#cb42-6" aria-hidden="true" tabindex="-1"></a>b1 <span class="sc">+</span> <span class="fl">2.069</span><span class="sc">*</span>.<span class="dv">347</span></span>
<span id="cb42-7"><a href="reg.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4.287943</span></span></code></pre></div>
<p>Since the model has been fitted, <code>confint( )</code> will provide the CIs for both parameters. This function has two arguments: an <em>lm object</em> and the desired confidence level:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="reg.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>( toluca.fit, <span class="at">level =</span> .<span class="dv">95</span>)</span>
<span id="cb43-2"><a href="reg.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                2.5 %     97.5 %</span></span>
<span id="cb43-3"><a href="reg.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) 8.213711 116.518006</span></span>
<span id="cb43-4"><a href="reg.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="do">## xvar        2.852435   4.287969</span></span></code></pre></div>
</div>
<div id="ci-for-the-mean-response-ey_h-and-a-prediction-interval-for-y_h" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> CI for the mean response (<span class="math inline">\(E(y_h)\)</span>) and a prediction interval for <span class="math inline">\(y_h\)</span><a href="reg.html#ci-for-the-mean-response-ey_h-and-a-prediction-interval-for-y_h" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Following the Toluca Company example from ALRM, we obtain a CI for the point estimate <span class="math inline">\(y_h\)</span> for <span class="math inline">\(x_h=100\)</span> units by using the function <code>predict( )</code>. However, the function has two additional arguments, <code>interval</code> and <code>level</code>. We set <code>interval=confidence</code> and level to the desired confidence level:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="reg.html#cb44-1" aria-hidden="true" tabindex="-1"></a>X.new<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xvar =</span> <span class="fu">c</span>( <span class="dv">100</span> ) )  <span class="co"># xvar refers to the name of the variable</span></span>
<span id="cb44-2"><a href="reg.html#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="reg.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict.lm</span>( toluca.fit , <span class="at">newdata=</span> X.new , <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>, <span class="at">level=</span> .<span class="dv">90</span> )</span></code></pre></div>
<pre><code>##        fit      lwr     upr
## 1 419.3861 394.9251 443.847</code></pre>
<p>The prediction of a new observation and its corresponding prediction interval (PI) can be obtained in the same manner as the confidence interval for the mean response but we set <code>interval= "prediciton"</code>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="reg.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Note: X.new was defined above</span></span>
<span id="cb46-2"><a href="reg.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict.lm</span>( toluca.fit , <span class="at">newdata=</span> X.new , <span class="at">interval=</span> <span class="st">&quot;prediction&quot;</span>, <span class="at">level=</span> .<span class="dv">90</span> )</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 419.3861 332.2072 506.5649</code></pre>
</div>
<div id="analysis-of-variance-approach-to-regression-analysis" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Analysis of Variance approach to regression analysis<a href="reg.html#analysis-of-variance-approach-to-regression-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To obtain the ANOVA table in <strong>R</strong>, we use the function <code>anova(</code> <em>lm object</em> <code>)</code>:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="reg.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(toluca.fit)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: yvar
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## xvar       1 252378  252378  105.88 4.449e-10 ***
## Residuals 23  54825    2384                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The following output is given by <code>anova(</code> <em>lm object</em> <code>)</code>:
<img src="ch3figures/anova.png" style="width:90.0%" /></p>
<p>The output from <code>anova( toluca.fit )</code> show that the p-value <span class="math inline">\(\approx\)</span> 0. We could also use the function <code>xpf( q , df1, df2, lower.tail )</code> to compute the p-value. The value <code>q</code> is the value of interest (105.88 in this example), <code>df1</code> corresponds to the numerator degree of freedom (1), <code>df2</code> corresponds to the denominator degree of freedom (25-2), and <code>lower.tail</code> would be set to <code>FALSE</code> since we want the p-value for this F-test:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="reg.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xpf</span>(<span class="at">q=</span> <span class="fl">105.88</span>, <span class="at">df1=</span> <span class="dv">1</span>, <span class="at">df2=</span> <span class="dv">25-2</span> , <span class="at">lower.tail=</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## [1] 4.44711e-10</code></pre>
<p>Note that the shaded “A” area in the graph always corresponds to the area to the left of the value of interest. Area “B” does not appear since it is too small (<span class="math inline">\(\approx 0\)</span>)</p>
</div>
<div id="measures-of-association" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Measures of association<a href="reg.html#measures-of-association" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The coefficient of determination (<span class="math inline">\(R^2\)</span>) and coefficient of correlation (r) can be obtained from the SSR and SSTO (from the ANOVA table), by applying the summation formulas, or obtained from the <code>summary(</code> <em>lm object</em> <code>)</code> output. The coefficient of or correlation is sign(<span class="math inline">\(b_1\)</span>)<span class="math inline">\((\sqrt{R^2})\)</span>. Using the summation formulas:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="reg.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">### extract the response and predictor</span></span>
<span id="cb52-2"><a href="reg.html#cb52-2" aria-hidden="true" tabindex="-1"></a>yresp <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>yvar</span>
<span id="cb52-3"><a href="reg.html#cb52-3" aria-hidden="true" tabindex="-1"></a>xpred <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>xvar</span>
<span id="cb52-4"><a href="reg.html#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="reg.html#cb52-5" aria-hidden="true" tabindex="-1"></a>b<span class="fl">.1</span> <span class="co"># recall the value of the slope est. </span></span></code></pre></div>
<pre><code>## [1] 3.570202</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="reg.html#cb54-1" aria-hidden="true" tabindex="-1"></a>SSR <span class="ot">=</span> b<span class="fl">.1</span><span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>( ( xpred <span class="sc">-</span> <span class="fu">mean</span>( xpred ) )<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb54-2"><a href="reg.html#cb54-2" aria-hidden="true" tabindex="-1"></a>SSTO <span class="ot">=</span> <span class="fu">sum</span>( ( yresp <span class="sc">-</span><span class="fu">mean</span>( yresp ) )<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb54-3"><a href="reg.html#cb54-3" aria-hidden="true" tabindex="-1"></a>R.sq <span class="ot">=</span> SSR<span class="sc">/</span>SSTO</span>
<span id="cb54-4"><a href="reg.html#cb54-4" aria-hidden="true" tabindex="-1"></a>R.sq</span></code></pre></div>
<pre><code>## [1] 0.8215335</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="reg.html#cb56-1" aria-hidden="true" tabindex="-1"></a>r<span class="ot">=</span>(<span class="dv">1</span>)<span class="sc">*</span><span class="fu">sqrt</span>(R.sq) <span class="co"># slope est. is positive</span></span></code></pre></div>
<p>Note that this matches the information provided in the output of summary discussed in a previous section.</p>
</div>
</div>
<div id="residual-analysis-and-remedial-measures" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Residual analysis and remedial measures<a href="reg.html#residual-analysis-and-remedial-measures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section deals with assessing the appropriateness of the simple regression model. Residual analysis are performed on Toluca Company example from ALRM.</p>
<p>If we assume that <span class="math inline">\(\varepsilon_i \overset{iid}{\sim} N(0,\sigma^2)\)</span> in the normal simple linear regression model, then the residuals <span class="math inline">\(e_i\)</span>’s should reflect this property. We examine the assumption using the following residual plots:</p>
<table>
<colgroup>
<col width="27%" />
<col width="3%" />
<col width="68%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><strong>Things to examine</strong></td>
<td align="left"></td>
<td align="left"><strong>Residual plots to examine</strong></td>
</tr>
<tr class="even">
<td align="left">Normality</td>
<td align="left"></td>
<td align="left">Normal QQ-plot of the residual</td>
</tr>
<tr class="odd">
<td align="left">Independence</td>
<td align="left"></td>
<td align="left">residuals vs x or <span class="math inline">\(\hat{y}\)</span></td>
</tr>
<tr class="even">
<td align="left">Constant variance</td>
<td align="left"></td>
<td align="left">residuals vs x or <span class="math inline">\(\hat{y}\)</span></td>
</tr>
<tr class="odd">
<td align="left">Linearity</td>
<td align="left"></td>
<td align="left">residuals vs x or <span class="math inline">\(\hat{y}\)</span></td>
</tr>
<tr class="even">
<td align="left">Outliers</td>
<td align="left"></td>
<td align="left">residuals vs x or <span class="math inline">\(\hat{y}\)</span>; QQ-plot of the residuals</td>
</tr>
</tbody>
</table>
<p>If we do not assume normality, the QQ-plot should still be examined for signs that the residuals show may be heavy-tailed distributed.</p>
<div id="creating-residual-plots" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Creating residual plots<a href="reg.html#creating-residual-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To create the plots to assess each of these assumptions, we use <code>xyplot( )</code> and <code>xqqmath( )</code>. The following code creates the required plots:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="reg.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">### extract the fitted values from the lm object</span></span>
<span id="cb57-2"><a href="reg.html#cb57-2" aria-hidden="true" tabindex="-1"></a>tolucafitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>( toluca.fit ) </span>
<span id="cb57-3"><a href="reg.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="reg.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="do">### extract the residuals from the lm object</span></span>
<span id="cb57-5"><a href="reg.html#cb57-5" aria-hidden="true" tabindex="-1"></a>tolresids <span class="ot">&lt;-</span>   <span class="fu">residuals</span>( toluca.fit )  </span>
<span id="cb57-6"><a href="reg.html#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="reg.html#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Note: There is no time variable</span></span>
<span id="cb57-8"><a href="reg.html#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="do">### Residuals vs x</span></span>
<span id="cb57-9"><a href="reg.html#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>( tolresids <span class="sc">~</span> xvar, <span class="at">data=</span>toluca.data, <span class="at">main=</span> <span class="st">&quot;Residuals vs x&quot;</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="reg.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Residuals vs fitted values</span></span>
<span id="cb58-2"><a href="reg.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>( tolresids <span class="sc">~</span> tolucafitted, <span class="at">data=</span>toluca.data, <span class="at">main=</span> <span class="st">&quot;Residuals vs fitted&quot;</span>)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-29-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="reg.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">### QQ-plot of the residuals.</span></span>
<span id="cb59-2"><a href="reg.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="do">### xqqmath follows the general formula</span></span>
<span id="cb59-3"><a href="reg.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="do">### with an additional argument: goal( ~ x, data, distribution= &quot;qnorm&quot;)</span></span>
<span id="cb59-4"><a href="reg.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="do">### There is no data argument since the residuals are</span></span>
<span id="cb59-5"><a href="reg.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="do">### already in R&#39;s memory since we created</span></span>
<span id="cb59-6"><a href="reg.html#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="do">### &#39;tolresids&#39;.</span></span>
<span id="cb59-7"><a href="reg.html#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">xqqmath</span>( <span class="sc">~</span> tolresids, <span class="at">distribution =</span> <span class="st">&quot;qnorm&quot;</span> )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-29-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>Although the above graphical summaries above are generally sufficient for diagnostics, one may examine other residual plots:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="reg.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="do">### boxplot of the residuals</span></span>
<span id="cb60-2"><a href="reg.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_boxplot</span>( <span class="sc">~</span> tolresids, <span class="at">main=</span><span class="st">&quot;Boxplot of residuals&quot;</span> ) </span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-30-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="reg.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">### histogram of the residuals</span></span>
<span id="cb61-2"><a href="reg.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>( <span class="sc">~</span> tolresids )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-30-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="residual-plots-from-the-tactile-package" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Residual plots from the tactile package<a href="reg.html#residual-plots-from-the-tactile-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The R package <code>tactile</code> expands the functionality of <code>xyplot()</code> so that it creates a set of residual plot by specifying only an <em>lm object</em>. Specifically, for a SLR model fit, it will provide the following residual plots:</p>
<ul>
<li><p><strong>Residuals vs. predicted values</strong>: This residual plot shows the relationship between the residuals and the predicted values. The plot helps to assess assumptions 1, 2, and 4. A plot that shows no clear pattern or trend, no outlying observations, and a spread that is fairly constant suggest that these assumptions are reasonable. If there is a pattern or structure in the residual plot, this suggests that there may be dependence between the observations. Similarly, if spread of residuals change as a function of predicted values, it suggests non-constant variance.</p></li>
<li><p><strong>Normal QQ-plot of the residuals</strong>: The plot helps to assess assumption 3. If the residuals are normally distributed, the points on the plot will roughly follow a straight line.</p></li>
<li><p><strong>Standardized residuals vs. predicted values</strong>. This residual plot is generally referred to as a scale-location plot. This plots the square root of the standardized residual versus the predicted values. Note that standardization has these transformed residuals to have a mean of zero and a standard deviation of one. This allows for comparisons between models with different explanatory variables or dependent variables on different scales. It is analyzed and interpreted in the same manner as the residuals vs. predicted values plot.</p></li>
<li><p><strong>Residuals vs. leverage plot</strong>. This plot shows the leverage (the degree to which an observation affects the estimated slope of the fitted regression line) against the standardized residuals. Although it helps identify potential influential outliers (such outliers have high leverage and correspond to a large residual), a plot that shows no clear pattern or trend and and a spread that is fairly constant suggest that will suggest assumptions 1 and 4 are reasonable. If the spread of standardized residuals changes as a function of leverage, it indicates non-constant variance. Similarly, a trend or pattern as a function of leverage would indicate a violation of assumption 1.</p></li>
</ul>
</div>
<div id="testing-departures-from-normality" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Testing departures from normality<a href="reg.html#testing-departures-from-normality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>R</strong> code is provided to carry out the Shapiro-Wilk and Lilliefors (Kolmogorov-Smirnov) test for normality. Both of these test may be used to detect if the residuals do not follow a normal distribution. The null hypothesis is that the residuals are normally distributed. The alternative is that they are not normally distributed. Thus, we are not testing if the residuals are normally distributed but rather if they depart from the normal distribution.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="reg.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Shapiro-Wilk Normality Test</span></span>
<span id="cb62-2"><a href="reg.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>( tolresids )</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  tolresids
## W = 0.9789, p-value = 0.8626</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="reg.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Lilliefors test of normality.</span></span>
<span id="cb64-2"><a href="reg.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="do">### First install the &#39;nortest&#39; R package</span></span>
<span id="cb64-3"><a href="reg.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( <span class="st">&quot;nortest&quot;</span> )</span>
<span id="cb64-4"><a href="reg.html#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lillie.test</span>( tolresids )</span></code></pre></div>
<pre><code>## 
##  Lilliefors (Kolmogorov-Smirnov) normality test
## 
## data:  tolresids
## D = 0.09572, p-value = 0.8027</code></pre>
<p>For both tests, the p-value is much larger than a reasonable <span class="math inline">\(\alpha\)</span> level.</p>
</div>
<div id="transformations" class="section level3 hasAnchor" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Transformations<a href="reg.html#transformations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A possible remedial measure when the simple linear regression model is not appropriate is to transform the response and/or predictor variable. To transform a variable, we use the <code>mutate( )</code> which comes from the <code>dplyr</code> package. The <code>dplyr</code> package is automatically installed when you install the <code>mosaic</code> package, and the <code>dplyr</code> package is automatically loaded when you load the <code>mosaic</code> package. The <code>mutate( )</code> function requires the name of the dataframe and the name of a new variable/object that will hold your transformed variable:</p>
<p><code>mutate(</code> ‘dataframe name’, ‘new variable’= ‘transformed variable’<code>)</code></p>
<p>To illustrate transformation, we use the data from Toluca Company example. Specifically, we want to apply a square root transformation to the response variable and a natural log transformation to the explanatory variable:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="reg.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Recall toluca.data</span></span>
<span id="cb66-2"><a href="reg.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( toluca.data )</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 2
## $ xvar &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 10…
## $ yvar &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389, …</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="reg.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Apply the square root trans. to the </span></span>
<span id="cb68-2"><a href="reg.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="do">### response. This function will add it to </span></span>
<span id="cb68-3"><a href="reg.html#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="do">### the dataframe</span></span>
<span id="cb68-4"><a href="reg.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>( toluca.data,  <span class="at">sqrty=</span> <span class="fu">sqrt</span>( yvar ) ) <span class="co"># the squared root variable will be called sqrty</span></span></code></pre></div>
<pre><code>##    xvar yvar    sqrty
## 1    80  399 19.97498
## 2    30  121 11.00000
## 3    50  221 14.86607
## 4    90  376 19.39072
## 5    70  361 19.00000
## 6    60  224 14.96663
## 7   120  546 23.36664
## 8    80  352 18.76166
## 9   100  353 18.78829
## 10   50  157 12.52996
## 11   40  160 12.64911
## 12   70  252 15.87451
## 13   90  389 19.72308
## 14   20  113 10.63015
## 15  110  435 20.85665
## 16  100  420 20.49390
## 17   30  212 14.56022
## 18   50  268 16.37071
## 19   90  377 19.41649
## 20  110  421 20.51828
## 21   30  273 16.52271
## 22   90  468 21.63331
## 23   40  244 15.62050
## 24   80  342 18.49324
## 25   70  323 17.97220</code></pre>
<p>We want to be able to use the transformed variable, so we store the resulting new dataframe to a new object:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="reg.html#cb70-1" aria-hidden="true" tabindex="-1"></a>toluca.dataVer1 <span class="ot">&lt;-</span> <span class="fu">mutate</span>( toluca.data,  <span class="at">sqrty=</span> <span class="fu">sqrt</span>( yvar ) )  </span>
<span id="cb70-2"><a href="reg.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( toluca.dataVer1 )</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 3
## $ xvar  &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 1…
## $ yvar  &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389,…
## $ sqrty &lt;dbl&gt; 19.97498, 11.00000, 14.86607, 19.39072, 19.00000, 14.96663, 23.3…</code></pre>
<p>Now apply the natural log transformation to the explanatory variable:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="reg.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Apply natural log trans. to x.</span></span>
<span id="cb72-2"><a href="reg.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Note that we are using toluca.dataVer1</span></span>
<span id="cb72-3"><a href="reg.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="do">### dataframe since it already includes &#39;sqrty&#39;.</span></span>
<span id="cb72-4"><a href="reg.html#cb72-4" aria-hidden="true" tabindex="-1"></a>toluca.dataVer2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>( toluca.dataVer1,  <span class="at">lnx =</span> <span class="fu">log</span>( xvar ) )  </span>
<span id="cb72-5"><a href="reg.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( toluca.dataVer2 )</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 4
## $ xvar  &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 1…
## $ yvar  &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389,…
## $ sqrty &lt;dbl&gt; 19.97498, 11.00000, 14.86607, 19.39072, 19.00000, 14.96663, 23.3…
## $ lnx   &lt;dbl&gt; 4.382027, 3.401197, 3.912023, 4.499810, 4.248495, 4.094345, 4.78…</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="reg.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="do">### One could also apply as many trans. as one would</span></span>
<span id="cb74-2"><a href="reg.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="do">### like by using mutate only once:</span></span>
<span id="cb74-3"><a href="reg.html#cb74-3" aria-hidden="true" tabindex="-1"></a>toluca.dataWithTrans <span class="ot">&lt;-</span> <span class="fu">mutate</span>( toluca.data,  <span class="at">sqrty=</span> <span class="fu">sqrt</span>( yvar ), <span class="at">lnx =</span> <span class="fu">log</span>( xvar ),</span>
<span id="cb74-4"><a href="reg.html#cb74-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lny =</span> <span class="fu">log</span>( yvar ) , <span class="at">sqrd =</span> yvar<span class="sc">^</span><span class="dv">2</span>, <span class="at">cubertx =</span> xvar<span class="sc">^</span>( <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> ) )  </span>
<span id="cb74-5"><a href="reg.html#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( toluca.dataWithTrans )</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 7
## $ xvar    &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110,…
## $ yvar    &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 38…
## $ sqrty   &lt;dbl&gt; 19.97498, 11.00000, 14.86607, 19.39072, 19.00000, 14.96663, 23…
## $ lnx     &lt;dbl&gt; 4.382027, 3.401197, 3.912023, 4.499810, 4.248495, 4.094345, 4.…
## $ lny     &lt;dbl&gt; 5.988961, 4.795791, 5.398163, 5.929589, 5.888878, 5.411646, 6.…
## $ sqrd    &lt;dbl&gt; 159201, 14641, 48841, 141376, 130321, 50176, 298116, 123904, 1…
## $ cubertx &lt;dbl&gt; 4.308869, 3.107233, 3.684031, 4.481405, 4.121285, 3.914868, 4.…</code></pre>
<p>Once the transformed variables are stored in a dataframe, you can plot them or fit the simple linear regression model:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="reg.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the dataframe name</span></span>
<span id="cb76-2"><a href="reg.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(sqrty <span class="sc">~</span> xvar,  <span class="at">data=</span> toluca.dataWithTrans, <span class="at">main=</span><span class="st">&quot;Square root of y vs x&quot;</span> )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-35-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="reg.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(sqrty <span class="sc">~</span> lnx,  <span class="at">data=</span> toluca.dataWithTrans, <span class="at">main=</span><span class="st">&quot;Square root of y vs ln(x)&quot;</span> )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-35-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="reg.html#cb78-1" aria-hidden="true" tabindex="-1"></a>toluca.fitA <span class="ot">&lt;-</span> <span class="fu">lm</span>( sqrty <span class="sc">~</span> xvar , <span class="at">data=</span> toluca.dataWithTrans )</span>
<span id="cb78-2"><a href="reg.html#cb78-2" aria-hidden="true" tabindex="-1"></a>toluca.fitA</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sqrty ~ xvar, data = toluca.dataWithTrans)
## 
## Coefficients:
## (Intercept)         xvar  
##      9.9722       0.1055</code></pre>
</div>
<div id="f-test-for-lack-of-fit" class="section level3 hasAnchor" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> F Test for Lack of Fit<a href="reg.html#f-test-for-lack-of-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Th lack of fit test requires repeated observations at one or more <span class="math inline">\(x\)</span> levels. To proceed, one may compute the MSLF and MSPE using the summation formulas using <strong>R</strong>. An easier approach is determine the full and reduced model when testing for a lack of fit. Recall that in this setting we have the following models:</p>
<p></br></p>
<p>Full Model: <span class="math inline">\(Y_{ij}=\mu_j + \varepsilon_{ij}\)</span></p>
<p>Reduced Model: <span class="math inline">\(Y_{ij}= \beta_0 + \beta_1 X_j +\varepsilon_{ij}\)</span></p>
<p></br></p>
<p>If the full and reduced model can be determined (and are nested), then one may use the general F-test to test whether we can reject the null hypothesis (which postulates the reduced model). In <strong>R</strong>, the general F-test can be carried out using <code>anova(</code> <em>reduced model</em> , <em>full model</em> , <code>test= "F" )</code> . Note that in this case, the reduced model is a single-factor (potentially) unbalanced AOV model. We follow the Bank Example from ALRM to illustrate this in <strong>R</strong>:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="reg.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Import data:</span></span>
<span id="cb80-2"><a href="reg.html#cb80-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%203%20Data%20Sets/CH03TA04.txt&quot;</span></span>
<span id="cb80-3"><a href="reg.html#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="reg.html#cb80-4" aria-hidden="true" tabindex="-1"></a>bank.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( url , <span class="at">header =</span> <span class="cn">FALSE</span> , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>) , <span class="at">sep =</span> <span class="st">&quot;&quot;</span> )</span>
<span id="cb80-5"><a href="reg.html#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="reg.html#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( bank.data )</span></code></pre></div>
<pre><code>## Rows: 11
## Columns: 2
## $ x &lt;int&gt; 125, 100, 200, 75, 150, 175, 75, 175, 125, 200, 100
## $ y &lt;int&gt; 160, 112, 124, 28, 152, 156, 42, 124, 150, 104, 136</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="reg.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Fit full model, but first convert</span></span>
<span id="cb82-2"><a href="reg.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="do">### the explanatory into a factor variable.</span></span>
<span id="cb82-3"><a href="reg.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="do">### &#39;as.factor&quot; converts a variable into a factor variable.</span></span>
<span id="cb82-4"><a href="reg.html#cb82-4" aria-hidden="true" tabindex="-1"></a>bank.dataUD <span class="ot">&lt;-</span> <span class="fu">mutate</span>( bank.data, <span class="at">xfac =</span> <span class="fu">as.factor</span>( x ) )</span>
<span id="cb82-5"><a href="reg.html#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="reg.html#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;levels&#39; counts how many levels are present in a</span></span>
<span id="cb82-7"><a href="reg.html#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># factor variable.</span></span>
<span id="cb82-8"><a href="reg.html#cb82-8" aria-hidden="true" tabindex="-1"></a>levels.x <span class="ot">&lt;-</span> <span class="fu">levels</span>( bank.dataUD<span class="sc">$</span>xfac )  <span class="co"># determine the levels of X</span></span>
<span id="cb82-9"><a href="reg.html#cb82-9" aria-hidden="true" tabindex="-1"></a>levels.x</span></code></pre></div>
<pre><code>## [1] &quot;75&quot;  &quot;100&quot; &quot;125&quot; &quot;150&quot; &quot;175&quot; &quot;200&quot;</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="reg.html#cb84-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">11</span> <span class="co"># from glimpse( )   </span></span>
<span id="cb84-2"><a href="reg.html#cb84-2" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">6</span>  <span class="co"># how many levels</span></span>
<span id="cb84-3"><a href="reg.html#cb84-3" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="reg.html#cb86-1" aria-hidden="true" tabindex="-1"></a>n <span class="sc">-</span> c</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="reg.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Full model:</span></span>
<span id="cb88-2"><a href="reg.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="do">### (Note: for those that have taken 4220: this is a one-way unbalanced aov problem)</span></span>
<span id="cb88-3"><a href="reg.html#cb88-3" aria-hidden="true" tabindex="-1"></a>fit.bank.full <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span> xfac , <span class="at">data=</span> bank.dataUD)</span>
<span id="cb88-4"><a href="reg.html#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="reg.html#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Reduced model:</span></span>
<span id="cb88-6"><a href="reg.html#cb88-6" aria-hidden="true" tabindex="-1"></a>fit.bank.reduced <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span> x , <span class="at">data=</span> bank.dataUD)</span>
<span id="cb88-7"><a href="reg.html#cb88-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb88-8"><a href="reg.html#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="reg.html#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="do">### anova(reduced model, full model, test=&quot;F&quot;)</span></span>
<span id="cb88-10"><a href="reg.html#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>( fit.bank.reduced , fit.bank.full , <span class="at">test=</span> <span class="st">&quot;F&quot;</span> )</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: y ~ x
## Model 2: y ~ xfac
##   Res.Df   RSS Df Sum of Sq      F   Pr(&gt;F)   
## 1      9 14742                                
## 2      5  1148  4     13594 14.801 0.005594 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>What information is given by <code>anova( fit.bank.reduced , fit.bank.full , test="F")</code>? We obtain
<img src="ch3figures/lof.png" style="width:95.0%" /></p>
<!--

row1 <- c("Things to examine", "  ", "Residual plots to examine")
row2 <- c("Normality ", "  ", "Normal QQ-plot of the residual")
row3 <- c("Independence ", "  ", "residuals vs x or y or time")
row4 <- c("Constant variance ", "  ", "residuals vs x or y or time")
row5 <- c("Outliers ", "  ", "residuals vs x or y; QQ-plot of the residuals")

tmpa <- rbind(row1, row2, row3, row4, row5 )
rownames(tmpa) <- NULL
knitr::kable(tmpa, "pipe")


-->
</div>
</div>
<div id="least-absolute-deviation-lad-regression" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Least absolute deviation (LAD) regression<a href="reg.html#least-absolute-deviation-lad-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The method of least squares minimizes the distances between the observed data
points and the corresponding points on the fitted regression line. Least squares estimates for linear regression assume all model assumptions are valid. When some of these assumptions are invalid, least squares regression can perform poorly for inference. Robust or resistant regression methods provide an alternative to least squares estimation by attempting to dampen the influence of outliers in order to provide a better fit of the model to the data. On such method is LAD regression</p>
<p>Residual diagnostics can help guide you to where the breakdown in assumptions occur, but can be time consuming and sometimes difficult to the untrained eye. Robust regression methods provide an alternative to least squares regression by requiring less restrictive assumptions. These methods attempt to dampen the influence of outlying cases in order to provide a better fit to the majority of the data.</p>
</div>
<div id="the-matrix-approach-to-simple-linear-regression" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> The matrix approach to simple linear regression<a href="reg.html#the-matrix-approach-to-simple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="creating-a-matrix" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Creating a matrix<a href="reg.html#creating-a-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall that the function <code>c( )</code> creates a vector. For example,</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="reg.html#cb90-1" aria-hidden="true" tabindex="-1"></a>xvec <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span> )</span></code></pre></div>
<p>We can select a given element from this vector by placing <code>[ ]</code> after the vector name with a specified index:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="reg.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="do">### 1st element in the vector</span></span>
<span id="cb91-2"><a href="reg.html#cb91-2" aria-hidden="true" tabindex="-1"></a>xvec[<span class="dv">1</span>] </span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="reg.html#cb93-1" aria-hidden="true" tabindex="-1"></a>xvec[<span class="dv">3</span>]  <span class="co"># 3rd element in the vector</span></span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>A matrix is a rectangular way of storing data. You can think of it as simply a way to store data. Matrices will have two dimensions: rows and columns. That is, each matrix will consist of rows and columns of elements (or data).</p>
<p>The function <code>matrix( )</code> allows a user to create a matrix from a vector of data. The function has four arguments: <code>data</code> (a vector of data), <code>nrow</code> (desired number of rows), <code>ncol</code> (desired number of columns), and <code>byrow</code> (set equal to <code>FALSE</code> if the matrix is to be filled by column, set to <code>TRUE</code> if to be filled by row). The code below create a vector of data to be transformed into a matrix:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="reg.html#cb95-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb95-2"><a href="reg.html#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="reg.html#cb95-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="at">data=</span> a, <span class="at">nrow=</span> <span class="dv">2</span>, <span class="at">ncol=</span> <span class="dv">3</span>, <span class="at">byrow=</span> <span class="cn">FALSE</span> )</span>
<span id="cb95-4"><a href="reg.html#cb95-4" aria-hidden="true" tabindex="-1"></a>A</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="reg.html#cb97-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="at">data=</span> a, <span class="at">nrow=</span> <span class="dv">2</span>, <span class="at">ncol=</span> <span class="dv">3</span>, <span class="at">byrow=</span> <span class="cn">TRUE</span> )</span>
<span id="cb97-2"><a href="reg.html#cb97-2" aria-hidden="true" tabindex="-1"></a>B</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6</code></pre>
</div>
<div id="some-matrix-operations" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Some matrix operations<a href="reg.html#some-matrix-operations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It may be necessary to perform certain matrix operations. In this section you will learn how to perform matrix multiplication, transpose a matrix, obtain the inverse of a matrix, and element by element multiplication. The commands that we will use are:</p>
<table>
<tbody>
<tr class="odd">
<td align="left"><strong>Name</strong></td>
<td align="left"></td>
<td align="left"><strong>What does it do?</strong></td>
</tr>
<tr class="even">
<td align="left">%*%</td>
<td align="left"></td>
<td align="left">Performs matrix multiplication</td>
</tr>
<tr class="odd">
<td align="left">t( )</td>
<td align="left"></td>
<td align="left">Transposes a matrix.</td>
</tr>
<tr class="even">
<td align="left">solve( )</td>
<td align="left"></td>
<td align="left">Obtains an Inverse of a matrix</td>
</tr>
<tr class="odd">
<td align="left">*</td>
<td align="left"></td>
<td align="left">Performs element by element multiplication.</td>
</tr>
</tbody>
</table>
<p>The commands are illustrated with the following code:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="reg.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Create two matrices</span></span>
<span id="cb99-2"><a href="reg.html#cb99-2" aria-hidden="true" tabindex="-1"></a>C<span class="ot">=</span> <span class="fu">matrix</span>( <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">8</span>, <span class="dv">26</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">10</span> ) , <span class="at">nrow=</span> <span class="dv">3</span>, <span class="at">ncol=</span> <span class="dv">3</span> )</span>
<span id="cb99-3"><a href="reg.html#cb99-3" aria-hidden="true" tabindex="-1"></a>D<span class="ot">=</span> <span class="fu">matrix</span>( <span class="fu">c</span>( <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span> ), <span class="at">nrow=</span> <span class="dv">3</span>, <span class="at">ncol=</span> <span class="dv">3</span> )</span>
<span id="cb99-4"><a href="reg.html#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="reg.html#cb99-5" aria-hidden="true" tabindex="-1"></a>C</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1   -8    5
## [2,]    2   26    6
## [3,]    1    4   10</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="reg.html#cb101-1" aria-hidden="true" tabindex="-1"></a>D</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    7   10   13
## [2,]    8   11   14
## [3,]    9   12   15</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="reg.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Matrix multiplication</span></span>
<span id="cb103-2"><a href="reg.html#cb103-2" aria-hidden="true" tabindex="-1"></a>C<span class="sc">%*%</span>D    <span class="co"># multiply matrices A and B</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]  -12  -18  -24
## [2,]  276  378  480
## [3,]  129  174  219</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="reg.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Matrix transpose</span></span>
<span id="cb105-2"><a href="reg.html#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(C)     <span class="co"># transpose of matrix A</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    1
## [2,]   -8   26    4
## [3,]    5    6   10</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="reg.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="do">### element by element multiplication</span></span>
<span id="cb107-2"><a href="reg.html#cb107-2" aria-hidden="true" tabindex="-1"></a>C<span class="sc">*</span>D <span class="co"># this is NOT matrix multiplication    </span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    7  -80   65
## [2,]   16  286   84
## [3,]    9   48  150</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="reg.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="do">### obtain the inverse of A</span></span>
<span id="cb109-2"><a href="reg.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>(C) </span></code></pre></div>
<pre><code>##             [,1]        [,2]        [,3]
## [1,]  0.91472868  0.38759690 -0.68992248
## [2,] -0.05426357  0.01937984  0.01550388
## [3,] -0.06976744 -0.04651163  0.16279070</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="reg.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Add two matrices</span></span>
<span id="cb111-2"><a href="reg.html#cb111-2" aria-hidden="true" tabindex="-1"></a>C <span class="sc">+</span> D</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    8    2   18
## [2,]   10   37   20
## [3,]   10   16   25</code></pre>
</div>
<div id="ls-estimation" class="section level3 hasAnchor" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> LS estimation<a href="reg.html#ls-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The simple linear regression model in matrix form is</p>
<p><span class="math display">\[
\boldsymbol{Y}_{n\times1} = \boldsymbol{X}_{n\times 2} \boldsymbol{\beta}_{2\times1} + \boldsymbol{\varepsilon}_{n\times1}
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\boldsymbol{Y}_{n\times 1}= \begin{bmatrix}
y_{1} \\
y_{2} \\
\vdots \\
y_{n} \\
\end{bmatrix},   \qquad
\boldsymbol{X}_{n\times 2}= \begin{bmatrix}
1 &amp; x_{1} \\
1 &amp; x_{2} \\
\vdots \\
1 &amp; x_{n} \\
\end{bmatrix}, \qquad
\boldsymbol{\beta}_{2\times 1}= \begin{bmatrix}
\beta_{0} \\
\beta_{1} \\
\end{bmatrix},   \quad and \quad
\boldsymbol{\varepsilon}_{n\times 1}= \begin{bmatrix}
\varepsilon_{1} \\
\varepsilon_{2} \\
\vdots \\
\varepsilon_n\\
\end{bmatrix}
\]</span></p>
<p>The matrix approach is illustrated in <strong>R</strong> using the Toluca Company example:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="reg.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Recall the data</span></span>
<span id="cb113-2"><a href="reg.html#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( toluca.data )</span></code></pre></div>
<pre><code>## Rows: 25
## Columns: 2
## $ xvar &lt;int&gt; 80, 30, 50, 90, 70, 60, 120, 80, 100, 50, 40, 70, 90, 20, 110, 10…
## $ yvar &lt;int&gt; 399, 121, 221, 376, 361, 224, 546, 352, 353, 157, 160, 252, 389, …</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="reg.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Extract both variables to set up the matrices</span></span>
<span id="cb115-2"><a href="reg.html#cb115-2" aria-hidden="true" tabindex="-1"></a>hrs <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>yvar</span>
<span id="cb115-3"><a href="reg.html#cb115-3" aria-hidden="true" tabindex="-1"></a>lotsize <span class="ot">&lt;-</span> toluca.data<span class="sc">$</span>xvar</span>
<span id="cb115-4"><a href="reg.html#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="reg.html#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Set up the response column vector</span></span>
<span id="cb115-6"><a href="reg.html#cb115-6" aria-hidden="true" tabindex="-1"></a>yvec <span class="ot">&lt;-</span> <span class="fu">matrix</span>( hrs, <span class="at">nrow=</span> <span class="dv">25</span>, <span class="at">ncol=</span> <span class="dv">1</span>)</span>
<span id="cb115-7"><a href="reg.html#cb115-7" aria-hidden="true" tabindex="-1"></a>yvec</span></code></pre></div>
<pre><code>##       [,1]
##  [1,]  399
##  [2,]  121
##  [3,]  221
##  [4,]  376
##  [5,]  361
##  [6,]  224
##  [7,]  546
##  [8,]  352
##  [9,]  353
## [10,]  157
## [11,]  160
## [12,]  252
## [13,]  389
## [14,]  113
## [15,]  435
## [16,]  420
## [17,]  212
## [18,]  268
## [19,]  377
## [20,]  421
## [21,]  273
## [22,]  468
## [23,]  244
## [24,]  342
## [25,]  323</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="reg.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Define the design/model matrix.</span></span>
<span id="cb117-2"><a href="reg.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First we need to define a vectors of 1&#39;s:</span></span>
<span id="cb117-3"><a href="reg.html#cb117-3" aria-hidden="true" tabindex="-1"></a>ones <span class="ot">&lt;-</span> <span class="fu">rep</span>( <span class="dv">1</span>, <span class="at">times=</span> <span class="dv">25</span>) </span>
<span id="cb117-4"><a href="reg.html#cb117-4" aria-hidden="true" tabindex="-1"></a>ones</span></code></pre></div>
<pre><code>##  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="reg.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you have the columns of the matrix</span></span>
<span id="cb119-2"><a href="reg.html#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="co"># already defined, then we can create the </span></span>
<span id="cb119-3"><a href="reg.html#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="co"># matrix by binding the columns using &#39;cbind()&#39;.</span></span>
<span id="cb119-4"><a href="reg.html#cb119-4" aria-hidden="true" tabindex="-1"></a>Xmat <span class="ot">&lt;-</span> <span class="fu">cbind</span>( ones , lotsize )</span>
<span id="cb119-5"><a href="reg.html#cb119-5" aria-hidden="true" tabindex="-1"></a>Xmat</span></code></pre></div>
<pre><code>##       ones lotsize
##  [1,]    1      80
##  [2,]    1      30
##  [3,]    1      50
##  [4,]    1      90
##  [5,]    1      70
##  [6,]    1      60
##  [7,]    1     120
##  [8,]    1      80
##  [9,]    1     100
## [10,]    1      50
## [11,]    1      40
## [12,]    1      70
## [13,]    1      90
## [14,]    1      20
## [15,]    1     110
## [16,]    1     100
## [17,]    1      30
## [18,]    1      50
## [19,]    1      90
## [20,]    1     110
## [21,]    1      30
## [22,]    1      90
## [23,]    1      40
## [24,]    1      80
## [25,]    1      70</code></pre>
<p>The LS estimates may be obtained via <span class="math inline">\(\boldsymbol{b}= ( \boldsymbol{X}^T\boldsymbol{X})^{-1}\boldsymbol{X}^{T} \boldsymbol{y}\)</span>. In <strong>R</strong> we have:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="reg.html#cb121-1" aria-hidden="true" tabindex="-1"></a>XmatTxmat <span class="ot">&lt;-</span> <span class="fu">t</span>(Xmat) <span class="sc">%*%</span> Xmat</span>
<span id="cb121-2"><a href="reg.html#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="reg.html#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>( XmatTxmat ) <span class="sc">%*%</span> <span class="fu">t</span>(Xmat) <span class="sc">%*%</span> yvec</span></code></pre></div>
<pre><code>##              [,1]
## ones    62.365859
## lotsize  3.570202</code></pre>
<p>These are the same estimates provided by <code>summary( )</code>.</p>
<p>The fitted values, <span class="math inline">\(\boldsymbol{\hat{y}} = \boldsymbol{X} \boldsymbol{b}\)</span>, are obtained via:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="reg.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Store the LS estimates</span></span>
<span id="cb123-2"><a href="reg.html#cb123-2" aria-hidden="true" tabindex="-1"></a>best <span class="ot">&lt;-</span> <span class="fu">solve</span>( XmatTxmat ) <span class="sc">%*%</span> <span class="fu">t</span>(Xmat) <span class="sc">%*%</span> yvec</span>
<span id="cb123-3"><a href="reg.html#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="reg.html#cb123-4" aria-hidden="true" tabindex="-1"></a>Xmat <span class="sc">%*%</span> best <span class="co"># compare to fitted(toluca.fit)</span></span></code></pre></div>
<pre><code>##           [,1]
##  [1,] 347.9820
##  [2,] 169.4719
##  [3,] 240.8760
##  [4,] 383.6840
##  [5,] 312.2800
##  [6,] 276.5780
##  [7,] 490.7901
##  [8,] 347.9820
##  [9,] 419.3861
## [10,] 240.8760
## [11,] 205.1739
## [12,] 312.2800
## [13,] 383.6840
## [14,] 133.7699
## [15,] 455.0881
## [16,] 419.3861
## [17,] 169.4719
## [18,] 240.8760
## [19,] 383.6840
## [20,] 455.0881
## [21,] 169.4719
## [22,] 383.6840
## [23,] 205.1739
## [24,] 347.9820
## [25,] 312.2800</code></pre>
<p>These values may also be obtained by using the hat matrix:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="reg.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Hat matrix</span></span>
<span id="cb125-2"><a href="reg.html#cb125-2" aria-hidden="true" tabindex="-1"></a>Hatmat <span class="ot">&lt;-</span> Xmat <span class="sc">%*%</span> <span class="fu">solve</span>( XmatTxmat ) <span class="sc">%*%</span> <span class="fu">t</span>(Xmat)</span>
<span id="cb125-3"><a href="reg.html#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="reg.html#cb125-4" aria-hidden="true" tabindex="-1"></a>Hatmat <span class="sc">%*%</span> yvec <span class="co"># same as above</span></span></code></pre></div>
<pre><code>##           [,1]
##  [1,] 347.9820
##  [2,] 169.4719
##  [3,] 240.8760
##  [4,] 383.6840
##  [5,] 312.2800
##  [6,] 276.5780
##  [7,] 490.7901
##  [8,] 347.9820
##  [9,] 419.3861
## [10,] 240.8760
## [11,] 205.1739
## [12,] 312.2800
## [13,] 383.6840
## [14,] 133.7699
## [15,] 455.0881
## [16,] 419.3861
## [17,] 169.4719
## [18,] 240.8760
## [19,] 383.6840
## [20,] 455.0881
## [21,] 169.4719
## [22,] 383.6840
## [23,] 205.1739
## [24,] 347.9820
## [25,] 312.2800</code></pre>
</div>
</div>
<div id="multiple-linear-regression-mlr" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Multiple linear regression (MLR)<a href="reg.html#multiple-linear-regression-mlr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section deals with the multiple regression model
<span class="math display">\[ Y_i=\beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots +
\beta_p x_{i,p-1} + \varepsilon_i\]</span>
where the <span class="math inline">\(\beta\)</span>’s are the parameters, <span class="math inline">\(x\)</span>’s are known constants, and we assume that <span class="math inline">\(\varepsilon_i \overset{iid}{\sim} N(0, \sigma^2)\)</span>. To illustrate the model fitting with <strong>R</strong> we follow the Dwaine Studios Example from ALRM. Note that the model can be expressed in matrix form and any subsequent analyses can be done in terms of matrices. Matrices will be used to obtain the least square estimates as an illustration of using matrices <strong>R</strong>, but the rest of the analyses will be done using <code>lm( )</code> and <code>anova( )</code>.</p>
<div id="least-squares-estimates" class="section level3 hasAnchor" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Least-Squares Estimates<a href="reg.html#least-squares-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Begin by importing the data:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="reg.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Import data:</span></span>
<span id="cb127-2"><a href="reg.html#cb127-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%206%20Data%20Sets/CH06FI05.txt&quot;</span></span>
<span id="cb127-3"><a href="reg.html#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="reg.html#cb127-4" aria-hidden="true" tabindex="-1"></a>dwaine.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( url , <span class="at">header =</span> <span class="cn">FALSE</span> , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>,  <span class="st">&quot;y&quot;</span>) , <span class="at">sep =</span> <span class="st">&quot;&quot;</span> )</span>
<span id="cb127-5"><a href="reg.html#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( dwaine.data )</span></code></pre></div>
<pre><code>## Rows: 21
## Columns: 3
## $ x1 &lt;dbl&gt; 68.5, 45.2, 91.3, 47.8, 46.9, 66.1, 49.5, 52.0, 48.9, 38.4, 87.9, 7…
## $ x2 &lt;dbl&gt; 16.7, 16.8, 18.2, 16.3, 17.3, 18.2, 15.9, 17.2, 16.6, 16.0, 18.3, 1…
## $ y  &lt;dbl&gt; 174.4, 164.4, 244.2, 154.6, 181.6, 207.5, 152.8, 163.2, 145.4, 137.…</code></pre>
<p>A matrix approach can be used as follows:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="reg.html#cb129-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">21</span></span>
<span id="cb129-2"><a href="reg.html#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="reg.html#cb129-3" aria-hidden="true" tabindex="-1"></a>yresp <span class="ot">&lt;-</span> dwaine.data<span class="sc">$</span>y</span>
<span id="cb129-4"><a href="reg.html#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="reg.html#cb129-5" aria-hidden="true" tabindex="-1"></a>Xmat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), dwaine.data<span class="sc">$</span>x1, dwaine.data<span class="sc">$</span>x2) <span class="co"># design/model matrix</span></span>
<span id="cb129-6"><a href="reg.html#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="reg.html#cb129-7" aria-hidden="true" tabindex="-1"></a>yrespvec <span class="ot">&lt;-</span> <span class="fu">matrix</span>( yresp, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow=</span><span class="dv">21</span>)</span>
<span id="cb129-8"><a href="reg.html#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="reg.html#cb129-9" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">solve</span>( <span class="fu">t</span>( Xmat )<span class="sc">%*%</span>( Xmat ) )<span class="sc">%*%</span><span class="fu">t</span>( Xmat )<span class="sc">%*%</span>yrespvec</span>
<span id="cb129-10"><a href="reg.html#cb129-10" aria-hidden="true" tabindex="-1"></a>b</span></code></pre></div>
<pre><code>##           [,1]
## [1,] -68.85707
## [2,]   1.45456
## [3,]   9.36550</code></pre>
<p>We can also <code>lm( )</code> to fit a MLR model. It is used in the same manner as before but we add additional explanatory variables by adding a <code>+</code> after each explanatory variable:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="reg.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="do">###  Note the argument of lm():</span></span>
<span id="cb131-2"><a href="reg.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Response variable ∼ Explanatory variable +  Explanatory variable + ...</span></span>
<span id="cb131-3"><a href="reg.html#cb131-3" aria-hidden="true" tabindex="-1"></a>dwaine.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>( y <span class="sc">~</span> x1 <span class="sc">+</span> x2 , <span class="at">data=</span> dwaine.data)</span>
<span id="cb131-4"><a href="reg.html#cb131-4" aria-hidden="true" tabindex="-1"></a>dwaine.fit </span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2, data = dwaine.data)
## 
## Coefficients:
## (Intercept)           x1           x2  
##     -68.857        1.455        9.366</code></pre>
</div>
<div id="fitted-values-anova-table-residuals" class="section level3 hasAnchor" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> Fitted values, ANOVA table, residuals<a href="reg.html#fitted-values-anova-table-residuals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>All previously discussed functions that extract information from an <em>lm obejct</em> such as the LS estimates, fitted values, ANOVA table, etc. can be use in the same manner when fitting a MLR model. Recall that <code>coef( )</code> returns the LS estimates:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="reg.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(dwaine.fit)</span></code></pre></div>
<pre><code>## (Intercept)          x1          x2 
##   -68.85707     1.45456     9.36550</code></pre>
<p>The fitted values and residuals can be obtained via:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="reg.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(dwaine.fit)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 187.1841 154.2294 234.3963 153.3285 161.3849 197.7414 152.0551 167.8666 
##        9       10       11       12       13       14       15       16 
## 157.7382 136.8460 230.3874 197.1849 222.6857 141.5184 174.2132 228.1239 
##       17       18       19       20       21 
## 145.7470 159.0013 230.9870 230.3161 157.0644</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="reg.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>( dwaine.fit )</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
## -12.7841146  10.1705737   9.8036764   1.2714690  20.2150722   9.7585779 
##           7           8           9          10          11          12 
##   0.7449178  -4.6666316 -12.3381967   0.3539791  11.5126289  -6.0849209 
##          13          14          15          16          17          18 
##   9.3142995   3.7815611 -13.1132116 -18.4238900   0.6530062 -15.0013134 
##          19          20          21 
##   1.6129777  -6.2160615   9.4356009</code></pre>
<p>To obtain the ANOVA table, run the following:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="reg.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>( dwaine.fit )</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: y
##           Df  Sum Sq Mean Sq  F value   Pr(&gt;F)    
## x1         1 23371.8 23371.8 192.8962 4.64e-11 ***
## x2         1   643.5   643.5   5.3108  0.03332 *  
## Residuals 18  2180.9   121.2                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>What information is given by <code>anova( dwaine.fit )</code>? We obtain</p>
<p><img src="ch3figures/anovach6.png" style="width:100.0%" /></p>
<p>The ANOVA table returned by <strong>R</strong> gives the decomposition of <span class="math inline">\(SSR(X_1, X_2)\)</span> (Chapter 7 material). Note that <span class="math inline">\(SSR(X_1,X_2)=SSR(X_1)+SSR(X_2|X_1)\)</span>.</p>
</div>
<div id="inference-about-the-regression-parameters" class="section level3 hasAnchor" number="3.6.3">
<h3><span class="header-section-number">3.6.3</span> Inference about the regression parameters<a href="reg.html#inference-about-the-regression-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To determine the significance of the regression parameter(s) we can summarized the fit:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="reg.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( dwaine.fit )</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2, data = dwaine.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -18.4239  -6.2161   0.7449   9.4356  20.2151 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -68.8571    60.0170  -1.147   0.2663    
## x1            1.4546     0.2118   6.868    2e-06 ***
## x2            9.3655     4.0640   2.305   0.0333 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.01 on 18 degrees of freedom
## Multiple R-squared:  0.9167, Adjusted R-squared:  0.9075 
## F-statistic:  99.1 on 2 and 18 DF,  p-value: 1.921e-10</code></pre>
<p>Note that the following is printed by <code>summary(dwaine.fit)</code>:</p>
<p><img src="ch3figures/summarych6.png" style="width:100.0%" /></p>
<p>Note that we are provided with the test statistic <span class="math inline">\(F^*\)</span> to test whether sales are related to target population and per capita disposable income (<span class="math inline">\(\beta_1=0\)</span> and <span class="math inline">\(\beta_2=0\)</span>), and we are provided with the test statistic <span class="math inline">\(t^*\)</span> for each regression parameter.</p>
</div>
<div id="inference-about-the-mean-response-and-prediction-of-new-observation" class="section level3 hasAnchor" number="3.6.4">
<h3><span class="header-section-number">3.6.4</span> Inference about the Mean Response and Prediction of New Observation<a href="reg.html#inference-about-the-mean-response-and-prediction-of-new-observation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As before, we can use <code>predict( )</code> to obtain a CI for the mean response and a PI for a predicted response. For example, a 95% confidence interval for <span class="math inline">\(E(y_h)\)</span> (expected sales in cities) in a community with <span class="math inline">\(x_{h1}=65.4\)</span> (number of persons aged 16 or younger) and <span class="math inline">\(x_{h2}=17.6\)</span> (per capita disposable personal income) is obtained in <strong>R</strong> by:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="reg.html#cb143-1" aria-hidden="true" tabindex="-1"></a>new.x.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1=</span><span class="fl">65.4</span>, <span class="at">x2=</span><span class="fl">17.6</span>)</span>
<span id="cb143-2"><a href="reg.html#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="reg.html#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(dwaine.fit, <span class="at">newdata=</span>new.x.data, <span class="at">interval=</span><span class="st">&quot;confidence&quot;</span>, <span class="at">level=</span>.<span class="dv">95</span>)</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 191.1039 185.2911 196.9168</code></pre>
<p>A 95% PI at these same levels of <code>x1</code> and <code>x2</code> is:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="reg.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(dwaine.fit, <span class="at">newdata=</span>new.x.data, <span class="at">interval=</span><span class="st">&quot;prediction&quot;</span>, <span class="at">level=</span>.<span class="dv">95</span>)</span></code></pre></div>
<pre><code>##        fit      lwr     upr
## 1 191.1039 167.2589 214.949</code></pre>
<p>To predict at two difference communities in which in one community the number of persons aged 16 or younger is 65.4 and the per capita disposable personal income is 17.6, and the other has the number of persons aged 16 or younger is 53.1 and the per capita disposable personal income is 17.7 we enter the following:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="reg.html#cb147-1" aria-hidden="true" tabindex="-1"></a>new.x.data2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1=</span><span class="fu">c</span>(<span class="fl">65.4</span>, <span class="fl">53.1</span>), <span class="at">x2=</span><span class="fu">c</span>(<span class="fl">17.6</span>, <span class="fl">17.7</span>))</span>
<span id="cb147-2"><a href="reg.html#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="reg.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict.lm</span>(dwaine.fit, <span class="at">newdata=</span>new.x.data2, <span class="at">interval=</span><span class="st">&quot;prediction&quot;</span>, <span class="at">level=</span>.<span class="dv">95</span>)</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 191.1039 167.2589 214.9490
## 2 174.1494 149.0867 199.2121</code></pre>
</div>
<div id="diagnostics" class="section level3 hasAnchor" number="3.6.5">
<h3><span class="header-section-number">3.6.5</span> Diagnostics<a href="reg.html#diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Diagnostics are conducted in the same manner (QQ-plot of the residuals, scatterplots of the residuals versus <span class="math inline">\(\hat{y}\)</span>, scatterplots of the residuals versus <span class="math inline">\(\hat{y}\)</span> versus a given <span class="math inline">\(x\)</span>) as when the simple linear regression model was discussed, but now we also consider the scatter plot matrix and correlation matrix. The argument for both of these functions will be a dataframe.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="reg.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">splom</span>( dwaine.data) <span class="co"># scatterplot matrix</span></span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-55-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="reg.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>( dwaine.data ) <span class="co"># correlation matrix</span></span></code></pre></div>
<pre><code>##           x1        x2         y
## x1 1.0000000 0.7812993 0.9445543
## x2 0.7812993 1.0000000 0.8358025
## y  0.9445543 0.8358025 1.0000000</code></pre>
</div>
<div id="anova-table-containing-decomposition-of-ssr" class="section level3 hasAnchor" number="3.6.6">
<h3><span class="header-section-number">3.6.6</span> ANOVA table containing decomposition of SSR<a href="reg.html#anova-table-containing-decomposition-of-ssr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here <strong>R</strong> is used to obtain an anova table with a decomposition of the SSR. We follow the Body Fat example from ALRM using <strong>R</strong> to obtain the anova table with the decomposition of SSR. The <code>anova( )</code> function will automatically decompose the SSR with the
decomposition depending on the order that you enter the predictor
variables into <code>lm( )</code>. For example, to get the decomposition
<span class="math display">\[SSR(x_1, x_2, x_3)=SSR(x_3)+SSR(x_2|x_3)+SSR(x_1|x_3, x_2)\]</span>
we enter the predictors into <code>lm()</code> as <code>y</code><span class="math inline">\(\thicksim\)</span><code>x3 + x2 + x1</code>.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="reg.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Import data:</span></span>
<span id="cb152-2"><a href="reg.html#cb152-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%207%20Data%20Sets/CH07TA01.txt&quot;</span></span>
<span id="cb152-3"><a href="reg.html#cb152-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-4"><a href="reg.html#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="do">### This is not a .csv file and the file does not</span></span>
<span id="cb152-5"><a href="reg.html#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="do">### include variable names, so some changes</span></span>
<span id="cb152-6"><a href="reg.html#cb152-6" aria-hidden="true" tabindex="-1"></a><span class="do">### have to be made to read.csv().</span></span>
<span id="cb152-7"><a href="reg.html#cb152-7" aria-hidden="true" tabindex="-1"></a>bf.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( url , <span class="at">header =</span> <span class="cn">FALSE</span> , <span class="at">col.names =</span> <span class="fu">c</span>( <span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x3&quot;</span>,  <span class="st">&quot;y&quot;</span> ) , <span class="at">sep =</span> <span class="st">&quot;&quot;</span> )</span>
<span id="cb152-8"><a href="reg.html#cb152-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-9"><a href="reg.html#cb152-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( bf.data )</span></code></pre></div>
<pre><code>## Rows: 20
## Columns: 4
## $ x1 &lt;dbl&gt; 19.5, 24.7, 30.7, 29.8, 19.1, 25.6, 31.4, 27.9, 22.1, 25.5, 31.1, 3…
## $ x2 &lt;dbl&gt; 43.1, 49.8, 51.9, 54.3, 42.2, 53.9, 58.5, 52.1, 49.9, 53.5, 56.6, 5…
## $ x3 &lt;dbl&gt; 29.1, 28.2, 37.0, 31.1, 30.9, 23.7, 27.6, 30.6, 23.2, 24.8, 30.0, 2…
## $ y  &lt;dbl&gt; 11.9, 22.8, 18.7, 20.1, 12.9, 21.7, 27.1, 25.4, 21.3, 19.3, 25.4, 2…</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="reg.html#cb154-1" aria-hidden="true" tabindex="-1"></a>bf.fit<span class="ot">=</span><span class="fu">lm</span>(y<span class="sc">~</span> x3 <span class="sc">+</span> x2 <span class="sc">+</span> x1, <span class="at">data=</span>bf.data)</span>
<span id="cb154-2"><a href="reg.html#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="reg.html#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bf.fit)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: y
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## x3         1  10.05   10.05  1.6343    0.2193    
## x2         1 374.23  374.23 60.8471 7.684e-07 ***
## x1         1  12.70   12.70  2.0657    0.1699    
## Residuals 16  98.40    6.15                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>One could also use the extra sums of squares formulas to get the decomposition desired.</p>
</div>
<div id="testing-whether-beta_k-neq-0-for-some-k" class="section level3 hasAnchor" number="3.6.7">
<h3><span class="header-section-number">3.6.7</span> Testing whether <span class="math inline">\(\beta_k \neq 0\)</span> for some <span class="math inline">\(k\)</span><a href="reg.html#testing-whether-beta_k-neq-0-for-some-k" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are several ways to go about testing whether a single or multiple regression coefficients are significant using <strong>R</strong>. For example, we could get the appropriate extra sums of squares for the reduced model and the full model to calculate the appropriate test statistic. If the reduced model is nested under the full model then we can use <code>anova( )</code> to compute the test statistic and corresponding p-value. All that is required is to specify the full model and the model under the null hypothesis (reduced model).</p>
<p>Suppose it is of interest to test the following hypothesis for the Body Fat
example from ALRM:</p>
<p><span class="math display">\[ H_0: \beta_2=\beta_3=0\]</span></p>
<p>The reduced model is <span class="math inline">\(Y_i=\beta_0+\beta_1 X_{i1} + \varepsilon_i\)</span>
and the full models is <span class="math inline">\(y_i=\beta_0+\beta_1 x_{i1} + \beta_2 x_{i2} +\beta_3 x_{i3}+ \varepsilon_i\)</span>. Clearly the models are
nested therefore we use the function <code>anova( )</code>:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="reg.html#cb156-1" aria-hidden="true" tabindex="-1"></a>reduced.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>( y <span class="sc">~</span> x1 , <span class="at">data=</span> bf.data )</span>
<span id="cb156-2"><a href="reg.html#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="reg.html#cb156-3" aria-hidden="true" tabindex="-1"></a>full.fit<span class="ot">=</span><span class="fu">lm</span>( y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 , <span class="at">data=</span>bf.data)</span>
<span id="cb156-4"><a href="reg.html#cb156-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-5"><a href="reg.html#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>( reduced.fit , full.fit , <span class="at">test=</span> <span class="st">&quot;F&quot;</span> )</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: y ~ x1
## Model 2: y ~ x1 + x2 + x3
##   Res.Df     RSS Df Sum of Sq      F  Pr(&gt;F)  
## 1     18 143.120                              
## 2     16  98.405  2    44.715 3.6352 0.04995 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The following is printed by <code>anova( reduced.fit , full.fit,test='F' )</code>:</p>
<p><img src="ch3figures/redTest.png" style="width:90.0%" /></p>
</div>
</div>
<div id="interactions" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Interactions<a href="reg.html#interactions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Suppose we wish to include the interaction of <span class="math inline">\(x_1 \times x_2\)</span> in
One way to include an interaction term
is by specifying <code>x1*x2</code> in the model <em>formula</em>.
Specifying <code>x1*x2</code> instead of <code>x1+x2</code> will include the
main effects and the interaction effect. An alternative way is to use <code>mutate()</code> to add a new
the predictor variable <code>x1*x2</code>. Both
methods are illustrated:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="reg.html#cb158-1" aria-hidden="true" tabindex="-1"></a>BodyFat.Inter<span class="ot">=</span><span class="fu">lm</span>(y<span class="sc">~</span> x1<span class="sc">*</span>x2 <span class="sc">+</span> x3, <span class="at">data=</span>bf.data)</span>
<span id="cb158-2"><a href="reg.html#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(BodyFat.Inter)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 * x2 + x3, data = bf.data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.5365 -1.8682  0.2772  1.2493  4.1589 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) 150.87925  124.06427   1.216    0.243
## x1            4.15688    3.11251   1.336    0.202
## x2           -3.64609    3.11348  -1.171    0.260
## x3           -2.45340    1.72707  -1.421    0.176
## x1:x2         0.01401    0.02911   0.481    0.637
## 
## Residual standard error: 2.542 on 15 degrees of freedom
## Multiple R-squared:  0.8044, Adjusted R-squared:  0.7522 
## F-statistic: 15.42 on 4 and 15 DF,  p-value: 3.41e-05</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="reg.html#cb160-1" aria-hidden="true" tabindex="-1"></a>bf.data2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>( bf.data, <span class="at">x1x2=</span> x1<span class="sc">*</span>x2)</span>
<span id="cb160-2"><a href="reg.html#cb160-2" aria-hidden="true" tabindex="-1"></a>BodyFat.Inter2<span class="ot">=</span><span class="fu">lm</span>(y<span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x1x2, <span class="at">data=</span>bf.data2  )</span>
<span id="cb160-3"><a href="reg.html#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(BodyFat.Inter2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2 + x3 + x1x2, data = bf.data2)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.5365 -1.8682  0.2772  1.2493  4.1589 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) 150.87925  124.06427   1.216    0.243
## x1            4.15688    3.11251   1.336    0.202
## x2           -3.64609    3.11348  -1.171    0.260
## x3           -2.45340    1.72707  -1.421    0.176
## x1x2          0.01401    0.02911   0.481    0.637
## 
## Residual standard error: 2.542 on 15 degrees of freedom
## Multiple R-squared:  0.8044, Adjusted R-squared:  0.7522 
## F-statistic: 15.42 on 4 and 15 DF,  p-value: 3.41e-05</code></pre>
</div>
<div id="standardized-multiple-regression" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Standardized multiple regression<a href="reg.html#standardized-multiple-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To compare the size of the estimated regression parameter estimates on a common scale, we have to standardize each variable (response and explanatory) in the model. Standardized multiple regression in <strong>R</strong> is illustrated using the Dwaine studios data:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="reg.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( mosaic )</span>
<span id="cb162-2"><a href="reg.html#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Import data:</span></span>
<span id="cb162-3"><a href="reg.html#cb162-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%206%20Data%20Sets/CH06FI05.txt&quot;</span></span>
<span id="cb162-4"><a href="reg.html#cb162-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-5"><a href="reg.html#cb162-5" aria-hidden="true" tabindex="-1"></a>dwaine.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( url , <span class="at">header =</span> <span class="cn">FALSE</span> , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>,  <span class="st">&quot;y&quot;</span>) , <span class="at">sep =</span> <span class="st">&quot;&quot;</span> )</span>
<span id="cb162-6"><a href="reg.html#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( dwaine.data )</span></code></pre></div>
<pre><code>## Rows: 21
## Columns: 3
## $ x1 &lt;dbl&gt; 68.5, 45.2, 91.3, 47.8, 46.9, 66.1, 49.5, 52.0, 48.9, 38.4, 87.9, 7…
## $ x2 &lt;dbl&gt; 16.7, 16.8, 18.2, 16.3, 17.3, 18.2, 15.9, 17.2, 16.6, 16.0, 18.3, 1…
## $ y  &lt;dbl&gt; 174.4, 164.4, 244.2, 154.6, 181.6, 207.5, 152.8, 163.2, 145.4, 137.…</code></pre>
<p>To standardize a given variable, we use a function called <code>scale( )</code> within mutate:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="reg.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( mosaic )</span>
<span id="cb164-2"><a href="reg.html#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Standarize each explanatory variable using mutate()</span></span>
<span id="cb164-3"><a href="reg.html#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="do">### with scale().  </span></span>
<span id="cb164-4"><a href="reg.html#cb164-4" aria-hidden="true" tabindex="-1"></a>dwaine.dataStdz <span class="ot">&lt;-</span> <span class="fu">mutate</span>( dwaine.data , <span class="at">y.stdz  =</span> <span class="fu">scale</span>( y ) , </span>
<span id="cb164-5"><a href="reg.html#cb164-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x1.stdz =</span> <span class="fu">scale</span>( x1) , </span>
<span id="cb164-6"><a href="reg.html#cb164-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x2.stdz =</span> <span class="fu">scale</span>( x2 ) )</span>
<span id="cb164-7"><a href="reg.html#cb164-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-8"><a href="reg.html#cb164-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The head( ) function allows one to view the </span></span>
<span id="cb164-9"><a href="reg.html#cb164-9" aria-hidden="true" tabindex="-1"></a><span class="co"># first few observations of a given dataset.</span></span>
<span id="cb164-10"><a href="reg.html#cb164-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that we now have each standardize </span></span>
<span id="cb164-11"><a href="reg.html#cb164-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  variable. </span></span>
<span id="cb164-12"><a href="reg.html#cb164-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( dwaine.dataStdz )</span></code></pre></div>
<pre><code>##     x1   x2     y      y.stdz    x1.stdz    x2.stdz
## 1 68.5 16.7 174.4 -0.20736368  0.3480579 -0.4563909
## 2 45.2 16.8 164.4 -0.48367315 -0.9032627 -0.3533349
## 3 91.3 18.2 244.2  1.72127642  1.5725261  1.0894493
## 4 47.8 16.3 154.6 -0.75445643 -0.7636303 -0.8686150
## 5 46.9 17.3 181.6 -0.00842086 -0.8119646  0.1619452
## 6 66.1 18.2 207.5  0.70722067  0.2191665  1.0894493</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="reg.html#cb166-1" aria-hidden="true" tabindex="-1"></a>dwaine.fitStdz <span class="ot">&lt;-</span> <span class="fu">lm</span>( y.stdz <span class="sc">~</span> x1.stdz <span class="sc">+</span> x2.stdz <span class="sc">-</span><span class="dv">1</span>, <span class="at">data=</span> dwaine.dataStdz)</span>
<span id="cb166-2"><a href="reg.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dwaine.fitStdz)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y.stdz ~ x1.stdz + x2.stdz - 1, data = dwaine.dataStdz)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.50907 -0.17176  0.02058  0.26071  0.55856 
## 
## Coefficients:
##         Estimate Std. Error t value Pr(&gt;|t|)    
## x1.stdz   0.7484     0.1061   7.056 1.03e-06 ***
## x2.stdz   0.2511     0.1061   2.368   0.0287 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.296 on 19 degrees of freedom
## Multiple R-squared:  0.9167, Adjusted R-squared:  0.908 
## F-statistic: 104.6 on 2 and 19 DF,  p-value: 5.544e-11</code></pre>
<p>The output of <code>summary(dwaine.fitStdz)</code> is nearly identical to <code>summary(dwaine.fit)</code> but we now have the estimated standardized regression coefficient estimates, <span class="math inline">\(b_i^*\)</span>.</p>
</div>
<div id="polynomial-regression-and-regression-with-categorical-variables" class="section level2 hasAnchor" number="3.9">
<h2><span class="header-section-number">3.9</span> Polynomial regression and regression with categorical variables<a href="reg.html#polynomial-regression-and-regression-with-categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we start by using R to fit the second-order polynomial regression model with one predictor variable:
<span class="math display">\[
y_i=\beta_0 + \beta_1 x_{i}^* + \beta_1 x_i^{*2} + \varepsilon_i  
\]</span>
where <span class="math inline">\(x_{i}^* = x_i - \bar{x}\)</span>.</p>
<p>We fit this polynomial model using New York air quality measurements provided in the <code>airquality</code> dataset. In this illustration, the response is ozone and the explanatory variable is temperature. To start, center the explanatory variable and square the centered explanatory variable:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="reg.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( mosaic )</span>
<span id="cb168-2"><a href="reg.html#cb168-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-3"><a href="reg.html#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>( airquality )</span>
<span id="cb168-4"><a href="reg.html#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( airquality )</span></code></pre></div>
<pre><code>## Rows: 153
## Columns: 6
## $ Ozone   &lt;int&gt; 41, 36, 12, 18, NA, 28, 23, 19, 8, NA, 7, 16, 11, 14, 18, 14, …
## $ Solar.R &lt;int&gt; 190, 118, 149, 313, NA, NA, 299, 99, 19, 194, NA, 256, 290, 27…
## $ Wind    &lt;dbl&gt; 7.4, 8.0, 12.6, 11.5, 14.3, 14.9, 8.6, 13.8, 20.1, 8.6, 6.9, 9…
## $ Temp    &lt;int&gt; 67, 72, 74, 62, 56, 66, 65, 59, 61, 69, 74, 69, 66, 68, 58, 64…
## $ Month   &lt;int&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,…
## $ Day     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,…</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="reg.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># center the explanatory variable and square the </span></span>
<span id="cb170-2"><a href="reg.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># centered explanatory variable</span></span>
<span id="cb170-3"><a href="reg.html#cb170-3" aria-hidden="true" tabindex="-1"></a>airqualityCen <span class="ot">&lt;-</span> <span class="fu">mutate</span>( airquality, <span class="at">cenx1 =</span><span class="fu">scale</span>( Temp , <span class="at">scale=</span><span class="cn">FALSE</span> ), <span class="at">cenx1sq =</span> cenx1<span class="sc">^</span><span class="dv">2</span> )</span></code></pre></div>
<p>A polynomial regression is a linear regression model, so we fit the model in the same manner as past models:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="reg.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( mosaic )</span>
<span id="cb171-2"><a href="reg.html#cb171-2" aria-hidden="true" tabindex="-1"></a>polyfit <span class="ot">&lt;-</span> <span class="fu">lm</span>( Ozone<span class="sc">~</span> cenx1 <span class="sc">+</span> cenx1sq , <span class="at">data=</span> airqualityCen )</span>
<span id="cb171-3"><a href="reg.html#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="reg.html#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the fit</span></span>
<span id="cb171-5"><a href="reg.html#cb171-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( polyfit )</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Ozone ~ cenx1 + cenx1sq, data = airqualityCen)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -37.619 -12.513  -2.736   9.676 123.909 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 35.19617    2.79472  12.594  &lt; 2e-16 ***
## cenx1        2.60963    0.22610  11.542  &lt; 2e-16 ***
## cenx1sq      0.07807    0.02086   3.743 0.000288 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 22.47 on 113 degrees of freedom
##   (37 observations deleted due to missingness)
## Multiple R-squared:  0.5442, Adjusted R-squared:  0.5362 
## F-statistic: 67.46 on 2 and 113 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="reg.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>( Ozone  <span class="sc">~</span> cenx1  , <span class="at">data =</span> airqualityCen,   <span class="at">panel =</span> <span class="cf">function</span>(x, y, ...){ </span>
<span id="cb173-2"><a href="reg.html#cb173-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">panel.xyplot</span>(x, y, ...) </span>
<span id="cb173-3"><a href="reg.html#cb173-3" aria-hidden="true" tabindex="-1"></a>      fm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>)) </span>
<span id="cb173-4"><a href="reg.html#cb173-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">panel.lines</span>(<span class="fu">sort</span>(x), <span class="fu">predict</span>(fm, <span class="at">newdata=</span><span class="fu">data.frame</span>( <span class="at">x=</span><span class="fu">sort</span>(x))), <span class="at">col.line =</span> <span class="st">&quot;black&quot;</span>) </span>
<span id="cb173-5"><a href="reg.html#cb173-5" aria-hidden="true" tabindex="-1"></a>      } )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-63-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="model-selection" class="section level2 hasAnchor" number="3.10">
<h2><span class="header-section-number">3.10</span> Model selection<a href="reg.html#model-selection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section deals with different criteria for model selection for MLR. To illustrate different model selection criteria with R, we follow the Surgical Unit Example from ALRM. To start, import the data:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="reg.html#cb174-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%209%20Data%20Sets/CH09TA01.txt&quot;</span></span>
<span id="cb174-2"><a href="reg.html#cb174-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-3"><a href="reg.html#cb174-3" aria-hidden="true" tabindex="-1"></a>surgunit.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( url , <span class="at">header =</span> <span class="cn">FALSE</span> , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x3&quot;</span>, <span class="st">&quot;x4&quot;</span>, <span class="st">&quot;x5&quot;</span>, <span class="st">&quot;x6&quot;</span>, <span class="st">&quot;x7&quot;</span>, <span class="st">&quot;x8&quot;</span>,   <span class="st">&quot;y&quot;</span>, <span class="st">&quot;lny&quot;</span>) , <span class="at">sep =</span> <span class="st">&quot;&quot;</span> )</span>
<span id="cb174-4"><a href="reg.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( surgunit.data )</span></code></pre></div>
<pre><code>## Rows: 54
## Columns: 10
## $ x1  &lt;dbl&gt; 6.7, 5.1, 7.4, 6.5, 7.8, 5.8, 5.7, 3.7, 6.0, 3.7, 6.3, 6.7, 5.8, 5…
## $ x2  &lt;int&gt; 62, 59, 57, 73, 65, 38, 46, 68, 67, 76, 84, 51, 96, 83, 62, 74, 85…
## $ x3  &lt;int&gt; 81, 66, 83, 41, 115, 72, 63, 81, 93, 94, 83, 43, 114, 88, 67, 68, …
## $ x4  &lt;dbl&gt; 2.59, 1.70, 2.16, 2.01, 4.30, 1.42, 1.91, 2.57, 2.50, 2.40, 4.13, …
## $ x5  &lt;int&gt; 50, 39, 55, 48, 45, 65, 49, 69, 58, 48, 37, 57, 63, 52, 58, 64, 36…
## $ x6  &lt;int&gt; 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, …
## $ x7  &lt;int&gt; 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, …
## $ x8  &lt;int&gt; 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, …
## $ y   &lt;int&gt; 695, 403, 710, 349, 2343, 348, 518, 749, 1056, 968, 745, 257, 1573…
## $ lny &lt;dbl&gt; 6.544, 5.999, 6.565, 5.854, 7.759, 5.852, 6.250, 6.619, 6.962, 6.8…</code></pre>
<p>Tell R that certain varialbes are categorical:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="reg.html#cb176-1" aria-hidden="true" tabindex="-1"></a>surgunit.data <span class="ot">&lt;-</span> <span class="fu">mutate</span>( surgunit.data,  <span class="at">x6fac =</span><span class="fu">as.factor</span>(x6), <span class="at">x7fac =</span> <span class="fu">as.factor</span>( x7 ), <span class="at">x8fac=</span> <span class="fu">as.factor</span>( x8 ) )</span>
<span id="cb176-2"><a href="reg.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( surgunit.data )</span></code></pre></div>
<pre><code>## Rows: 54
## Columns: 13
## $ x1    &lt;dbl&gt; 6.7, 5.1, 7.4, 6.5, 7.8, 5.8, 5.7, 3.7, 6.0, 3.7, 6.3, 6.7, 5.8,…
## $ x2    &lt;int&gt; 62, 59, 57, 73, 65, 38, 46, 68, 67, 76, 84, 51, 96, 83, 62, 74, …
## $ x3    &lt;int&gt; 81, 66, 83, 41, 115, 72, 63, 81, 93, 94, 83, 43, 114, 88, 67, 68…
## $ x4    &lt;dbl&gt; 2.59, 1.70, 2.16, 2.01, 4.30, 1.42, 1.91, 2.57, 2.50, 2.40, 4.13…
## $ x5    &lt;int&gt; 50, 39, 55, 48, 45, 65, 49, 69, 58, 48, 37, 57, 63, 52, 58, 64, …
## $ x6    &lt;int&gt; 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1…
## $ x7    &lt;int&gt; 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1…
## $ x8    &lt;int&gt; 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0…
## $ y     &lt;int&gt; 695, 403, 710, 349, 2343, 348, 518, 749, 1056, 968, 745, 257, 15…
## $ lny   &lt;dbl&gt; 6.544, 5.999, 6.565, 5.854, 7.759, 5.852, 6.250, 6.619, 6.962, 6…
## $ x6fac &lt;fct&gt; 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1…
## $ x7fac &lt;fct&gt; 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1…
## $ x8fac &lt;fct&gt; 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0…</code></pre>
<div id="r_ap2-and-c_p" class="section level3 hasAnchor" number="3.10.1">
<h3><span class="header-section-number">3.10.1</span> <span class="math inline">\(R_{a,p}^2\)</span> and <span class="math inline">\(C_p\)</span><a href="reg.html#r_ap2-and-c_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math inline">\(R^2\)</span> does not decrease as the number of covariates in the model increases. The adjusted coefficient of determination, <span class="math inline">\(R_{a,p}^2\)</span> may decrease as the number of covariates in the model increases, and so takes into account the number of explanatory variables that are in the model. To compute <span class="math inline">\(R_{a,p}^2\)</span> for several candidate models, we use the function <code>leaps</code> function from the <code>leaps</code> R package. First install the R package <code>leaps</code>:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="reg.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>( leaps )</span></code></pre></div>
<p>First, we have to define a matrix whose columns consist of the variables under consideration (this is not the design/model matrix). Note that <code>leaps()</code> can only handle factor variables with two levels and they must be numeric (don’t use the factored versions of <span class="math inline">\(x6\)</span>, <span class="math inline">\(x7\)</span>, and <span class="math inline">\(x8\)</span>:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="reg.html#cb179-1" aria-hidden="true" tabindex="-1"></a>Xleaps <span class="ot">&lt;-</span> <span class="fu">select</span>( surgunit.data, <span class="sc">-</span><span class="fu">c</span>( <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span> ) )  </span></code></pre></div>
<p>The <code>leaps()</code> function requires this matrix, the response variable and the model selection criterion (<code>"Cp"</code> or <code>"adjr2"</code>):</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="reg.html#cb180-1" aria-hidden="true" tabindex="-1"></a>R2adj.temp <span class="ot">&lt;-</span> <span class="fu">leaps</span>(<span class="at">x=</span>Xleaps, <span class="at">y=</span>surgunit.data<span class="sc">$</span><span class="st">&quot;lny&quot;</span>, <span class="at">method=</span><span class="st">&quot;adjr2&quot;</span>)</span></code></pre></div>
<p>To better organize the information provided by <code>leaps()</code>, run the following:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="reg.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co">#obtain relevant info</span></span>
<span id="cb181-2"><a href="reg.html#cb181-2" aria-hidden="true" tabindex="-1"></a>R2adj.info<span class="ot">=</span><span class="fu">cbind</span>(R2adj.temp<span class="sc">$</span>which,R2adj.temp<span class="sc">$</span>size,R2adj.temp<span class="sc">$</span>adjr2)</span>
<span id="cb181-3"><a href="reg.html#cb181-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-4"><a href="reg.html#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add names to make it easier to read info</span></span>
<span id="cb181-5"><a href="reg.html#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(R2adj.info)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>,<span class="st">&quot;x2&quot;</span>,<span class="st">&quot;x3&quot;</span>,<span class="st">&quot;x4&quot;</span>,<span class="st">&quot;x5&quot;</span>, <span class="st">&quot;x6&quot;</span>, <span class="st">&quot;x7&quot;</span>, <span class="st">&quot;x8&quot;</span>, <span class="st">&quot;p&quot;</span>,<span class="st">&quot;adjr2&quot;</span>)</span>
<span id="cb181-6"><a href="reg.html#cb181-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-7"><a href="reg.html#cb181-7" aria-hidden="true" tabindex="-1"></a>R2adj.info</span></code></pre></div>
<pre><code>##   x1 x2 x3 x4 x5 x6 x7 x8 p        adjr2
## 1  0  0  1  0  0  0  0  0 2  0.416557881
## 1  0  0  0  1  0  0  0  0 2  0.410417798
## 1  0  1  0  0  0  0  0  0 2  0.205862939
## 1  0  0  0  0  0  0  0  1 2  0.122406556
## 1  1  0  0  0  0  0  0  0 2  0.042543244
## 1  0  0  0  0  0  1  0  0 2  0.035653717
## 1  0  0  0  0  1  0  0  0 2  0.002187716
## 1  0  0  0  0  0  0  1  0 2 -0.002898254
## 2  0  1  1  0  0  0  0  0 3  0.650085544
## 2  0  0  1  1  0  0  0  0 3  0.583777218
## 2  1  0  1  0  0  0  0  0 3  0.530934014
## 2  0  0  1  0  0  0  0  1 3  0.497419295
## 2  0  0  0  1  0  0  0  1 3  0.488519841
## 2  0  1  0  1  0  0  0  0 3  0.462691631
## 2  0  0  1  0  0  1  0  0 3  0.426095576
## 2  0  0  1  0  1  0  0  0 3  0.424491387
## 2  0  0  0  1  0  0  1  0 3  0.411731492
## 2  0  0  1  0  0  0  1  0 3  0.410390386
## 3  0  1  1  0  0  0  0  1 4  0.764715749
## 3  1  1  1  0  0  0  0  0 4  0.742729360
## 3  0  1  1  1  0  0  0  0 4  0.700885337
## 3  0  1  1  0  0  0  1  0 4  0.661818074
## 3  0  1  1  0  1  0  0  0 4  0.656711027
## 3  0  1  1  0  0  1  0  0 4  0.649910695
## 3  0  0  1  1  0  0  0  1 4  0.649267958
## 3  1  0  1  1  0  0  0  0 4  0.588850588
## 3  0  0  1  1  0  0  1  0 4  0.581680554
## 3  0  0  1  1  1  0  0  0 4  0.577651443
## 4  1  1  1  0  0  0  0  1 5  0.815996984
## 4  0  1  1  1  0  0  0  1 5  0.799293694
## 4  0  1  1  0  0  1  0  1 5  0.771518218
## 4  0  1  1  0  1  0  0  1 5  0.765894154
## 4  0  1  1  0  0  0  1  1 5  0.761994941
## 4  1  1  1  0  1  0  0  0 5  0.750009741
## 4  1  1  1  0  0  0  1  0 5  0.747435371
## 4  1  1  1  0  0  1  0  0 5  0.741872034
## 4  1  1  1  1  0  0  0  0 5  0.739554570
## 4  0  1  1  1  0  0  1  0 5  0.711129897
## 5  1  1  1  0  0  1  0  1 6  0.820508061
## 5  1  1  1  0  1  0  0  1 6  0.818704958
## 5  1  1  1  1  0  0  0  1 6  0.815758658
## 5  1  1  1  0  0  0  1  1 6  0.814141607
## 5  0  1  1  1  0  1  0  1 6  0.798911508
## 5  0  1  1  1  0  0  1  1 6  0.796775100
## 5  0  1  1  1  1  0  0  1 6  0.796460487
## 5  0  1  1  0  1  1  0  1 6  0.772967184
## 5  0  1  1  0  0  1  1  1 6  0.768818413
## 5  0  1  1  0  1  0  1  1 6  0.764075717
## 6  1  1  1  0  1  1  0  1 7  0.823449402
## 6  1  1  1  0  0  1  1  1 7  0.818660139
## 6  1  1  1  1  0  1  0  1 7  0.818132982
## 6  1  1  1  0  1  0  1  1 7  0.817824375
## 6  1  1  1  1  1  0  0  1 7  0.816356244
## 6  1  1  1  1  0  0  1  1 7  0.813704868
## 6  0  1  1  1  0  1  1  1 7  0.796331530
## 6  0  1  1  1  1  1  0  1 7  0.796311668
## 6  0  1  1  1  1  0  1  1 7  0.794252288
## 6  0  1  1  0  1  1  1  1 7  0.771189602
## 7  1  1  1  0  1  1  1  1 8  0.822597377
## 7  1  1  1  1  1  1  0  1 8  0.819816836
## 7  1  1  1  1  0  1  1  1 8  0.816097625
## 7  1  1  1  1  1  0  1  1 8  0.815143680
## 7  0  1  1  1  1  1  1  1 8  0.794098517
## 7  1  1  1  1  1  1  1  0 8  0.746632006
## 7  1  0  1  1  1  1  1  1 8  0.634657905
## 7  1  1  0  1  1  1  1  1 8  0.553658658
## 8  1  1  1  1  1  1  1  1 9  0.818773720</code></pre>
<p>Note that the models with among the higher <span class="math inline">\(R_{a,p}^2\)</span> are the models that include <span class="math inline">\(x1\)</span>, <span class="math inline">\(x2\)</span>, <span class="math inline">\(x3\)</span>, and <span class="math inline">\(x8\)</span> and include <span class="math inline">\(x1\)</span>, <span class="math inline">\(x2\)</span>, <span class="math inline">\(x3\)</span>, <span class="math inline">\(x6\)</span>, and <span class="math inline">\(x8\)</span>.</p>
<p>Mallows’ <span class="math inline">\(C_p\)</span> criterion may also be obtained in the sammer manner using <code>leaps</code> but we replace <code>"adjr2"</code> with <code>"Cp"</code>:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="reg.html#cb183-1" aria-hidden="true" tabindex="-1"></a>Cp.temp <span class="ot">&lt;-</span> <span class="fu">leaps</span>(<span class="at">x=</span>Xleaps, <span class="at">y=</span>surgunit.data<span class="sc">$</span><span class="st">&quot;lny&quot;</span>, <span class="at">method=</span><span class="st">&quot;Cp&quot;</span>)</span>
<span id="cb183-2"><a href="reg.html#cb183-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb183-3"><a href="reg.html#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="co">#obtain relevant info</span></span>
<span id="cb183-4"><a href="reg.html#cb183-4" aria-hidden="true" tabindex="-1"></a>Cp.info<span class="ot">=</span><span class="fu">cbind</span>(Cp.temp<span class="sc">$</span>which,Cp.temp<span class="sc">$</span>size,Cp.temp<span class="sc">$</span>Cp)</span>
<span id="cb183-5"><a href="reg.html#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="reg.html#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add names to make it easier to read info</span></span>
<span id="cb183-7"><a href="reg.html#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Cp.info)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>,<span class="st">&quot;x2&quot;</span>,<span class="st">&quot;x3&quot;</span>,<span class="st">&quot;x4&quot;</span>,<span class="st">&quot;x5&quot;</span>, <span class="st">&quot;x6&quot;</span>, <span class="st">&quot;x7&quot;</span>, <span class="st">&quot;x8&quot;</span>, <span class="st">&quot;p&quot;</span>,<span class="st">&quot;Cp&quot;</span>)</span>
<span id="cb183-8"><a href="reg.html#cb183-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-9"><a href="reg.html#cb183-9" aria-hidden="true" tabindex="-1"></a>Cp.info</span></code></pre></div>
<pre><code>##   x1 x2 x3 x4 x5 x6 x7 x8 p         Cp
## 1  0  0  1  0  0  0  0  0 2 117.409441
## 1  0  0  0  1  0  0  0  0 2 119.171240
## 1  0  1  0  0  0  0  0  0 2 177.865004
## 1  0  0  0  0  0  0  0  1 2 201.811487
## 1  1  0  0  0  0  0  0  0 2 224.726995
## 1  0  0  0  0  0  1  0  0 2 226.703835
## 1  0  0  0  0  1  0  0  0 2 236.306372
## 1  0  0  0  0  0  0  1  0 2 237.765710
## 2  0  1  1  0  0  0  0  0 3  50.471575
## 2  0  0  1  1  0  0  0  0 3  69.131808
## 2  1  0  1  0  0  0  0  0 3  84.002738
## 2  0  0  1  0  0  0  0  1 3  93.434321
## 2  0  0  0  1  0  0  0  1 3  95.938771
## 2  0  1  0  1  0  0  0  0 3 103.207247
## 2  0  0  1  0  0  1  0  0 3 113.505967
## 2  0  0  1  0  1  0  0  0 3 113.957411
## 2  0  0  0  1  0  0  1  0 3 117.548252
## 2  0  0  1  0  0  0  1  0 3 117.925661
## 3  0  1  1  0  0  0  0  1 4  18.914496
## 3  1  1  1  0  0  0  0  0 4  24.980500
## 3  0  1  1  1  0  0  0  0 4  36.525190
## 3  0  1  1  0  0  0  1  0 4  47.303776
## 3  0  1  1  0  1  0  0  0 4  48.712801
## 3  0  1  1  0  0  1  0  0 4  50.589000
## 3  0  0  1  1  0  0  0  1 4  50.766330
## 3  1  0  1  1  0  0  0  0 4  67.435372
## 3  0  0  1  1  0  0  1  0 4  69.413572
## 3  0  0  1  1  1  0  0  0 4  70.525196
## 4  1  1  1  0  0  0  0  1 5   5.750774
## 4  0  1  1  1  0  0  0  1 5  10.267014
## 4  0  1  1  0  0  1  0  1 5  17.776952
## 4  0  1  1  0  1  0  0  1 5  19.297588
## 4  0  1  1  0  0  0  1  1 5  20.351858
## 4  1  1  1  0  1  0  0  0 5  23.592419
## 4  1  1  1  0  0  0  1  0 5  24.288478
## 4  1  1  1  0  0  1  0  0 5  25.792694
## 4  1  1  1  1  0  0  0  0 5  26.419290
## 4  0  1  1  1  0  0  1  0 5  34.104759
## 5  1  1  1  0  0  1  0  1 6   5.540639
## 5  1  1  1  0  1  0  0  1 6   6.018212
## 5  1  1  1  1  0  0  0  1 6   6.798576
## 5  1  1  1  0  0  0  1  1 6   7.226872
## 5  0  1  1  1  0  1  0  1 6  11.260750
## 5  0  1  1  1  0  0  1  1 6  11.826604
## 5  0  1  1  1  1  0  0  1 6  11.909933
## 5  0  1  1  0  1  1  0  1 6  18.132422
## 5  0  1  1  0  0  1  1  1 6  19.231275
## 5  0  1  1  0  1  0  1  1 6  20.487436
## 6  1  1  1  0  1  1  0  1 7   5.787389
## 6  1  1  1  0  0  1  1  1 7   7.029456
## 6  1  1  1  1  0  1  0  1 7   7.166172
## 6  1  1  1  0  1  0  1  1 7   7.246207
## 6  1  1  1  1  1  0  0  1 7   7.626958
## 6  1  1  1  1  0  0  1  1 7   8.314578
## 6  0  1  1  1  0  1  1  1 7  12.820254
## 6  0  1  1  1  1  1  0  1 7  12.825405
## 6  0  1  1  1  1  0  1  1 7  13.359493
## 6  0  1  1  0  1  1  1  1 7  19.340669
## 7  1  1  1  0  1  1  1  1 8   7.029455
## 7  1  1  1  1  1  1  0  1 8   7.735230
## 7  1  1  1  1  0  1  1  1 8   8.679263
## 7  1  1  1  1  1  0  1  1 8   8.921400
## 7  0  1  1  1  1  1  1  1 8  14.263216
## 7  1  1  1  1  1  1  1  0 8  26.311466
## 7  1  0  1  1  1  1  1  1 8  54.733440
## 7  1  1  0  1  1  1  1  1 8  75.293181
## 8  1  1  1  1  1  1  1  1 9   9.000000</code></pre>
<p>Note that a model with <span class="math inline">\(x1\)</span>, <span class="math inline">\(x2\)</span>, <span class="math inline">\(x3\)</span>, <span class="math inline">\(x5\)</span>, and <span class="math inline">\(x8\)</span> has a <span class="math inline">\(C_p\)</span> that is near and above <span class="math inline">\(p\)</span>.</p>
</div>
<div id="aic_p" class="section level3 hasAnchor" number="3.10.2">
<h3><span class="header-section-number">3.10.2</span> <span class="math inline">\(AIC_p\)</span><a href="reg.html#aic_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The AIC criterion may be computed using the funciton <code>AIC()</code>. The only argument for this funciton is an <code>lm</code> object. For example:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="reg.html#cb185-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>( lny <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x5 <span class="sc">+</span> x8, <span class="at">data=</span> surgunit.data )</span>
<span id="cb185-2"><a href="reg.html#cb185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-3"><a href="reg.html#cb185-3" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>( lny <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x8, <span class="at">data=</span> surgunit.data )</span>
<span id="cb185-4"><a href="reg.html#cb185-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-5"><a href="reg.html#cb185-5" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>( lny <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x4 <span class="sc">+</span> x6 <span class="sc">+</span> x8, <span class="at">data=</span> surgunit.data )</span>
<span id="cb185-6"><a href="reg.html#cb185-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-7"><a href="reg.html#cb185-7" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>( fit1, fit2, fit3 )</span></code></pre></div>
<pre><code>##      df       AIC
## fit1  7 -8.020058
## fit2  6 -8.105992
## fit3  7 38.449552</code></pre>
</div>
<div id="bic_p-or-sbc_p" class="section level3 hasAnchor" number="3.10.3">
<h3><span class="header-section-number">3.10.3</span> <span class="math inline">\(BIC_p\)</span> or <span class="math inline">\(SBC_p\)</span><a href="reg.html#bic_p-or-sbc_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The BIC criterion may be computed using the function <code>AIC()</code> as well but we have to add an additional argument:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="reg.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(surgunit.data)</span></code></pre></div>
<pre><code>## [1] 54 13</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="reg.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>( fit1, fit2, fit3 , <span class="at">k=</span> <span class="fu">log</span>( <span class="dv">54</span> ))</span></code></pre></div>
<pre><code>##      df       AIC
## fit1  7  5.902830
## fit2  6  3.827912
## fit3  7 52.372440</code></pre>
<p>Note that by default, <span class="math inline">\(k=2\)</span>.</p>
</div>
<div id="aicc_p" class="section level3 hasAnchor" number="3.10.4">
<h3><span class="header-section-number">3.10.4</span> <span class="math inline">\(AICc_p\)</span><a href="reg.html#aicc_p" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Akaike’s corrected Information Criterion may also be computed with <code>AIC()</code> by adding the “correction”:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="reg.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get AIC of a model and store result</span></span>
<span id="cb191-2"><a href="reg.html#cb191-2" aria-hidden="true" tabindex="-1"></a>storeAIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>( fit1, fit2, fit3 )</span>
<span id="cb191-3"><a href="reg.html#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="reg.html#cb191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5"><a href="reg.html#cb191-5" aria-hidden="true" tabindex="-1"></a>AICc <span class="ot">&lt;-</span> storeAIC<span class="sc">$</span>AIC <span class="sc">+</span> ( <span class="dv">2</span><span class="sc">*</span>(storeAIC<span class="sc">$</span>df)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>storeAIC<span class="sc">$</span>df ) <span class="sc">/</span> ( <span class="dv">54</span><span class="sc">-</span> storeAIC<span class="sc">$</span>df <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb191-6"><a href="reg.html#cb191-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-7"><a href="reg.html#cb191-7" aria-hidden="true" tabindex="-1"></a>AICc</span></code></pre></div>
<pre><code>## [1] -5.585275 -6.318758 40.884335</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="reg.html#cb193-1" aria-hidden="true" tabindex="-1"></a>storeBIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>( fit1, fit2, fit3, <span class="at">k=</span><span class="fu">log</span>(<span class="dv">54</span>) )</span>
<span id="cb193-2"><a href="reg.html#cb193-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-3"><a href="reg.html#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(AICc, storeAIC,  storeBIC) <span class="co">#ignore the column headers</span></span></code></pre></div>
<pre><code>##           AICc df       AIC df       AIC
## fit1 -5.585275  7 -8.020058  7  5.902830
## fit2 -6.318758  6 -8.105992  6  3.827912
## fit3 40.884335  7 38.449552  7 52.372440</code></pre>
</div>
<div id="stepwise-regression" class="section level3 hasAnchor" number="3.10.5">
<h3><span class="header-section-number">3.10.5</span> Stepwise regression<a href="reg.html#stepwise-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function <code>step()</code> in R performs forward and backward stepwise regression. The <code>step()</code> function uses AIC (by default) for its model selection criterion. The arguments of the step function are the initial model (an lm object) to start the procedure, the scope (the covariates under consideration), and the direction of the search (<code>backward</code> or <code>forward</code>)</p>
<p>Forward selection starts with a model with no explanatory variables and decides which covariates to add at each step by getting the explanatory variables that gives the lowest AIC, if in the next step a lower AIC is not obtained, then it stops searching. Therefore, the model to specify in <code>step()</code> must be a model with just the intercept and the scope must include all the predictor variables to include in the search. We demonstrate with the Surgical
Unit data but we limit ourselves for using the first 4 predictor variables as before for the purpose of illustration:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="reg.html#cb195-1" aria-hidden="true" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lny <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data=</span> surgunit.data) <span class="co">#model with just the intercept</span></span>
<span id="cb195-2"><a href="reg.html#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="reg.html#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="co"># using AIC criterion</span></span>
<span id="cb195-4"><a href="reg.html#cb195-4" aria-hidden="true" tabindex="-1"></a>fit.fstepAIC <span class="ot">&lt;-</span> <span class="fu">step</span>(fit0, <span class="at">scope=</span><span class="sc">~</span> x1<span class="sc">+</span>x2<span class="sc">+</span>x3<span class="sc">+</span>x4, <span class="at">direction=</span><span class="st">&quot;forward&quot;</span> )</span></code></pre></div>
<pre><code>## Start:  AIC=-75.7
## lny ~ 1
## 
##        Df Sum of Sq     RSS      AIC
## + x3    1    5.4762  7.3316 -103.827
## + x4    1    5.3990  7.4087 -103.262
## + x2    1    2.8285  9.9792  -87.178
## + x1    1    0.7763 12.0315  -77.079
## &lt;none&gt;              12.8077  -75.703
## 
## Step:  AIC=-103.83
## lny ~ x3
## 
##        Df Sum of Sq    RSS     AIC
## + x2    1    3.0191 4.3125 -130.48
## + x4    1    2.2019 5.1297 -121.11
## + x1    1    1.5506 5.7810 -114.66
## &lt;none&gt;              7.3316 -103.83
## 
## Step:  AIC=-130.48
## lny ~ x3 + x2
## 
##        Df Sum of Sq    RSS     AIC
## + x1    1   1.20395 3.1085 -146.16
## + x4    1   0.69836 3.6141 -138.02
## &lt;none&gt;              4.3125 -130.48
## 
## Step:  AIC=-146.16
## lny ~ x3 + x2 + x1
## 
##        Df Sum of Sq    RSS     AIC
## &lt;none&gt;              3.1085 -146.16
## + x4    1  0.024578 3.0840 -144.59</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="reg.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model suggested by forward selection w/AIC</span></span>
<span id="cb197-2"><a href="reg.html#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.fstepAIC)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lny ~ x3 + x2 + x1, data = surgunit.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.46992 -0.17954 -0.03071  0.17883  0.59253 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.766176   0.226758  16.609  &lt; 2e-16 ***
## x3          0.016452   0.001630  10.094 1.17e-13 ***
## x2          0.013340   0.002035   6.556 2.97e-08 ***
## x1          0.095458   0.021692   4.401 5.67e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2493 on 50 degrees of freedom
## Multiple R-squared:  0.7573, Adjusted R-squared:  0.7427 
## F-statistic:    52 on 3 and 50 DF,  p-value: 2.124e-15</code></pre>
<p>Now obtain results using the forward stepwise regression results using the BIC criterion:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="reg.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using BIC criterion --&gt; note the argument k= log(n)</span></span>
<span id="cb199-2"><a href="reg.html#cb199-2" aria-hidden="true" tabindex="-1"></a>fit.fstepBIC <span class="ot">&lt;-</span> <span class="fu">step</span>(fit0, <span class="at">scope=</span><span class="sc">~</span> x1<span class="sc">+</span>x2<span class="sc">+</span>x3<span class="sc">+</span>x4, <span class="at">direction=</span><span class="st">&quot;forward&quot;</span>  , <span class="at">k=</span> <span class="fu">log</span>(<span class="dv">54</span>) )</span></code></pre></div>
<pre><code>## Start:  AIC=-73.71
## lny ~ 1
## 
##        Df Sum of Sq     RSS     AIC
## + x3    1    5.4762  7.3316 -99.849
## + x4    1    5.3990  7.4087 -99.284
## + x2    1    2.8285  9.9792 -83.200
## &lt;none&gt;              12.8077 -73.714
## + x1    1    0.7763 12.0315 -73.101
## 
## Step:  AIC=-99.85
## lny ~ x3
## 
##        Df Sum of Sq    RSS      AIC
## + x2    1    3.0191 4.3125 -124.516
## + x4    1    2.2019 5.1297 -115.146
## + x1    1    1.5506 5.7810 -108.691
## &lt;none&gt;              7.3316  -99.849
## 
## Step:  AIC=-124.52
## lny ~ x3 + x2
## 
##        Df Sum of Sq    RSS     AIC
## + x1    1   1.20395 3.1085 -138.21
## + x4    1   0.69836 3.6141 -130.07
## &lt;none&gt;              4.3125 -124.52
## 
## Step:  AIC=-138.2
## lny ~ x3 + x2 + x1
## 
##        Df Sum of Sq    RSS     AIC
## &lt;none&gt;              3.1085 -138.21
## + x4    1  0.024578 3.0840 -134.65</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="reg.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model suggested by forward selection w/AIC</span></span>
<span id="cb201-2"><a href="reg.html#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.fstepBIC)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lny ~ x3 + x2 + x1, data = surgunit.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.46992 -0.17954 -0.03071  0.17883  0.59253 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.766176   0.226758  16.609  &lt; 2e-16 ***
## x3          0.016452   0.001630  10.094 1.17e-13 ***
## x2          0.013340   0.002035   6.556 2.97e-08 ***
## x1          0.095458   0.021692   4.401 5.67e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2493 on 50 degrees of freedom
## Multiple R-squared:  0.7573, Adjusted R-squared:  0.7427 
## F-statistic:    52 on 3 and 50 DF,  p-value: 2.124e-15</code></pre>
<p>Backward selection starts with a full model with all predictors and it decides which predictor to delete at each step by seeing which predictor deletion leads to the lowest AIC, once a lower AIC is
not obtained in the next step it stops. Therefore the model to specify in <code>step()</code> must be a model with all the predictor variables and the scope must include all the predictor variables to include in
the search:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="reg.html#cb203-1" aria-hidden="true" tabindex="-1"></a>fitfull <span class="ot">&lt;-</span> <span class="fu">lm</span>(lny <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4, <span class="at">data=</span> surgunit.data) <span class="co">#model with just the intercept</span></span>
<span id="cb203-2"><a href="reg.html#cb203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-3"><a href="reg.html#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="co"># using AIC criterion</span></span>
<span id="cb203-4"><a href="reg.html#cb203-4" aria-hidden="true" tabindex="-1"></a>fit.BstepAIC <span class="ot">&lt;-</span> <span class="fu">step</span>(fitfull, <span class="at">scope=</span><span class="sc">~</span> x1<span class="sc">+</span>x2<span class="sc">+</span>x3<span class="sc">+</span>x4, <span class="at">direction=</span><span class="st">&quot;backward&quot;</span> )</span></code></pre></div>
<pre><code>## Start:  AIC=-144.59
## lny ~ x1 + x2 + x3 + x4
## 
##        Df Sum of Sq    RSS     AIC
## - x4    1    0.0246 3.1085 -146.16
## &lt;none&gt;              3.0840 -144.59
## - x1    1    0.5302 3.6141 -138.02
## - x2    1    1.8839 4.9678 -120.84
## - x3    1    3.4862 6.5702 -105.75
## 
## Step:  AIC=-146.16
## lny ~ x1 + x2 + x3
## 
##        Df Sum of Sq    RSS      AIC
## &lt;none&gt;              3.1085 -146.161
## - x1    1    1.2040 4.3125 -130.483
## - x2    1    2.6724 5.7810 -114.658
## - x3    1    6.3341 9.4427  -88.162</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="reg.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model suggested by forward selection w/AIC</span></span>
<span id="cb205-2"><a href="reg.html#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.BstepAIC)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lny ~ x1 + x2 + x3, data = surgunit.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.46992 -0.17954 -0.03071  0.17883  0.59253 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.766176   0.226758  16.609  &lt; 2e-16 ***
## x1          0.095458   0.021692   4.401 5.67e-05 ***
## x2          0.013340   0.002035   6.556 2.97e-08 ***
## x3          0.016452   0.001630  10.094 1.17e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2493 on 50 degrees of freedom
## Multiple R-squared:  0.7573, Adjusted R-squared:  0.7427 
## F-statistic:    52 on 3 and 50 DF,  p-value: 2.124e-15</code></pre>
<p>Now obtain results using the backward stepwise regression results using the BIC criterion:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="reg.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using BIC criterion --&gt; note the argument k= log(n)</span></span>
<span id="cb207-2"><a href="reg.html#cb207-2" aria-hidden="true" tabindex="-1"></a>fit.BstepBIC <span class="ot">&lt;-</span> <span class="fu">step</span>(fitfull, <span class="at">scope=</span><span class="sc">~</span> x1<span class="sc">+</span>x2<span class="sc">+</span>x3<span class="sc">+</span>x4, <span class="at">direction=</span><span class="st">&quot;backward&quot;</span>  , <span class="at">k=</span> <span class="fu">log</span>(<span class="dv">54</span>) )</span></code></pre></div>
<pre><code>## Start:  AIC=-134.64
## lny ~ x1 + x2 + x3 + x4
## 
##        Df Sum of Sq    RSS      AIC
## - x4    1    0.0246 3.1085 -138.205
## &lt;none&gt;              3.0840 -134.645
## - x1    1    0.5302 3.6141 -130.067
## - x2    1    1.8839 4.9678 -112.888
## - x3    1    3.4862 6.5702  -97.792
## 
## Step:  AIC=-138.2
## lny ~ x1 + x2 + x3
## 
##        Df Sum of Sq    RSS      AIC
## &lt;none&gt;              3.1085 -138.205
## - x1    1    1.2040 4.3125 -124.516
## - x2    1    2.6724 5.7810 -108.691
## - x3    1    6.3341 9.4427  -82.195</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="reg.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model suggested by forward selection w/AIC</span></span>
<span id="cb209-2"><a href="reg.html#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.BstepBIC)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lny ~ x1 + x2 + x3, data = surgunit.data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.46992 -0.17954 -0.03071  0.17883  0.59253 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.766176   0.226758  16.609  &lt; 2e-16 ***
## x1          0.095458   0.021692   4.401 5.67e-05 ***
## x2          0.013340   0.002035   6.556 2.97e-08 ***
## x3          0.016452   0.001630  10.094 1.17e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2493 on 50 degrees of freedom
## Multiple R-squared:  0.7573, Adjusted R-squared:  0.7427 
## F-statistic:    52 on 3 and 50 DF,  p-value: 2.124e-15</code></pre>
</div>
<div id="cvpress-and-gcv" class="section level3 hasAnchor" number="3.10.6">
<h3><span class="header-section-number">3.10.6</span> CV/PRESS and GCV<a href="reg.html#cvpress-and-gcv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The cross validation (CV) or PRESS criterion provides a sense of how well the model can predict new values of y. We use the computational friendly from the CV criterion to compute a CV scores. To illustrate, the CV scores of <code>fit1</code>, <code>fit2</code>, and <code>fit3</code> are computed.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="reg.html#cb211-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">54</span></span>
<span id="cb211-2"><a href="reg.html#cb211-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3"><a href="reg.html#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="do">### CV score fit1</span></span>
<span id="cb211-4"><a href="reg.html#cb211-4" aria-hidden="true" tabindex="-1"></a>cvtop <span class="ot">&lt;-</span> <span class="fu">residuals</span>( fit1 )</span>
<span id="cb211-5"><a href="reg.html#cb211-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-6"><a href="reg.html#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="co"># diagonal elements of the hat matrix: h_ii&#39;s</span></span>
<span id="cb211-7"><a href="reg.html#cb211-7" aria-hidden="true" tabindex="-1"></a>cvbottom <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> <span class="fu">hatvalues</span>( fit1 ) </span>
<span id="cb211-8"><a href="reg.html#cb211-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-9"><a href="reg.html#cb211-9" aria-hidden="true" tabindex="-1"></a><span class="co"># CV score  </span></span>
<span id="cb211-10"><a href="reg.html#cb211-10" aria-hidden="true" tabindex="-1"></a>CVfit1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>n<span class="sc">*</span><span class="fu">sum</span>( (cvtop<span class="sc">/</span>cvbottom)<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb211-11"><a href="reg.html#cb211-11" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb211-12"><a href="reg.html#cb211-12" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb211-13"><a href="reg.html#cb211-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-14"><a href="reg.html#cb211-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-15"><a href="reg.html#cb211-15" aria-hidden="true" tabindex="-1"></a><span class="do">### CV score fit2</span></span>
<span id="cb211-16"><a href="reg.html#cb211-16" aria-hidden="true" tabindex="-1"></a>cvtop <span class="ot">&lt;-</span> <span class="fu">residuals</span>( fit2 )</span>
<span id="cb211-17"><a href="reg.html#cb211-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-18"><a href="reg.html#cb211-18" aria-hidden="true" tabindex="-1"></a><span class="co"># hatvalues # &lt;--- provides the diagonal elements of H</span></span>
<span id="cb211-19"><a href="reg.html#cb211-19" aria-hidden="true" tabindex="-1"></a>cvbottom <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> <span class="fu">hatvalues</span>( fit2 )</span>
<span id="cb211-20"><a href="reg.html#cb211-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-21"><a href="reg.html#cb211-21" aria-hidden="true" tabindex="-1"></a><span class="co"># CV score  </span></span>
<span id="cb211-22"><a href="reg.html#cb211-22" aria-hidden="true" tabindex="-1"></a>CVfit2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>n<span class="sc">*</span><span class="fu">sum</span>( (cvtop<span class="sc">/</span>cvbottom)<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb211-23"><a href="reg.html#cb211-23" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb211-24"><a href="reg.html#cb211-24" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb211-25"><a href="reg.html#cb211-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-26"><a href="reg.html#cb211-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-27"><a href="reg.html#cb211-27" aria-hidden="true" tabindex="-1"></a><span class="do">### CV score fit3</span></span>
<span id="cb211-28"><a href="reg.html#cb211-28" aria-hidden="true" tabindex="-1"></a>cvtop <span class="ot">&lt;-</span> <span class="fu">residuals</span>( fit3 )</span>
<span id="cb211-29"><a href="reg.html#cb211-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-30"><a href="reg.html#cb211-30" aria-hidden="true" tabindex="-1"></a><span class="co"># diagonal elements of the hat matrix: h_ii&#39;s</span></span>
<span id="cb211-31"><a href="reg.html#cb211-31" aria-hidden="true" tabindex="-1"></a><span class="co"># hatvalues # &lt;--- provides the diagonal elements of H</span></span>
<span id="cb211-32"><a href="reg.html#cb211-32" aria-hidden="true" tabindex="-1"></a>cvbottom <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> <span class="fu">hatvalues</span>( fit3 ) </span>
<span id="cb211-33"><a href="reg.html#cb211-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-34"><a href="reg.html#cb211-34" aria-hidden="true" tabindex="-1"></a><span class="co"># CV score  </span></span>
<span id="cb211-35"><a href="reg.html#cb211-35" aria-hidden="true" tabindex="-1"></a>CVfit3 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>n<span class="sc">*</span><span class="fu">sum</span>( (cvtop<span class="sc">/</span>cvbottom)<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb211-36"><a href="reg.html#cb211-36" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb211-37"><a href="reg.html#cb211-37" aria-hidden="true" tabindex="-1"></a><span class="do">###  </span></span>
<span id="cb211-38"><a href="reg.html#cb211-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-39"><a href="reg.html#cb211-39" aria-hidden="true" tabindex="-1"></a>CVfit1</span></code></pre></div>
<pre><code>## [1] 0.05072096</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="reg.html#cb213-1" aria-hidden="true" tabindex="-1"></a>CVfit2</span></code></pre></div>
<pre><code>## [1] 0.05069947</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="reg.html#cb215-1" aria-hidden="true" tabindex="-1"></a>CVfit3</span></code></pre></div>
<pre><code>## [1] 0.1158974</code></pre>
<p>Next, compute the GCV scores:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="reg.html#cb217-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">54</span></span>
<span id="cb217-2"><a href="reg.html#cb217-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-3"><a href="reg.html#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="do">### GCV score fit1</span></span>
<span id="cb217-4"><a href="reg.html#cb217-4" aria-hidden="true" tabindex="-1"></a><span class="do">### sum of squared residuals</span></span>
<span id="cb217-5"><a href="reg.html#cb217-5" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">residuals</span>( fit1 )<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb217-6"><a href="reg.html#cb217-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-7"><a href="reg.html#cb217-7" aria-hidden="true" tabindex="-1"></a>gcvbottom <span class="ot">&lt;-</span> ( <span class="dv">1</span><span class="sc">-</span> <span class="fu">mean</span>( <span class="fu">hatvalues</span>( fit1 ) ) )<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb217-8"><a href="reg.html#cb217-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-9"><a href="reg.html#cb217-9" aria-hidden="true" tabindex="-1"></a><span class="co"># GCV score  </span></span>
<span id="cb217-10"><a href="reg.html#cb217-10" aria-hidden="true" tabindex="-1"></a>gcvfit1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>n<span class="sc">*</span>( SSE<span class="sc">/</span>gcvbottom )</span>
<span id="cb217-11"><a href="reg.html#cb217-11" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb217-12"><a href="reg.html#cb217-12" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb217-13"><a href="reg.html#cb217-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-14"><a href="reg.html#cb217-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-15"><a href="reg.html#cb217-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-16"><a href="reg.html#cb217-16" aria-hidden="true" tabindex="-1"></a><span class="do">### GCV score fit2</span></span>
<span id="cb217-17"><a href="reg.html#cb217-17" aria-hidden="true" tabindex="-1"></a><span class="do">### sum of squared residuals</span></span>
<span id="cb217-18"><a href="reg.html#cb217-18" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">residuals</span>( fit2 )<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb217-19"><a href="reg.html#cb217-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-20"><a href="reg.html#cb217-20" aria-hidden="true" tabindex="-1"></a>gcvbottom <span class="ot">&lt;-</span> ( <span class="dv">1</span><span class="sc">-</span> <span class="fu">mean</span>( <span class="fu">hatvalues</span>( fit2 ) ) )<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb217-21"><a href="reg.html#cb217-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-22"><a href="reg.html#cb217-22" aria-hidden="true" tabindex="-1"></a><span class="co"># GCV score  </span></span>
<span id="cb217-23"><a href="reg.html#cb217-23" aria-hidden="true" tabindex="-1"></a>gcvfit2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>n<span class="sc">*</span>( SSE<span class="sc">/</span>gcvbottom )</span>
<span id="cb217-24"><a href="reg.html#cb217-24" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb217-25"><a href="reg.html#cb217-25" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb217-26"><a href="reg.html#cb217-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-27"><a href="reg.html#cb217-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-28"><a href="reg.html#cb217-28" aria-hidden="true" tabindex="-1"></a><span class="do">### GCV score fit2</span></span>
<span id="cb217-29"><a href="reg.html#cb217-29" aria-hidden="true" tabindex="-1"></a><span class="do">### sum of squared residuals</span></span>
<span id="cb217-30"><a href="reg.html#cb217-30" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">residuals</span>( fit3 )<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb217-31"><a href="reg.html#cb217-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-32"><a href="reg.html#cb217-32" aria-hidden="true" tabindex="-1"></a>gcvbottom <span class="ot">&lt;-</span> ( <span class="dv">1</span><span class="sc">-</span> <span class="fu">mean</span>( <span class="fu">hatvalues</span>( fit3 ) ) )<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb217-33"><a href="reg.html#cb217-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-34"><a href="reg.html#cb217-34" aria-hidden="true" tabindex="-1"></a><span class="co"># GCV score  </span></span>
<span id="cb217-35"><a href="reg.html#cb217-35" aria-hidden="true" tabindex="-1"></a>gcvfit3 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>n<span class="sc">*</span>( SSE<span class="sc">/</span>gcvbottom )</span>
<span id="cb217-36"><a href="reg.html#cb217-36" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb217-37"><a href="reg.html#cb217-37" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb217-38"><a href="reg.html#cb217-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-39"><a href="reg.html#cb217-39" aria-hidden="true" tabindex="-1"></a>gcvfit1</span></code></pre></div>
<pre><code>## [1] 0.04928725</code></pre>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="reg.html#cb219-1" aria-hidden="true" tabindex="-1"></a>gcvfit2</span></code></pre></div>
<pre><code>## [1] 0.04900256</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="reg.html#cb221-1" aria-hidden="true" tabindex="-1"></a>gcvfit3</span></code></pre></div>
<pre><code>## [1] 0.1165376</code></pre>
<!--

row1 <- c("Name ", "  ", "What does it do?")
row2 <- c("%*% ", "  ", "Performs matrix multiplication")
row3 <- c("t( ) ", "  ", "Transposes a matrix.")
row4 <- c("solve( ) ", "  ", "Obtains an Inverse of a matrix")
row5 <- c("* ", "  ", "Performs element by element multiplication.")

tmpa <- rbind(row1, row2, row3, row4, row5 )
rownames(tmpa) <- NULL
knitr::kable(tmpa, "pipe")


-->
</div>
</div>
<div id="more-diagnostics" class="section level2 hasAnchor" number="3.11">
<h2><span class="header-section-number">3.11</span> More diagnostics<a href="reg.html#more-diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="identifying-outlying-y-and-x-values" class="section level3 hasAnchor" number="3.11.1">
<h3><span class="header-section-number">3.11.1</span> Identifying outlying y and x values<a href="reg.html#identifying-outlying-y-and-x-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The body fat example is used to illustrate studentized residuals, deleted residuals, and studentized deleted residuals. To start, import the data:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="reg.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Import data:</span></span>
<span id="cb223-2"><a href="reg.html#cb223-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.csub.edu/~emontoya2/datasets/textbookdata/Kutner/Chapter%20%207%20Data%20Sets/CH07TA01.txt&quot;</span></span>
<span id="cb223-3"><a href="reg.html#cb223-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-4"><a href="reg.html#cb223-4" aria-hidden="true" tabindex="-1"></a><span class="do">### This is not a .csv file and the file does not</span></span>
<span id="cb223-5"><a href="reg.html#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="do">### include variable names, so some changes</span></span>
<span id="cb223-6"><a href="reg.html#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="do">### have to be made to read.csv().</span></span>
<span id="cb223-7"><a href="reg.html#cb223-7" aria-hidden="true" tabindex="-1"></a>bf.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( url , <span class="at">header =</span> <span class="cn">FALSE</span> , <span class="at">col.names =</span> <span class="fu">c</span>( <span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x3&quot;</span>,  <span class="st">&quot;y&quot;</span> ) , <span class="at">sep =</span> <span class="st">&quot;&quot;</span> )</span>
<span id="cb223-8"><a href="reg.html#cb223-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-9"><a href="reg.html#cb223-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>( bf.data )</span></code></pre></div>
<pre><code>## Rows: 20
## Columns: 4
## $ x1 &lt;dbl&gt; 19.5, 24.7, 30.7, 29.8, 19.1, 25.6, 31.4, 27.9, 22.1, 25.5, 31.1, 3…
## $ x2 &lt;dbl&gt; 43.1, 49.8, 51.9, 54.3, 42.2, 53.9, 58.5, 52.1, 49.9, 53.5, 56.6, 5…
## $ x3 &lt;dbl&gt; 29.1, 28.2, 37.0, 31.1, 30.9, 23.7, 27.6, 30.6, 23.2, 24.8, 30.0, 2…
## $ y  &lt;dbl&gt; 11.9, 22.8, 18.7, 20.1, 12.9, 21.7, 27.1, 25.4, 21.3, 19.3, 25.4, 2…</code></pre>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="reg.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 20</span></span>
<span id="cb225-2"><a href="reg.html#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 4</span></span>
<span id="cb225-3"><a href="reg.html#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ x1 &lt;dbl&gt; 19.5, 24.7, 30.7, 29.8, 19.1, 25.6, 31.4, 27.9, 22.1, 25.5, 31.1, 3~</span></span>
<span id="cb225-4"><a href="reg.html#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ x2 &lt;dbl&gt; 43.1, 49.8, 51.9, 54.3, 42.2, 53.9, 58.5, 52.1, 49.9, 53.5, 56.6, 5~</span></span>
<span id="cb225-5"><a href="reg.html#cb225-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ x3 &lt;dbl&gt; 29.1, 28.2, 37.0, 31.1, 30.9, 23.7, 27.6, 30.6, 23.2, 24.8, 30.0, 2~</span></span>
<span id="cb225-6"><a href="reg.html#cb225-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ y  &lt;dbl&gt; 11.9, 22.8, 18.7, 20.1, 12.9, 21.7, 27.1, 25.4, 21.3, 19.3, 25.4, 2~</span></span></code></pre></div>
<p>Examine the scatterplot matrix for potential outlying values:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="reg.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">splom</span>(bf.data)</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-81-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>To obtain the studentized residuals we use the function <code>rstandard()</code> whose only argument is an <em>lm object</em>:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="reg.html#cb227-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>( y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, <span class="at">data=</span> bf.data)</span>
<span id="cb227-2"><a href="reg.html#cb227-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-3"><a href="reg.html#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="co"># studentized residual</span></span>
<span id="cb227-4"><a href="reg.html#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rstandard</span>( fit1 ) </span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
## -1.46802633  1.13326956 -1.23262045 -1.29571232  0.57630252 -0.23525791 
##           7           8           9          10          11          12 
##  0.62249950  1.38022830  0.76529502 -0.57761774  0.34965240  0.94324119 
##          13          14          15          16          17          18 
## -1.50477923  1.84715613  0.49352568  0.07392664 -0.16107977 -0.63614383 
##          19          20 
## -1.61308352  0.25538013</code></pre>
<p>The function <code>rstudent()</code> obtains the studentized deleted residuals:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="reg.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># studentized deleted residuals</span></span>
<span id="cb229-2"><a href="reg.html#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rstudent</span>( fit1 ) </span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
## -1.52803951  1.14416429 -1.25452990 -1.32606735  0.56388572 -0.22818249 
##           7           8           9          10          11          12 
##  0.61016668  1.42385079  0.75493974 -0.56519997  0.33985038  0.93979234 
##          13          14          15          16          17          18 
## -1.57251203  2.01637183  0.48153342  0.07159138 -0.15609143 -0.62388391 
##          19          20 
## -1.70680191  0.24777625</code></pre>
<p>The function <code>hatvalues()</code> obtains the influence or leverage values (<span class="math inline">\(h_ii&#39;s\)</span>) :</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="reg.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># studentized deleted residuals</span></span>
<span id="cb231-2"><a href="reg.html#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hatvalues</span>( fit1 ) </span></code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
## 0.34120920 0.15653638 0.44042770 0.11242972 0.36109984 0.13151364 0.19433721 
##          8          9         10         11         12         13         14 
## 0.16418081 0.19278940 0.24051819 0.13935816 0.10929380 0.21357666 0.18808377 
##         15         16         17         18         19         20 
## 0.34830629 0.11439069 0.12532943 0.22828343 0.13235798 0.06597771</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="reg.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note n is 20</span></span>
<span id="cb233-2"><a href="reg.html#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="co"># p is 4</span></span>
<span id="cb233-3"><a href="reg.html#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">*</span><span class="dv">4</span><span class="sc">/</span><span class="dv">20</span></span></code></pre></div>
<pre><code>## [1] 0.6</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="reg.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>( <span class="fu">hatvalues</span>( fit1 ) <span class="sc">~</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> , </span>
<span id="cb235-2"><a href="reg.html#cb235-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel =</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb235-3"><a href="reg.html#cb235-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">panel.xyplot</span>(x, y)</span>
<span id="cb235-4"><a href="reg.html#cb235-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">panel.abline</span>(<span class="at">a=</span><span class="dv">3</span><span class="sc">*</span><span class="dv">4</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb235-5"><a href="reg.html#cb235-5" aria-hidden="true" tabindex="-1"></a>       },   <span class="at">xlab =</span> <span class="st">&quot;Cases&quot;</span>, </span>
<span id="cb235-6"><a href="reg.html#cb235-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">&quot;Leverage values&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">7</span>))</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-84-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="identifying-influential-cases" class="section level3 hasAnchor" number="3.11.2">
<h3><span class="header-section-number">3.11.2</span> Identifying influential cases<a href="reg.html#identifying-influential-cases" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The difference in fits for observation i (or DFFITS) can be obtained by using <code>dffits()</code> whose only argument is an <em>lm object</em>:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="reg.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dffits</span>( fit1 ) </span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
## -1.09969231  0.49290457 -1.11298735 -0.47195954  0.42392423 -0.08879453 
##           7           8           9          10          11          12 
##  0.29967452  0.63105834  0.36894399 -0.31806611  0.13675485  0.32920196 
##          13          14          15          16          17          18 
## -0.81948815  0.97048913  0.35203458  0.02572972 -0.05908583 -0.33932204 
##          19          20 
## -0.66663467  0.06585362</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="reg.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>( (<span class="dv">4</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>(<span class="dv">20-4-1</span>))</span></code></pre></div>
<pre><code>## [1] 1.154701</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="reg.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot DFFITS vs cases</span></span>
<span id="cb240-2"><a href="reg.html#cb240-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">xyplot</span>( <span class="fu">dffits</span>( fit1 )  <span class="sc">~</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> ,</span>
<span id="cb240-3"><a href="reg.html#cb240-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">panel =</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb240-4"><a href="reg.html#cb240-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">panel.xyplot</span>(x, y)</span>
<span id="cb240-5"><a href="reg.html#cb240-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">panel.abline</span>(<span class="at">a=</span><span class="fl">1.154701</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb240-6"><a href="reg.html#cb240-6" aria-hidden="true" tabindex="-1"></a>       }, </span>
<span id="cb240-7"><a href="reg.html#cb240-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;cases&quot;</span>, </span>
<span id="cb240-8"><a href="reg.html#cb240-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">&quot;DFFITS&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.2</span>) )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-85-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Cook’s distance measure is computed using <code>cooks.distance()</code> and it requires an <em>lm object</em>:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="reg.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cooks.distance</span>( fit1 ) </span></code></pre></div>
<pre><code>##            1            2            3            4            5            6 
## 0.2790492817 0.0595875286 0.2989628090 0.0531661934 0.0469283564 0.0020952519 
##            7            8            9           10           11           12 
## 0.0233679530 0.0935517519 0.0349698759 0.0264150596 0.0049490632 0.0272927035 
##           13           14           15           16           17           18 
## 0.1537386238 0.1976001749 0.0325444771 0.0001764779 0.0009294597 0.0299272765 
##           19           20 
## 0.0992346339 0.0011517393</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="reg.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If D_i &gt;&gt; .5, it may be an influential point. </span></span>
<span id="cb243-2"><a href="reg.html#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="co"># If D_i &gt;&gt; 1, it quite likely to be an influential point. </span></span>
<span id="cb243-3"><a href="reg.html#cb243-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-4"><a href="reg.html#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>( <span class="fu">dffits</span>( fit1 )  <span class="sc">~</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> ,</span>
<span id="cb243-5"><a href="reg.html#cb243-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">panel =</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb243-6"><a href="reg.html#cb243-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">panel.xyplot</span>(x, y)</span>
<span id="cb243-7"><a href="reg.html#cb243-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">panel.abline</span>(<span class="at">a=</span><span class="fu">c</span>(.<span class="dv">5</span>), <span class="at">b=</span><span class="fu">c</span>(<span class="dv">0</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb243-8"><a href="reg.html#cb243-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">panel.abline</span>(<span class="at">a=</span><span class="fu">c</span>(<span class="dv">1</span>), <span class="at">b=</span><span class="fu">c</span>(<span class="dv">0</span>),  <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb243-9"><a href="reg.html#cb243-9" aria-hidden="true" tabindex="-1"></a>       }, </span>
<span id="cb243-10"><a href="reg.html#cb243-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;cases&quot;</span>, </span>
<span id="cb243-11"><a href="reg.html#cb243-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">&quot;Cooks distance&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.2</span>) )</span></code></pre></div>
<p><img src="03-reg_files/figure-html/unnamed-chunk-86-1.png" width="672" style="display: block; margin: auto;" /></p>
<!-- zhttps://online.stat.psu.edu/stat501/lesson/11/11.7 -->
<p><br/></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basics.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
